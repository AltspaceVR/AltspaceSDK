{"version":3,"file":"aframe-altspace-component.min.js","sources":["../src/AFrameComponent.js","../src/utilities.js","../src/AltspaceCursorCollider.js","../src/AltspaceTrackedControls.js","../src/AltspaceComponent.js","../src/SyncColor.js","../src/SyncComponent.js","../src/SyncSystem.js","../src/sync-transform.js","../src/sync-n-sound.js","../src/index.js","../src/native-components.js","../src/wire.js"],"sourcesContent":["'use strict';\r\n\r\nclass AFrameSystem\r\n{\r\n\tget schema(){\r\n\t\treturn null;\r\n\t}\r\n\r\n\tinit(){ }\r\n\ttick(time, timeDelta){ }\r\n\tpause(){ }\r\n\tplay(){ }\r\n}\r\n\r\nclass AFrameComponent extends AFrameSystem\r\n{\r\n\tupdate(oldData){ }\r\n\tremove(){ }\r\n\tupdateSchema(data){ }\r\n}\r\n\r\nfunction flatten(obj)\r\n{\r\n\tlet ret = {};\r\n\tif(!obj.__proto__){\r\n\t\tret = Object.assign( {schema: {}, dependencies: []}, obj );\r\n\t}\r\n\telse {\r\n\t\tret = Object.assign( flatten(obj.__proto__), obj );\r\n\t}\r\n\r\n\tif(obj.schema)\r\n\t\tObject.assign(ret.schema, obj.schema);\r\n\r\n\tif(obj.dependencies)\r\n\t\tret.dependencies.push(...obj.dependencies);\r\n\r\n\treturn ret;\r\n}\r\n\r\nfunction registerComponentClass(name, cls)\r\n{\r\n\tAFRAME.registerComponent(name, flatten(new cls(true)));\r\n}\r\n\r\nfunction registerSystemClass(name, cls)\r\n{\r\n\tAFRAME.registerSystem(name, flatten(new cls(true)));\r\n}\r\n\r\nexport { AFrameComponent, AFrameSystem, registerComponentClass, registerSystemClass, flatten };\r\n","'use strict';\r\n\r\nfunction safeDeepSet(obj, keys, value)\r\n{\r\n\tif(keys.length === 0)\r\n\t\treturn value;\r\n\telse {\r\n\t\tobj[keys[0]] = safeDeepSet(obj[keys[0]] || {}, keys.slice(1), value);\r\n\t\treturn obj;\r\n\t}\r\n}\r\n\r\nexport { safeDeepSet };\r\n","/**\r\n* Enable or disable cursor collision on the object.\r\n* @mixin altspace-cursor-collider\r\n* @memberof altspace\r\n* @prop {boolean} enabled=true - The state of the cursor collider.\r\n*/\r\n\r\n'use strict';\r\n\r\nimport {AFrameComponent} from './AFrameComponent';\r\nimport {safeDeepSet} from './utilities';\r\n\r\n\r\nexport default class AltspaceCursorCollider extends AFrameComponent\r\n{\r\n\tget schema(){\r\n\t\treturn {enabled: {type: 'boolean', default: 'true'}};\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tthis.setColliderFlag(this.data.enabled);\r\n\t\tthis.el.addEventListener('model-loaded', (() => {\r\n\t\t\tthis.setColliderFlag(this.data.enabled);\r\n\t\t}).bind(this));\r\n\t}\r\n\r\n\tupdate()\r\n\t{\r\n\t\tthis.setColliderFlag(this.data.enabled);\r\n\t}\r\n\r\n\tsetColliderFlag(state)\r\n\t{\r\n\t\tlet obj = this.el.object3D;\r\n\t\tif(obj){\r\n\t\t\tconsole.log('Setting collider flag to', state);\r\n\t\t\tsafeDeepSet(obj.userData, ['altspace','collider','enabled'], state);\r\n\t\t\tobj.traverse(subobj => {\r\n\t\t\t\tif( subobj instanceof THREE.Mesh ){\r\n\t\t\t\t\tsafeDeepSet(subobj.userData, ['altspace','collider','enabled'], state);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n};\r\n","/**\r\n* Enables tracked control support for A-Frame applications that use the built-in\r\n* `tracked-controls`, `vive-controls` or `hand-controls` components.\r\n* @mixin altspace-tracked-controls\r\n* @memberof altspace\r\n*/\r\n'use strict';\r\n\r\nimport {AFrameComponent} from './AFrameComponent';\r\n\r\nexport default class AltspaceTrackedControls extends AFrameComponent\r\n{\r\n\tinit()\r\n\t{\r\n\t\tthis.gamepadIndex = null;\r\n\t\tthis.trackedControlsSystem = document.querySelector('a-scene').systems['tracked-controls'];\r\n\t\tthis.systemGamepads = 0;\r\n\t\taltspace.getGamepads();\r\n\t}\r\n\r\n\ttick()\r\n\t{\r\n\t\tif (\r\n\t\t\tthis.trackedControlsSystem &&\r\n\t\t\tthis.systemGamepads !== this.trackedControlsSystem.controllers.length &&\r\n\t\t\twindow.altspace && altspace.getGamepads && altspace.getGamepads().length\r\n\t\t) {\r\n\t\t\tvar components = this.el.components;\r\n\t\t\tif (components['paint-controls']) {\r\n\t\t\t\tthis.gamepadIndex = components['paint-controls'].data.hand === 'left' ? 2 : 1;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.gamepadIndex === null && components['hand-controls']) {\r\n\t\t\t\tthis.gamepadIndex = components['hand-controls'].data === 'left' ? 2 : 1;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.gamepadIndex === null && components['vive-controls']) {\r\n\t\t\t\tthis.gamepadIndex = components['vive-controls'].data.hand === 'left' ? 2 : 1;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.gamepadIndex === null && components['tracked-controls']) {\r\n\t\t\t\tthis.gamepadIndex = components['tracked-controls'].data.controller;\r\n\t\t\t}\r\n\r\n\t\t\tthis.el.setAttribute('tracked-controls', 'id', altspace.getGamepads()[this.gamepadIndex].id);\r\n\t\t\tthis.el.setAttribute('tracked-controls', 'controller', 0);\r\n\t\t\tthis.systemGamepads = this.trackedControlsSystem.controllers.length;\r\n\t\t}\r\n\t}\r\n}\r\n","/**\r\n* @namespace altspace\r\n*/\r\n\r\n/**\r\n* The altspace component makes A-Frame apps compatible with AltspaceVR.\r\n*\r\n* **Note**: If you use the `embedded` A-Frame component on your scene, you must include it *before* the `altspace` component, or your app will silently fail.\r\n* @mixin altspace\r\n* @memberof altspace\r\n* @property {boolean} usePixelScale=`false` - Allows you to use A-Frame units as CSS pixels.\r\n* This is the default behavior for three.js apps, but not for A-Frame apps.\r\n* @property {string} verticalAlign=`middle` - Puts the origin at the `bottom`, `middle` (default),\r\n* or `top` of the Altspace enclosure.\r\n* @property {boolean} enclosuresOnly=`true` - Prevents the scene from being created if\r\n* enclosure is flat.\r\n* @property {boolean} fullspace=`false` - Puts the app into fullspace mode.\r\n*\r\n* @example\r\n* <head>\r\n*   <title>My A-Frame Scene</title>\r\n*   <script src=\"https://aframe.io/releases/0.3.0/aframe.min.js\"></script>\r\n*   <script src=\"https://cdn.rawgit.com/AltspaceVR/aframe-altspace-component/vAFRAME_ALTSPACE_VERSION/dist/aframe-altspace-component.min.js\"></script>\r\n* </head>\r\n* <body>\r\n*   <a-scene altspace>\r\n*     <a-entity geometry=\"primitive: box\" material=\"color: #C03546\"></a-entity>\r\n*   </a-scene>\r\n* </body>\r\n*/\r\n'use strict';\r\n\r\nimport {AFrameComponent} from './AFrameComponent';\r\n\r\nexport default class AltspaceComponent extends AFrameComponent\r\n{\r\n\tget schema(){\r\n\t\treturn {\r\n\t\t\tusePixelScale: { type: 'boolean', default: 'false'},\r\n\t\t\tverticalAlign: { type: 'string',  default: 'middle'},\r\n\t\t\tenclosuresOnly:{ type: 'boolean', default: 'true'},\r\n\t\t\tfullspace:     { type: 'boolean', default: 'false'}\r\n\t\t}\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tthis.version = 'AFRAME_ALTSPACE_VERSION';\r\n\t\tif(!this.el.object3D instanceof THREE.Scene){\r\n\t\t\tconsole.warn('aframe-altspace-component can only be attached to a-scene');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (window.altspace && window.altspace.inClient) {\r\n\t\t\tthis.el.setAttribute('vr-mode-ui', {enabled: false});\r\n\t\t\tthis.initRenderer();\r\n\t\t\tthis.initCursorEvents();\r\n\t\t\tthis.initCollisionEvents();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconsole.warn('aframe-altspace-component only works inside of AltspaceVR');\r\n\t\t}\r\n\t}\r\n\r\n\ttick(t, dt)\r\n\t{\r\n\t\tif(this.el.object3D.updateAllBehaviors)\r\n\t\t\tthis.el.object3D.updateAllBehaviors();\r\n\t}\r\n\r\n\t/*\r\n\t* Swap in Altspace renderer when running in AltspaceVR.\r\n\t*/\r\n\tinitRenderer()\r\n\t{\r\n\t\tlet scene = this.el.object3D;\r\n\t\taltspace.getEnclosure().then((e =>\r\n\t\t{\r\n\t\t\tif(this.data.fullspace){\r\n\t\t\t\te.requestFullspace();\r\n\t\t\t\te.addEventListener('fullspacechange', () => {\r\n\t\t\t\t\tscene.scale.setScalar(e.pixelsPerMeter);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (!this.data.usePixelScale || this.data.fullspace){\r\n\t\t\t\tscene.scale.setScalar(e.pixelsPerMeter);\r\n\t\t\t}\r\n\r\n\t\t\tswitch (this.data.verticalAlign) {\r\n\t\t\t\tcase 'bottom':\r\n\t\t\t\t\tscene.position.y -= e.innerHeight / 2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'top':\r\n\t\t\t\t\tscene.position.y += e.innerHeight / 2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'middle':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconsole.warn('Unexpected value for verticalAlign: ', this.data.verticalAlign);\r\n\t\t\t}\r\n\r\n\t\t\tif(this.data.enclosuresOnly && e.innerDepth === 1){\r\n\t\t\t\tthis.el.renderer.render(new THREE.Scene());\r\n\t\t\t\tthis.el.renderer = this.el.effect = oldRenderer;\r\n\r\n\t\t\t}\r\n\t\t}).bind(this));\r\n\r\n\t\tlet oldRenderer = this.el.renderer;\r\n\t\tlet renderer = this.el.renderer = this.el.effect = altspace.getThreeJSRenderer({\r\n\t\t\taframeComponentVersion: this.version\r\n\t\t});\r\n\r\n\t\tlet noop = function() {};\r\n\t\trenderer.setSize = noop;\r\n\t\trenderer.setPixelRatio = noop;\r\n\t\trenderer.setClearColor = noop;\r\n\t\trenderer.clear = noop;\r\n\t\trenderer.enableScissorTest = noop;\r\n\t\trenderer.setScissor = noop;\r\n\t\trenderer.setViewport = noop;\r\n\t\trenderer.getPixelRatio = noop;\r\n\t\trenderer.getMaxAnisotropy = noop;\r\n\t\trenderer.setFaceCulling = noop;\r\n\t\trenderer.context = {canvas: {}};\r\n\t\trenderer.shadowMap = {};\r\n\t}\r\n\r\n\t/*\r\n\t* Emulate A-Frame cursor events when running in AltspaceVR.\r\n\t*/\r\n\tinitCursorEvents()\r\n\t{\r\n\r\n\t\tlet scene = this.el.object3D;\r\n\t\tlet cursorEl = document.querySelector('a-cursor') || document.querySelector('a-entity[cursor]');\r\n\t\tif (cursorEl) {\r\n\t\t\t// Hide A-Frame cursor mesh.\r\n\t\t\tcursorEl.setAttribute('material', 'transparent', true);\r\n\t\t\tcursorEl.setAttribute('material', 'opacity', 0.0);\r\n\t\t}\r\n\r\n\t\tfunction emit(eventName, event)\r\n\t\t{\r\n\t\t\t// Fire events on intersected object and A-Frame cursor.\r\n\t\t\tlet targetEl = event.target.el;\r\n\t\t\tif (cursorEl){\r\n\t\t\t\tcursorEl.emit(eventName, { target: targetEl, ray: event.ray, point: event.point });\r\n\t\t\t}\r\n\r\n\t\t\tif (targetEl){\r\n\t\t\t\ttargetEl.emit(eventName, { target: targetEl, ray: event.ray, point: event.point });\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet cursordownObj = null;\r\n\t\tscene.addEventListener('cursordown', event => {\r\n\t\t\tcursordownObj = event.target;\r\n\t\t\temit('mousedown', event);\r\n\t\t});\r\n\r\n\t\tscene.addEventListener('cursorup', event => {\r\n\t\t\temit('mouseup', event);\r\n\t\t\tif (event.target.uuid === cursordownObj.uuid) {\r\n\t\t\t\temit('click', event);\r\n\t\t\t}\r\n\t\t\tcursordownObj = null;\r\n\t\t});\r\n\r\n\t\tscene.addEventListener('cursorenter', event => {\r\n\t\t\tif (!event.target.el){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tevent.target.el.addState('hovered');\r\n\t\t\tif (cursorEl){\r\n\t\t\t\tcursorEl.addState('hovering');\r\n\t\t\t}\r\n\t\t\temit('mouseenter', event);\r\n\t\t});\r\n\r\n\t\tscene.addEventListener('cursorleave', event => {\r\n\t\t\tif (!event.target.el){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tevent.target.el.removeState('hovered');\r\n\t\t\tif (cursorEl){\r\n\t\t\t\tcursorEl.removeState('hovering');\r\n\t\t\t}\r\n\t\t\temit('mouseleave', event);\r\n\t\t});\r\n    }\r\n\r\n\tinitCollisionEvents()\r\n\t{\r\n\t\tlet scene = this.el.object3D;\r\n\r\n\t\tfunction emit(eventName, event)\r\n\t\t{\r\n\t\t\tlet targetEl = event.target.el;\r\n\t\t\tif (!targetEl)\r\n\t\t\t\treturn;\r\n\r\n\t\t\t//remap target and other from object3Ds to aframe element\r\n\t\t\tevent.target = targetEl;\r\n\t\t\tif (event.other && event.other.el) {\r\n\t\t\t\tevent.other = event.other.el;\r\n\t\t\t}\r\n\t\t\ttargetEl.emit(eventName, event);\r\n\t\t};\r\n\r\n\t\tscene.addEventListener('collisionenter', event => {\r\n\t\t\temit('collisionenter', event);\r\n\t\t});\r\n\r\n\t\tscene.addEventListener('collisionexit', event => {\r\n\t\t\temit('collisionexit', event);\r\n\t\t});\r\n\r\n\t\tscene.addEventListener('triggerenter', event => {\r\n\t\t\temit('triggerenter', event);\r\n\t\t});\r\n\r\n\t\tscene.addEventListener('triggerexit', event => {\r\n\t\t\temit('triggerexit', event);\r\n\t\t});\r\n\r\n    }\r\n}\r\n","/**\r\n* Sync the color property of the object between clients.\r\n* Requires both a {@link sync.sync-system} component on the `a-scene`, and a\r\n* {@link sync.sync} component on the target entity.\r\n* @mixin sync-color\r\n* @memberof sync\r\n*/\r\n'use strict';\r\n\r\nimport {AFrameComponent} from './AFrameComponent';\r\n\r\nexport default class SyncColor extends AFrameComponent\r\n{\r\n\tget dependencies(){\r\n\t\treturn ['sync'];\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tlet component = this;\r\n\t\tlet sync = component.el.components.sync;\r\n\r\n\t\t// wait for firebase connection to start sync routine\r\n\t\tif(sync.isConnected)\r\n\t\t\tstart();\r\n\t\telse\r\n\t\t\tcomponent.el.addEventListener('connected', start);\r\n\r\n\t\tfunction start()\r\n\t\t{\r\n\t\t\tlet colorRef = sync.dataRef.child('material/color');\r\n\t\t\tlet refChangedLocked = false;\r\n\t\t\tlet firstValue = true;\r\n\r\n\t\t\tcomponent.el.addEventListener('componentchanged', event =>\r\n\t\t\t{\r\n\t\t\t\tlet name = event.detail.name;\r\n\t\t\t\tlet oldData = event.detail.oldData;\r\n\t\t\t\tlet newData = event.detail.newData;\r\n\r\n\t\t\t\tif (name === 'material' && !refChangedLocked && oldData.color !== newData.color && sync.isMine)\r\n\t\t\t\t{\r\n\t\t\t\t\t//For some reason A-Frame has a misconfigured material reference if we do this too early\r\n\t\t\t\t\tsetTimeout(() => colorRef.set(newData.color), 0);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tcolorRef.on('value', snapshot => {\r\n\t\t\t\tif(!sync.isMine || firstValue)\r\n\t\t\t\t{\r\n\t\t\t\t\tlet color = snapshot.val();\r\n\r\n\t\t\t\t\trefChangedLocked = true;\r\n\t\t\t\t\tcomponent.el.setAttribute('material', 'color', color);\r\n\t\t\t\t\trefChangedLocked = false;\r\n\r\n\t\t\t\t\tfirstValue = false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n}\r\n","/**\r\n* Enables the synchronization of properties of entities. All property sync components\r\n* require both a {@link sync.sync-system} on `a-scene`, and a {@link sync.sync}\r\n* on the entity to be synced.\r\n* @name sync\r\n* @namespace sync\r\n* @example\r\n* <a-scene sync-system='app: example sync; author: altspacevr'>\r\n*   <a-entity sync='ownOn: cursordown' sync-color></a-entity>\r\n* </a-scene>\r\n*/\r\n\r\n/**\r\n* Enables the synchronization of properties of the entity. Must be used in\r\n* conjuction with the {@link sync.sync-system} component and a component for a\r\n* specific property (e.g. {@link sync.sync-transform}).\r\n* @memberof sync\r\n* @mixin sync\r\n* @prop {string} ownOn - The name of the event, or a list of events, that\r\n* will cause the local client to take ownership of this object. This field\r\n* cannot be updated after initialization.\r\n*/\r\n\r\nimport {AFrameComponent} from './AFrameComponent';\r\n\r\nexport default class SyncComponent extends AFrameComponent\r\n{\r\n\tconstructor(isComponent = false)\r\n\t{\r\n\t\tthis._isComponent = isComponent;\r\n\r\n\t\tthis.scene = undefined;\r\n\t\tthis.syncSys = undefined;\r\n\t\tthis.ref = undefined;\r\n\t\tthis.key = undefined;\r\n\t\tthis.dataRef = undefined;\r\n\t\tthis.ownerRef = undefined;\r\n\t\tthis.ownerId = undefined;\r\n\r\n\t\tthis.isConnected = false;\r\n\r\n\t\t/**\r\n\t\t* Indicates whether the sync ownership is yours.\r\n\t\t* @member sync.sync#isMine\r\n\t\t* @readonly\r\n\t\t*/\r\n\t\tthis.isMine = false;\r\n\t}\r\n\r\n\tget schema(){\r\n\t\treturn {\r\n\t\t\tmode: { default: 'link' },\r\n\t\t\townOn: { type: 'string' } //cannot be changed after creation\r\n\t\t};\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tthis.scene = this.el.sceneEl;\r\n\t\tthis.syncSys = this.scene.systems['sync-system'];\r\n\r\n\t\tif(this.syncSys.isConnected)\r\n\t\t\tstart();\r\n\t\telse\r\n\t\t\tthis.scene.addEventListener('connected', this.start.bind(this));\r\n\r\n\t\tif(this.data.ownOn)\r\n\t\t{\r\n\t\t\tlet ownershipEvents = this.data.ownOn.split(/[ ,]+/);\r\n\t\t\townershipEvents.forEach((e => {\r\n\t\t\t\tthis.el.addEventListener(e, (() => {\r\n\t\t\t\t\tif(this.isConnected){\r\n\t\t\t\t\t\tthis.takeOwnership();\r\n\t\t\t\t\t}\r\n\t\t\t\t}).bind(this));\r\n\t\t\t}).bind(this));\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t* Tell sync to start pushing local property values instead of updating\r\n\t* local from remote values.\r\n\t* @method sync.sync#takeOwnership\r\n\t*/\r\n\ttakeOwnership()\r\n\t{\r\n\t\tthis.ownerRef.set(this.syncSys.clientId);\r\n\r\n\t\t//clear our ownership if we disconnect\r\n\t\t//this is needed if we are the last user in the room, but we expect people to join later\r\n\t\tthis.ownerRef.onDisconnect().set(null);\r\n\t}\r\n\r\n\tstart()\r\n\t{\r\n\t\t//Make sure someone always owns an object. If the owner leaves and we are the master client, we will take it.\r\n\t\t//This ensures, for example, that synced animations keep playing\r\n\t\tthis.scene.addEventListener('clientleft', (event => {\r\n\t\t\tlet shouldTakeOwnership = (!ownerId || ownerId === event.detail.id) && this.syncSys.isMasterClient;\r\n\t\t\tif(shouldTakeOwnership)\r\n\t\t\t\tthis.takeOwnership();\r\n\t\t}).bind(this));\r\n\r\n\t\tif (this.data.mode === 'link') {\r\n\t\t\tlet id = this.el.id;\r\n\t\t\tif (!id) {\r\n\t\t\t\tconsole.error('Entities cannot be synced using link mode without an id.');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconsole.log('syncSys: ' + this.syncSys);\r\n\t\t\tconsole.log('syncSys.sceneRef: ' + this.syncSys.sceneRef);\r\n\r\n\t\t\tthis.link(this.syncSys.sceneRef.child(id));\r\n\t\t\tthis.setupReceive();\r\n\r\n\t\t} else {\r\n\t\t\tconsole.error('Unsupported sync mode: ' + this.data.mode);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.isConnected = true;\r\n\t\tthis.el.emit('connected', null, false);\r\n\t}\r\n\r\n\tlink(entityRef)\r\n\t{\r\n\t\tthis.ref = entityRef;\r\n\t\tthis.key = this.ref.key();\r\n\t\tthis.dataRef = this.ref.child('data');\r\n\t\tthis.ownerRef = this.ref.child('owner');\r\n\t}\r\n\r\n\tsetupReceive()\r\n\t{\r\n\t\t//if nobody has owned the object yet, we will.\r\n\t\tthis.ownerRef.transaction((owner => {\r\n\t\t\tif (owner) return undefined;\r\n\t\t\tthis.ownerRef.onDisconnect().set(null);\r\n\t\t\treturn this.syncSys.clientId;\r\n\t\t}).bind(this));\r\n\r\n\t\tthis.ownerRef.on('value', (snapshot =>\r\n\t\t{\r\n\t\t\tlet newOwnerId = snapshot.val();\r\n\t\t\tlet gained = newOwnerId === this.syncSys.clientId && !this.isMine;\r\n\t\t\tif (gained)\r\n\t\t\t\tthis.el.emit('ownershipgained', null, false);\r\n\r\n\t\t\t//note this also fires when we start up without ownership\r\n\t\t\tlet lost = newOwnerId !== this.syncSys.clientId && this.isMine;\r\n\t\t\tif (lost){\r\n\t\t\t\tthis.el.emit('ownershiplost', null, false);\r\n\r\n\t\t\t\t//we no longer have to clear our ownership when we disconnect\r\n\t\t\t\tthis.ownerRef.onDisconnect().cancel();\r\n\t\t\t}\r\n\r\n\t\t\tthis.ownerId = newOwnerId;\r\n\r\n\t\t\tthis.isMine = newOwnerId === this.syncSys.clientId;\r\n\t\t}).bind(this));\r\n\t}\r\n}\r\n","/**\r\n* Connect to a remote Firebase server, and facilitate synchronization. These\r\n* options correspond exactly with the configuration options for\r\n* [altspace.utilities.sync.connect]{@link http://altspacevr.github.io/AltspaceSDK/doc/module-altspace_utilities_sync.html#.connect}.\r\n* This component must be present on `a-scene` for any other sync components to work.\r\n* @memberof sync\r\n* @mixin sync-system\r\n* @prop {string} author - A unique identifier for you or your organization.\r\n* @prop {string} app - The name of the app.\r\n* @prop {string} refUrl - Override the base reference. Set this to use your own Firebase.\r\n* @prop {string} instance - Override the instance ID. Can also be overridden with\r\n* a URL parameter.\r\n* @method {boolean} isMasterClient - Returns true if the local client is the master client.\r\n*/\r\n'use strict';\r\n\r\nimport {AFrameSystem} from './AFrameComponent';\r\n\r\nexport default class SyncSystem extends AFrameSystem\r\n{\r\n\tget schema(){\r\n\t\treturn {\r\n\t\t\tauthor: { type: 'string', default: null },\r\n\t\t\tapp: { type: 'string', default: null },\r\n\t\t\tinstance: { type: 'string', default: null },\r\n\t\t\trefUrl: { type: 'string', default: null }\r\n\t\t};\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tif(!this.data || !this.data.app){\r\n\t\t\tconsole.warn('The sync-system must be present on the scene and configured with required data.');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconsole.log(this.data);\r\n\r\n\t\tthis.isConnected = false;\r\n\t\taltspace.utilities.sync.connect({\r\n\t\t\tauthorId: this.data.author,\r\n\t\t\tappId: this.data.app,\r\n\t\t\tinstanceId: this.data.instance,\r\n\t\t\tbaseRefUrl: this.data.refUrl\r\n\t\t}).then(this.connected.bind(this));\r\n\t}\r\n\r\n\tconnected(connection)\r\n\t{\r\n\t\tthis.connection = connection;\r\n\r\n\t\tthis.sceneRef = this.connection.instance.child('scene');\r\n\t\tthis.clientsRef = this.connection.instance.child('clients');\r\n\r\n\t\t// temporary way of having unique identifiers for each client\r\n\t\tthis.clientId = this.sceneEl.object3D.uuid;\r\n\t\tthis.masterClientId = null;\r\n\r\n\t\tlet self = this;\r\n\r\n\t\t// local client connected\r\n\t\tthis.clientsRef.on(\"value\", snapshot => {\r\n\t\t\tlet clientIds = snapshot.val();\r\n\t\t\tlet masterClientKey = Object.keys(clientIds)[0];\r\n\t\t\tself.masterClientId = clientIds[masterClientKey];\r\n\t\t});\r\n\r\n\t\t// remote client connected\r\n\t\tthis.clientsRef.on('child_added', childSnapshot => {\r\n\t\t\tlet joinedClientId = childSnapshot.val();\r\n\t\t\t//let the master client flag get set first\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tself.sceneEl.emit('clientjoined', {id: joinedClientId}, false);\r\n\t\t\t}, 0);\r\n\t\t});\r\n\r\n\t\t// remote client disconnected\r\n\t\tthis.clientsRef.on('child_removed', childSnapshot => {\r\n\t\t\tlet leftClientId = childSnapshot.val();\r\n\t\t\t//let the master client flag get set first\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tself.sceneEl.emit('clientleft', {id: leftClientId}, false);\r\n\t\t\t}, 0);\r\n\t\t});\r\n\r\n\t\t// add our client ID to the list of connected clients,\r\n\t\t// but have it be automatically removed by firebase if we disconnect for any reason\r\n\t\tthis.clientsRef.push(this.clientId).onDisconnect().remove();\r\n\r\n\t\tthis.connection.instance.child('initialized').once('value', snapshot => {\r\n\t\t\tlet shouldInitialize = !snapshot.val();\r\n\t\t\tsnapshot.ref().set(true);\r\n\r\n\t\t\tself.sceneEl.emit('connected', { shouldInitialize: shouldInitialize }, false);\r\n\t\t\tself.isConnected = true;\r\n\t\t});\r\n\t}\r\n\r\n\tisMasterClient()\r\n\t{\r\n\t\treturn this.masterClientId === this.clientId;\r\n\t}\r\n}\r\n","//TODO: We need to figure out a way to recieve our first update without caring about ownership.\r\n// firstValue is probably not the right way to go, probably something about having sent yet. Need to change for both\r\n\r\n/**\r\n* Synchronize the position, rotation, and scale of this object with all clients.\r\n* Requires both a {@link sync.sync-system} component on the `a-scene`, and a\r\n* {@link sync.sync} component on the target entity.\r\n* @mixin sync-transform\r\n* @memberof sync\r\n*/\r\nAFRAME.registerComponent('sync-transform',\r\n{\r\n\tdependencies: ['sync'],\r\n\tschema: {\r\n\t},\r\n\tinit: function () {\r\n\t\tvar component = this;\r\n\t\tvar sync = component.el.components.sync;\r\n\t\tif(sync.isConnected) start(); else component.el.addEventListener('connected', start);\r\n\r\n\t\tfunction start(){\r\n\r\n\t\t\tvar positionRef = sync.dataRef.child('position');\r\n\t\t\tvar rotationRef = sync.dataRef.child('rotation');\r\n\t\t\tvar scaleRef = sync.dataRef.child('scale');\r\n\r\n\t\t\tcomponent.updateRate = 100;\r\n\r\n\t\t\tvar stoppedAnimations = [];\r\n\t\t\t//pause all animations on ownership loss\r\n\t\t\tcomponent.el.addEventListener('ownershiplost', function() {\r\n\t\t\t\tvar children = component.el.children;\r\n\t\t\t\tfor (var i = 0; i < children.length; i++) {\r\n\t\t\t\t\tvar tagName = children[i].tagName.toLowerCase();\r\n\t\t\t\t\tif (tagName === \"a-animation\") {\r\n\t\t\t\t\t\tstoppedAnimations.push(children[i]);\r\n\t\t\t\t\t\tchildren[i].stop();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tcomponent.el.addEventListener('ownershipgained', function () {\r\n\t\t\t\tfor (var i = 0; i < stoppedAnimations.length; i++) {\r\n\t\t\t\t\tvar animation = stoppedAnimations[i];\r\n\t\t\t\t\tanimation.start();\r\n\t\t\t\t}\r\n\t\t\t\tstoppedAnimations = [];\r\n\t\t\t});\r\n\r\n\t\t\tfunction onTransform(snapshot, componentName) {\r\n\t\t\t\tif (sync.isMine) return;\r\n\r\n\t\t\t\tvar value = snapshot.val();\r\n\t\t\t\tif (!value) return;\r\n\r\n\t\t\t\tcomponent.el.setAttribute(componentName, value);\r\n\t\t\t}\r\n\r\n\t\t\tpositionRef.on('value', function (snapshot) {\r\n\t\t\t\tonTransform(snapshot, 'position');\r\n\t\t\t});\r\n\r\n\t\t\trotationRef.on('value', function (snapshot) {\r\n\t\t\t\tonTransform(snapshot, 'rotation');\r\n\t\t\t});\r\n\r\n\t\t\tscaleRef.on('value', function (snapshot) {\r\n\t\t\t\tonTransform(snapshot, 'scale');\r\n\t\t\t});\r\n\r\n\t\t\tvar sendPosition = throttle(function(value){\r\n\t\t\t\tpositionRef.set(value);\r\n\t\t\t}, component.updateRate);\r\n\r\n\t\t\tvar sendRotation = throttle(function(value){\r\n\t\t\t\trotationRef.set(value);\r\n\t\t\t}, component.updateRate);\r\n\r\n\t\t\tvar sendScale = throttle(function(value){\r\n\t\t\t\tscaleRef.set(value);\r\n\t\t\t}, component.updateRate);\r\n\r\n\t\t\tfunction onComponentChanged(event){\r\n\t\t\t\tif (!sync.isMine) return;\r\n\r\n\t\t\t\tvar name = event.detail.name;\r\n\t\t\t\tvar newData = event.detail.newData;\r\n\r\n\t\t\t\tif (name === 'position') {\r\n\t\t\t\t\tsendPosition(newData);\r\n\t\t\t\t} else if (name === 'rotation') {\r\n\t\t\t\t\tsendRotation(newData);\r\n\t\t\t\t} else if (name === 'scale') {\r\n\t\t\t\t\tsendScale(newData);\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//from underscore.js\r\n\t\t\tfunction throttle(func, wait, options) {\r\n\t\t\t\tvar timeout, context, args, result;\r\n\t\t\t\tvar previous = 0;\r\n\t\t\t\tif (!options) options = {};\r\n\r\n\t\t\t\tvar later = function() {\r\n\t\t\t\t  previous = options.leading === false ? 0 : Date.now();\r\n\t\t\t\t  timeout = null;\r\n\t\t\t\t  result = func.apply(context, args);\r\n\t\t\t\t  if (!timeout) context = args = null;\r\n\t\t\t\t};\r\n\r\n\t\t\t\tvar throttled = function() {\r\n\t\t\t\t  var now = Date.now();\r\n\t\t\t\t  if (!previous && options.leading === false) previous = now;\r\n\t\t\t\t  var remaining = wait - (now - previous);\r\n\t\t\t\t  context = this;\r\n\t\t\t\t  args = arguments;\r\n\t\t\t\t  if (remaining <= 0 || remaining > wait) {\r\n\t\t\t\t\tif (timeout) {\r\n\t\t\t\t\t  clearTimeout(timeout);\r\n\t\t\t\t\t  timeout = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tprevious = now;\r\n\t\t\t\t\tresult = func.apply(context, args);\r\n\t\t\t\t\tif (!timeout) context = args = null;\r\n\t\t\t\t  } else if (!timeout && options.trailing !== false) {\r\n\t\t\t\t\ttimeout = setTimeout(later, remaining);\r\n\t\t\t\t  }\r\n\t\t\t\t  return result;\r\n\t\t\t\t};\r\n\r\n\t\t\t\tthrottled.cancel = function() {\r\n\t\t\t\t  clearTimeout(timeout);\r\n\t\t\t\t  previous = 0;\r\n\t\t\t\t  timeout = context = args = null;\r\n\t\t\t\t};\r\n\r\n\t\t\t\treturn throttled;\r\n\t\t\t  };\r\n\r\n\r\n\t\t\tcomponent.el.addEventListener('componentchanged', onComponentChanged);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nexport default null;\r\n","/**\r\n* Synchronize the playback state of an {@link n.n-sound} component between clients.\r\n* Requires both a {@link sync.sync-system} component on the `a-scene`, and a\r\n* {@link sync.sync} component on the target entity.\r\n* @mixin sync-n-sound\r\n* @memberof sync\r\n*/\r\n'use strict';\r\n\r\nimport {AFrameComponent} from './AFrameComponent';\r\n\r\nexport default class SyncNSound extends AFrameComponent\r\n{\r\n\tget dependencies(){\r\n\t\treturn ['sync'];\r\n\t}\r\n}\r\n\r\nAFRAME.registerComponent('sync-n-sound',\r\n{\r\n\tdependencies: ['sync'],\r\n\tschema: { },\r\n\tinit: function () {\r\n\t\tvar component = this;\r\n\t\tvar sync = component.el.components.sync;\r\n\t\tvar scene = document.querySelector('a-scene');\r\n\t\tvar syncSys = scene.systems['sync-system'];\r\n\t\tif(sync.isConnected) start(); else component.el.addEventListener('connected', start);\r\n\r\n\t\tfunction start(){\r\n\t\t\tcomponent.soundStateRef = sync.dataRef.child('sound/state');\r\n\t\t\tcomponent.soundEventRef = sync.dataRef.child('sound/event');\r\n\r\n\t\t\tfunction sendEvent(event) {\r\n\t\t\t\tif (!sync.isMine) return;\r\n\t\t\t\tvar event = {\r\n\t\t\t\t\ttype: event.type,\r\n\t\t\t\t\tsender: syncSys.clientId,\r\n\t\t\t\t\tel: component.el.id,\r\n\t\t\t\t\ttime: Date.now()\r\n\t\t\t\t};\r\n\t\t\t\tcomponent.soundEventRef.set(event);\r\n\t\t\t}\r\n\r\n\t\t\tcomponent.el.addEventListener('sound-played', sendEvent);\r\n\t\t\tcomponent.el.addEventListener('sound-paused', sendEvent);\r\n\r\n\t\t\tcomponent.soundEventRef.on('value', function (snapshot) {\r\n\t\t\t\tif (sync.isMine) return;\r\n\t\t\t\tvar event = snapshot.val();\r\n\t\t\t\tif (!event) return;\r\n\t\t\t\tif (event.el === component.el.id) {\r\n\t\t\t\t\tvar sound = component.el.components['n-sound'];\r\n\t\t\t\t\tif (event.type === 'sound-played') {\r\n\t\t\t\t\t\tsound.playSound();\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tsound.pauseSound();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tcomponent.el.addEventListener('componentchanged', function (event) {\r\n\t\t\t\tif (!sync.isMine) return;\r\n\t\t\t\tvar name = event.detail.name;\r\n\t\t\t\tif (name !== 'n-sound') return;\r\n\t\t\t\tcomponent.soundStateRef.set(event.detail.newData);\r\n\t\t\t});\r\n\r\n\t\t\tcomponent.soundStateRef.on('value', function (snapshot) {\r\n\t\t\t\tif (sync.isMine) return;\r\n\t\t\t\tvar state = snapshot.val();\r\n\t\t\t\tif (!state) return;\r\n\t\t\t\tcomponent.el.setAttribute('n-sound', state);\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\tremove: function () {\r\n\t\tthis.soundStateRef.off('value');\r\n\t\tthis.soundEventRef.off('value');\r\n\t}\r\n});\r\n","'use strict';\r\n\r\nif (typeof AFRAME === 'undefined') {\r\n    throw new Error('Component attempted to register before AFRAME was available.');\r\n}\r\n\r\nimport {registerComponentClass, registerSystemClass, flatten} from './AFrameComponent';\r\n\r\nimport AltspaceCursorCollider from './AltspaceCursorCollider';\r\nregisterComponentClass('altspace-cursor-collider', AltspaceCursorCollider);\r\n\r\nimport AltspaceTrackedControls from './AltspaceTrackedControls';\r\nregisterComponentClass('altspace-tracked-controls', AltspaceTrackedControls);\r\n\r\nimport AltspaceComponent from './AltspaceComponent';\r\nregisterComponentClass('altspace', AltspaceComponent);\r\n\r\nimport SyncColor from './SyncColor';\r\nregisterComponentClass('sync-color', SyncColor);\r\n\r\nimport SyncComponent from './SyncComponent';\r\nregisterComponentClass('sync', SyncComponent);\r\n\r\nimport SyncSystem from './SyncSystem';\r\nregisterSystemClass('sync-system', SyncSystem);\r\n\r\nimport SyncTransform from './sync-transform';\r\nimport SyncNSound from './sync-n-sound';\r\nimport NativeComponents from './native-components';\r\nimport Wire from './wire';\r\n\r\nexport {AltspaceComponent, AltspaceCursorCollider, AltspaceTrackedControls, SyncSystem, SyncComponent, SyncColor, flatten };\r\n","\r\n/**\r\n* This set of components map to various objects and effects that are provided\r\n* natively by AltspaceVR. Your management of these objects may be limited to\r\n* some degree, but they will tend to be more performant than SDK equivalents,\r\n* or may provide some functionality not otherwise available to the SDK.\r\n* @namespace native\r\n*/\r\n(function () {\r\n\tif (!window.altspace || !altspace.inClient) {\r\n\t\tvar noop = function () {};\r\n\t\twindow.altspace = {\r\n\t\t\taddNativeComponent: noop,\r\n\t\t\tupdateNativeComponent: noop,\r\n\t\t\tremoveNativeComponent: noop\r\n\t\t};\r\n\t}\r\n\r\n\tvar placeholderGeometry = new THREE.BoxGeometry(0.001, 0.001, 0.001);\r\n\tvar placeholderMaterial = new THREE.MeshBasicMaterial({ color: 0x000000 });\r\n\tplaceholderMaterial.visible = false;\r\n\tvar PlaceholderMesh = function () {\r\n\t\tTHREE.Mesh.call( this, placeholderGeometry, placeholderMaterial );\r\n\t};\r\n\tPlaceholderMesh.prototype = Object.create( THREE.Mesh.prototype );\r\n\tPlaceholderMesh.prototype.constructor = THREE.PlaceholderMesh;\r\n\r\n\tfunction meshInit(mesh) {\r\n\t\t//If you attach native components to an entity, it will not use a default collider\r\n\t\tmesh.userData.altspace = mesh.userData.altspace || {};\r\n\t\tmesh.userData.altspace.collider = mesh.userData.altspace.collider || {};\r\n\t\tmesh.userData.altspace.collider.enabled = false;\r\n\r\n\t\taltspace.addNativeComponent(mesh, this.name);\r\n\t}\r\n\r\n\tfunction nativeComponentInit() {\r\n\t\tvar mesh = this.el.getOrCreateObject3D('mesh', PlaceholderMesh);\r\n\r\n\t\tmeshInit.call(this, mesh);\r\n\r\n\t\t//to pass defaults\r\n\t\tthis.update(this.data);\r\n\t}\r\n\tfunction nativeComponentRemove() {\r\n\t\tvar mesh = this.el.getObject3D('mesh');\r\n\t\taltspace.removeNativeComponent(mesh, this.name);\r\n\t}\r\n\tfunction nativeComponentUpdate(oldData) {\r\n\t\taltspace.updateNativeComponent(this.el.object3DMap.mesh, this.name, this.data);\r\n\t}\r\n\r\n\tfunction callComponent(functionName, functionArguments) {\r\n\t\taltspace.callNativeComponent(this.el.object3DMap.mesh, this.name, functionName, functionArguments)\r\n\t}\r\n\r\n\t/**\r\n\t* Attach a given native object to this entity.\r\n\t* @mixin n-object\r\n\t* @memberof native\r\n\t* @prop {string} res - The identifier for the resource you want. This component\r\n\t* can accept all resources except for `interactables`.\r\n\t* @example <a-entity n-object='res:architecture/wall-4w-4h'></a-entity>\r\n\t*/\r\n\tAFRAME.registerComponent('n-object', {\r\n\t\tschema: {\r\n\t\t\tres: {type: 'string'}\r\n\t\t},\r\n\t\tinit: nativeComponentInit,\r\n\t\tupdate: nativeComponentUpdate,\r\n\t\tremove: nativeComponentRemove\r\n\t});\r\n\r\n\t/**\r\n\t* Create an object that spawns additional copies of itself when grabbed by a user (the copies are not spawners themselves).\r\n\t* These copies will be physically interactive and automatically synchronized\r\n\t* between users.\r\n\t* @mixin n-spawner\r\n\t* @memberof native\r\n\t* @prop {string} res - The identifier for the resource you want. This component\r\n\t* can only accept resources of type `interactables`.\r\n\t* @example <a-entity n-spawner='res: interactables/basketball'></a-entity>\r\n\t*/\r\n\tAFRAME.registerComponent('n-spawner', {\r\n\t\tschema: {\r\n\t\t\tres: {type: 'string'}\r\n\t\t},\r\n\t\tinit: nativeComponentInit,\r\n\t\tupdate: nativeComponentUpdate,\r\n\t\tremove: nativeComponentRemove\r\n\t});\r\n\r\n\t/**\r\n\t* Creates dynamic 2D text on the entity. The text will wrap automatically based on the width and height provided.\r\n\t* This text will be clearer than texture-based text and more performant than geometry-based test.\r\n\t* @mixin n-text\r\n\t* @memberof native\r\n\t* @prop {string} text - The text to be drawn.\r\n\t* @prop {number} fontSize=10 - The height of the letters. 10pt ~= 1m\r\n\t* @prop {number} width=10 - The width of the text area in meters. If the\r\n\t* text is wider than this value, the overflow will be wrapped to the next line.\r\n\t* @prop {number} height=1 - The height of the text area in meters. If the\r\n\t* text is taller than this value, the overflow will be cut off.\r\n\t* @prop {string} horizontalAlign=middle - The horizontal anchor point for\r\n\t* the text. Can be `left`, `middle`, or `right`.\r\n\t* @prop {string} verticalAlign=middle - The vertical anchor point for the\r\n\t* text. Can be `top`, `middle`, or `bottom`.\r\n\t*/\r\n\tAFRAME.registerComponent('n-text', {\r\n\t\tinit: nativeComponentInit,\r\n\t\tupdate: nativeComponentUpdate,\r\n\t\tremove: nativeComponentRemove,\r\n\t\tschema: {\r\n\t\t\ttext: { default: '', type: 'string' },\r\n\t\t\t/*color: { default: 'white',\r\n\t\t\t\tparse: function(value) {\r\n\t\t\t\t\treturn parseFloat(value, 10);\r\n\t\t\t\t},\r\n\t\t\t\tstringify: function(value) {\r\n\t\t\t\t\treturn value.toString();\r\n\t\t\t\t}},*/\r\n\t\t\tfontSize: { default: '10', type: 'int' },//roughly a meter tall\r\n\t\t\twidth: { default: '10', type: 'number' },//in meters\r\n\t\t\theight: { default: '1', type: 'number' },//in meters\r\n\t\t\thorizontalAlign: { default: 'middle'},\r\n\t\t\tverticalAlign: { default: 'middle'}\r\n\t\t}\r\n\t});\r\n\r\n\t//object: collides against: objects / enviroment / cursor\r\n\t//environment: can be teleported onto, and collides against: objects / environment / cursor\r\n\t//hologram: collides against: cursor / holograms\r\n\r\n\t/**\r\n\t* Abstract base class for {@link n.n-sphere-collider}, {@link n.n-box-collider},\r\n\t* {@link n.n-capsule-collider}, and {@link n.n-mesh-collider}. You cannot use\r\n\t* this class directly, but instead you should add one of those components\r\n\t* to your objects.\r\n\t* @name n-collider\r\n\t* @mixin n-collider\r\n\t* @memberof native\r\n\t* @prop {vec3} center=0,0,0 - The offset of the collider in local space.\r\n\t* @prop {string} type=hologram - The type of collider, one of: `object` | `environment` | `hologram`.\r\n\t* Object colliders collide with other objects, the environment, and the cursor.\r\n\t* Environment colliders collide with everything objects do, but you can also\r\n\t* teleport onto them. Hologram colliders only collide with other holograms and\r\n\t* the cursor.\r\n\t*/\r\n\r\n\t/**\r\n\t* Create a spherical collider on this entity.\r\n\t* @mixin n-sphere-collider\r\n\t* @memberof native\r\n\t* @extends native.n-collider\r\n\t* @prop {number} radius=1 - The size of the collider in meters.\r\n\t*/\r\n\tAFRAME.registerComponent('n-sphere-collider', {\r\n\t\tinit:nativeComponentInit,\r\n\t\tremove: nativeComponentRemove,\r\n\t\tupdate: nativeComponentUpdate,\r\n\t\tschema: {\r\n\t\t\tisTrigger: { default: false, type: 'boolean' },\r\n\t\t\tcenter: { type: 'vec3' },\r\n\t\t\tradius: { default: '0', type: 'number' },\r\n\t\t\ttype: {default: 'object'}\r\n\t\t}\r\n\t});\r\n\r\n\r\n\t/**\r\n\t* Create a box-shaped collider on this entity.\r\n\t* @mixin n-box-collider\r\n\t* @memberof native\r\n\t* @extends native.n-collider\r\n\t* @prop {vec3} size=1,1,1 - The dimensions of the collider.\r\n\t*/\r\n\tAFRAME.registerComponent('n-box-collider', {\r\n\t\tinit:nativeComponentInit,\r\n\t\tremove: nativeComponentRemove,\r\n\t\tupdate: nativeComponentUpdate,\r\n\t\tschema: {\r\n\t\t\tisTrigger: { default: false, type: 'boolean' },\r\n\t\t\tcenter: { type: 'vec3' },\r\n\t\t\tsize: { type: 'vec3' },\r\n\t\t\ttype: {default: 'object'}\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t* Create a capsule-shaped collider on this entity. Capsules\r\n\t* are a union of a cylinder and two spheres on top and bottom.\r\n\t* @mixin n-capsule-collider\r\n\t* @memberof native\r\n\t* @extends native.n-collider\r\n\t* @prop {number} radius=1 - The radius of the capsule in meters.\r\n\t* @prop {number} height=1 - The height of the shaft of the capsule in meters.\r\n\t* @prop {string} direction=y - The axis with which the capsule is aligned.\r\n\t* One of `x`, `y`, or `z`.\r\n\t*/\r\n\tAFRAME.registerComponent('n-capsule-collider', {\r\n\t\tinit:nativeComponentInit,\r\n\t\tremove: nativeComponentRemove,\r\n\t\tupdate: nativeComponentUpdate,\r\n\t\tschema: {\r\n\t\t\tisTrigger: { default: false, type: 'boolean' },\r\n\t\t\tcenter: { type: 'vec3' },\r\n\t\t\tradius: { default: '0', type: 'number' },\r\n\t\t\theight: { default: '0', type: 'number' },\r\n\t\t\tdirection: { default: 'y' },\r\n\t\t\ttype: {default: 'object'}\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t* Enable collision for the entire attached mesh. This is expensive to evaluate, so should only be used on\r\n\t* low-poly meshes.\r\n\t* @mixin n-mesh-collider\r\n\t* @memberof native\r\n\t* @extends native.n-collider\r\n\t* @example <a-box n-mesh-collider></a-box>\r\n\t* @prop {bool} convex=true - Whether the collider should be convex or concave. Set this to false if you have holes\r\n\t* in your mesh. Convex colliders are limited to 255 triangles. Note: concave colliders can be significantly more\r\n\t* expensive comparet to conves colliders.\r\n\t*/\r\n\tAFRAME.registerComponent('n-mesh-collider', {\r\n\t\t_forEachMesh: function (func) {\r\n\t\t\tvar obj = this.el.object3DMap.mesh;\r\n\t\t\tif (!obj) { return; }\r\n\t\t\tif (obj instanceof THREE.Mesh) {\r\n\t\t\t\tfunc(obj);\r\n\t\t\t}\r\n\t\t\tobj.traverse(function (childObj) {\r\n\t\t\t\tif (childObj instanceof THREE.Mesh) {\r\n\t\t\t\t\tfunc(childObj);\r\n\t\t\t\t}\r\n\t\t\t}.bind(this));\r\n\t\t},\r\n\t\t_initObj: function () {\r\n\t\t\tthis._forEachMesh(function (mesh) {\r\n\t\t\t\tmeshInit.call(this, mesh);\r\n\r\n\t\t\t\t//to pass defaults\r\n\t\t\t\taltspace.updateNativeComponent(mesh, this.name, this.data);\r\n\t\t\t}.bind(this));\r\n\t\t},\r\n\t\tinit: function () {\r\n\t\t\t// Allow a-frame to create a PlaceholderMesh if there isn't already one, so that the native collider is\r\n\t\t\t// registered.\r\n\t\t\tthis.el.getOrCreateObject3D('mesh', PlaceholderMesh);\r\n\r\n\t\t\t// Initialize the existing mesh\r\n\t\t\tthis._initObj();\r\n\r\n\t\t\tthis.el.addEventListener('model-loaded', function () {\r\n\t\t\t\t// Re-initialize the collider if a new model is loaded\r\n\t\t\t\tthis._initObj();\r\n\t\t\t}.bind(this));\r\n\t\t},\r\n\t\tremove: function () {\r\n\t\t\tthis._forEachMesh(function (mesh) {\r\n\t\t\t\taltspace.removeNativeComponent(mesh, this.name);\r\n\t\t\t}.bind(this));\r\n\t\t},\r\n\t\tupdate: function (oldData) {\r\n\t\t\tthis._forEachMesh(function (mesh) {\r\n\t\t\t\taltspace.updateNativeComponent(mesh, this.name, this.data);\r\n\t\t\t}.bind(this));\r\n\t\t},\r\n\t\tschema: {\r\n\t\t\tisTrigger: { default: false, type: 'boolean' },\r\n\t\t\tconvex: { default: true, type: 'boolean' },\r\n\t\t\ttype: {default: 'object'}\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t* Make the object's +Z always face the viewer. Currently will only directly apply to main mesh or native component on the attached entity, not any children or submeshes.\r\n\t* @mixin n-billboard\r\n\t* @memberof native\r\n\t* @example <a-plane n-billboard></a-plane>\r\n\t*/\r\n\tAFRAME.registerComponent('n-billboard', {\r\n\t\tinit:nativeComponentInit,\r\n\t\tremove: nativeComponentRemove,\r\n\t});\r\n\r\n\t/**\r\n\t* A container keeps a running tally of how many objects are within\r\n\t* its bounds, and adds and removes the states `container-full` and\r\n\t* `container-empty` based on the current count of objects. Can fire three\r\n\t* special events: `container-full`, `container-empty`, and `container-count-changed`.\r\n\t* @mixin n-container\r\n\t* @memberof native\r\n\t* @prop {number} capacity=4 - The value at which the container will fire the\r\n\t* `container-full` event.\r\n\t*/\r\n\tAFRAME.registerComponent('n-container', {\r\n\t\tinit: function(){\r\n\t\t\tnativeComponentInit.call(this);\r\n\r\n\t\t\tvar el = this.el;\r\n\t\t\tvar component = this;\r\n\r\n\t\t\tel.addEventListener('stateadded', function(event){\r\n\t\t\t\tif(event.detail.state === 'container-full'){\r\n\t\t\t\t\tel.emit('container-full');\r\n\t\t\t\t}\r\n\t\t\t\tif(event.detail.state === 'container-empty'){\r\n\t\t\t\t\tel.emit('container-empty');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tel.addEventListener('container-count-changed', function(event){\r\n\t\t\t\tcomponent.count = event.detail.count;\r\n\t\t\t});\r\n\t\t},\r\n\t\tremove: nativeComponentRemove,\r\n\t\tupdate: nativeComponentUpdate,\r\n\t\tschema: {\r\n\t\t\tcapacity: { default: 4, type: 'number' },\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t* Play the sound given by the `src` or `res` property from the location\r\n\t* of the entity.\r\n\t* @mixin n-sound\r\n\t* @memberof native\r\n\t* @prop {string} res - The resource identifier for a built-in sound clip.\r\n\t* @prop {string} src - A URL to an external sound clip. The sound can be in WAV, OGG or MP3 format. However. only\r\n\t* WAV is supported on all platforms. MP3 is supported on Gear VR and OGG is supported on desktop.\r\n\t* @prop {string} on - The name of the event that will play this sound clip.\r\n\t* @prop {boolean} loop=false - Tells the clip to loop back to the beginning of the clip\r\n\t* once it's finished.\r\n\t* @prop {boolean} autoplay=false - Tells the clip to start automatically when\r\n\t* the scene loads, instead of waiting for `playSound()`.\r\n\t* @prop {boolean} oneshot=false - Tells the clip to clean itself up when it\r\n\t* finishes playing. Allows for overlapping instances of the sound.\r\n\t* @prop {number} volume=1 - The volume of the clip, from [0,1].\r\n\t* @prop {number} spatialBlend=1 - How spatialized a sound is, from [0,1].\r\n\t* A value of 1 will be fully localized, and the sound will pan left and\r\n\t* right as you turn your head. A value of 0 makes it non-spatialized, and\r\n\t* it will always be heard in both ears.\r\n\t* @prop {number} pitch=1 - The speed multiplier for the sound. 0.5 is one\r\n\t* octave down, and 2 is one octave up.\r\n\t* @prop {number} minDistance=1 - Inside this distance in meters,\r\n\t* the sound volume is at full volume.\r\n\t* @prop {number} maxDistance=12 - If rolloff is 'logarithmic', the sound will stop attenuating at this distance.\r\n\t* If rolloff is 'linear' or 'cosine', the sound will be silent at this distance.\r\n\t* @prop {string} rolloff='logarithmic' - Set this to 'linear' or 'cosine' if you want to cut sounds off at a\r\n\t* maxDistance.\r\n\t*/\r\n\t/**\r\n\t* Fired when a sound has loaded and is ready to be played\r\n\t* @event native.n-sound#n-sound-loaded\r\n\t*/\r\n\tAFRAME.registerComponent('n-sound', {\r\n\t\tinit: function () {\r\n\t\t\tvar src = this.data.src;\r\n\t\t\tif (src && !src.startsWith('http')) {\r\n\t\t\t\tif (src.startsWith('/')) {\r\n\t\t\t\t\tthis.data.src = location.origin + src;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tvar currPath = location.pathname;\r\n\t\t\t\t\tif (!currPath.endsWith('/')) {\r\n\t\t\t\t\t\tcurrPath = location.pathname.split('/').slice(0, -1).join('/') + '/';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.data.src = location.origin + currPath + src;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tnativeComponentInit.call(this);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t* Stop the playing sound, and preserve position in clip.\r\n\t\t* @method native.n-sound#pauseSound\r\n\t\t*/\r\n\t\tpauseSound: function () {\r\n\t\t\tcallComponent.call(this, 'pause');\r\n\t\t\tthis.el.emit('sound-paused');\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t* Start the sound playing.\r\n\t\t* @method native.n-sound#playSound\r\n\t\t*/\r\n\t\tplaySound: function () {\r\n\t\t\tcallComponent.call(this, 'play');\r\n\t\t\tthis.el.emit('sound-played');\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t* Jump to a position in the clip.\r\n\t\t* @method native.n-sound#seek\r\n\t\t* @param {number} time - The time in milliseconds to jump to.\r\n\t\t*/\r\n\t\tseek: function (time) {\r\n\t\t\tcallComponent.call(this, 'seek', {time: time});\r\n\t\t},\r\n\t\tremove: function () {\r\n\t\t\tnativeComponentRemove.call(this);\r\n\t\t\tif (this.playHandler) {\r\n\t\t\t  this.el.removeEventListener(oldData.on, this.playHandler);\r\n\t\t\t}\r\n\t\t},\r\n\t\tupdate: function (oldData) {\r\n\t\t\tnativeComponentUpdate.call(this, oldData);\r\n\t\t\tif (this.playHandler) {\r\n\t\t\t  this.el.removeEventListener(oldData.on, this.playHandler);\r\n\t\t\t}\r\n\t\t\tif (this.data.on) {\r\n\t\t\t  this.playHandler = this.playSound.bind(this);\r\n\t\t\t  this.el.addEventListener(this.data.on, this.playHandler);\r\n\t\t\t}\r\n\t\t},\r\n\t\tschema: {\r\n\t\t\ton: { type: 'string' },\r\n\t\t\tres: { type: 'string' },\r\n\t\t\tsrc: { type: 'string' },\r\n\t\t\tloop: { type: 'boolean' },\r\n\t\t\tvolume: { type: 'number', default: 1 },\r\n\t\t\tautoplay: { type: 'boolean' },\r\n\t\t\toneshot: { type: 'boolean' },\r\n\t\t\tspatialBlend: { type: 'float', default: 1 },\r\n\t\t\tpitch: { type: 'float', default: 1 },\r\n\t\t\tminDistance: { type: 'float', default: 1 },\r\n\t\t\tmaxDistance: { type: 'float', default: 12 },\r\n\t\t\trolloff: { type: 'string', default: 'logarithmic' },\r\n\t\t}\r\n\t});\r\n\r\n})();\r\n\r\nexport default null;\r\n","/**\r\n * The wire component allows you to trigger an event on another entity when an event occurs on an entity\r\n * @mixin wire\r\n * @property {string} on Name of an event to listen to\r\n * @property {string} gained Name of a state to watch for\r\n * @property {string} lost Name of a state to watch for\r\n * @property {string} emit Name of an event to trigger on the targets\r\n * @property {string} gain Name of a state to add on the target\r\n * @property {string} lose Name of a state to remove on the target\r\n * @property {selector} targets A selector to pick which objects to wire to\r\n * @property {selector} target - A selector to pick a single object to wire to\r\n **/\r\nAFRAME.registerComponent('wire',\r\n{\r\n\tmultiple: true,\r\n\tschema: {\r\n\t\ton: {type: 'string'},\r\n\t\temit: {type: 'string'},\r\n\t\tgained: {type: 'string'},\r\n\t\tlost: {type: 'string'},\r\n\t\tgain: {type: 'string'},\r\n\t\tlose: {type: 'string'},\r\n\t\ttargets: {type: 'selectorAll'},\r\n\t\ttarget: {type: 'selector'}\r\n\t},\r\n\tupdate: function (oldData) {\r\n\t\tif (oldData.on) {\r\n\t\t\tthis.el.removeEventListener(oldData.on, this.actOnTargets);\r\n\t\t}\r\n\t\tif (oldData.gained) {\r\n\t\t\tthis.el.removeEventListener('stateadded', this.actOnTargetsIfStateMatches);\r\n\t\t}\r\n\t\tif (oldData.lost) {\r\n\t\t\tthis.el.removeEventListener('stateremoved', this.actOnTargetsIfStateMatches);\r\n\t\t}\r\n\r\n\t\tthis.actOnTargets = function () {\r\n\t\t\tfunction act(el) {\r\n\t\t\t\tif (this.data.emit) {\r\n\t\t\t\t\tel.emit(this.data.emit);\r\n\t\t\t\t}\r\n\t\t\t\tif (this.data.gain) {\r\n\t\t\t\t\tel.addState(this.data.gain);\r\n\t\t\t\t}\r\n\t\t\t\tif (this.data.lose) {\r\n\t\t\t\t\tel.removeState(this.data.lose);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(this.data.targets) this.data.targets.forEach(act.bind(this));\r\n\t\t\tif(this.data.target) act.call(this, this.data.target);\r\n\t\t}.bind(this);\r\n\r\n\t\tthis.actOnTargetsIfStateMatches = function (event) {\r\n\t\t\tvar state = event.detail.state;\r\n\t\t\tif (state === this.data.gained || state === this.data.lost) {\r\n\t\t\t\tthis.actOnTargets();\r\n\t\t\t}\r\n\t\t}.bind(this);\r\n\r\n\t\tif (this.data.on) {\r\n\t\t\tthis.el.addEventListener(this.data.on, this.actOnTargets);\r\n\t\t}\r\n\t\tif (this.data.gained) {\r\n\t\t\tthis.el.addEventListener('stateadded', this.actOnTargetsIfStateMatches);\r\n\t\t}\r\n\t\tif (this.data.lost) {\r\n\t\t\tthis.el.addEventListener('stateremoved', this.actOnTargetsIfStateMatches);\r\n\t\t}\r\n\t},\r\n\tremove: function () {\r\n\t\tthis.el.removeEventListener(this.data.on, this.actOnTargets);\r\n\t\tthis.el.removeEventListener('stateadded', this.actOnTargetsIfStateMatches);\r\n\t\tthis.el.removeEventListener('stateremoved', this.actOnTargetsIfStateMatches);\r\n\t}\r\n});\r\n\r\nexport default null;\r\n"],"names":["flatten","obj","let","ret","__proto__","Object","assign","schema","dependencies","push","ref","registerComponentClass","name","cls","AFRAME","registerComponent","registerSystemClass","registerSystem","safeDeepSet","keys","value","length","slice","AFrameSystem","prototypeAccessors","init","tick","time","timeDelta","pause","play","AFrameComponent","update","oldData","remove","updateSchema","data","AltspaceCursorCollider","enabled","type","default","this","setColliderFlag","el","addEventListener","bind","state","object3D","console","log","userData","traverse","subobj","THREE","Mesh","AltspaceTrackedControls","gamepadIndex","trackedControlsSystem","document","querySelector","systems","systemGamepads","altspace","getGamepads","controllers","window","components","hand","controller","setAttribute","id","AltspaceComponent","usePixelScale","verticalAlign","enclosuresOnly","fullspace","version","Scene","warn","inClient","initRenderer","initCursorEvents","initCollisionEvents","t","dt","updateAllBehaviors","scene","getEnclosure","then","e","requestFullspace","scale","setScalar","pixelsPerMeter","position","y","innerHeight","innerDepth","renderer","render","effect","oldRenderer","getThreeJSRenderer","aframeComponentVersion","noop","setSize","setPixelRatio","setClearColor","clear","enableScissorTest","setScissor","setViewport","getPixelRatio","getMaxAnisotropy","setFaceCulling","context","canvas","shadowMap","emit","eventName","event","targetEl","target","cursorEl","ray","point","cursordownObj","uuid","addState","removeState","other","SyncColor","start","colorRef","sync","dataRef","child","refChangedLocked","firstValue","component","detail","newData","color","isMine","setTimeout","set","on","snapshot","val","isConnected","SyncComponent","isComponent","_isComponent","undefined","syncSys","key","ownerRef","ownerId","mode","ownOn","sceneEl","ownershipEvents","split","forEach","takeOwnership","clientId","onDisconnect","shouldTakeOwnership","isMasterClient","error","sceneRef","link","setupReceive","entityRef","transaction","owner","newOwnerId","gained","lost","cancel","SyncSystem","author","app","instance","refUrl","utilities","connect","authorId","appId","instanceId","baseRefUrl","connected","connection","clientsRef","masterClientId","self","clientIds","masterClientKey","childSnapshot","joinedClientId","leftClientId","once","shouldInitialize","onTransform","componentName","onComponentChanged","sendPosition","sendRotation","sendScale","throttle","func","wait","options","timeout","args","result","previous","later","leading","Date","now","apply","throttled","remaining","arguments","clearTimeout","trailing","positionRef","rotationRef","scaleRef","updateRate","stoppedAnimations","children","i","tagName","toLowerCase","stop","animation","sendEvent","sender","soundEventRef","soundStateRef","sound","playSound","pauseSound","off","meshInit","mesh","collider","addNativeComponent","nativeComponentInit","getOrCreateObject3D","PlaceholderMesh","call","nativeComponentRemove","getObject3D","removeNativeComponent","nativeComponentUpdate","updateNativeComponent","object3DMap","callComponent","functionName","functionArguments","callNativeComponent","placeholderGeometry","BoxGeometry","placeholderMaterial","MeshBasicMaterial","visible","prototype","create","constructor","res","text","fontSize","width","height","horizontalAlign","isTrigger","center","radius","size","direction","_forEachMesh","childObj","_initObj","convex","count","capacity","src","startsWith","location","origin","currPath","pathname","endsWith","join","seek","playHandler","removeEventListener","loop","volume","autoplay","oneshot","spatialBlend","pitch","minDistance","maxDistance","rolloff","multiple","gain","lose","targets","actOnTargets","actOnTargetsIfStateMatches","act","Error"],"mappings":"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"}