{"version":3,"file":"aframe-altspace-component.js","sources":["../src/AFrameComponent.js","../src/utilities.js","../src/AltspaceCursorCollider.js","../src/AltspaceTrackedControls.js","../src/index.js"],"sourcesContent":["'use strict';\r\n\r\nclass AFrameComponent\r\n{\r\n\tget schema(){\r\n\t\treturn null;\r\n\t}\r\n\r\n\tinit(){ }\r\n\tupdate(oldData){ }\r\n\tremove(){ }\r\n\ttick(time, timeDelta){ }\r\n\tpause(){ }\r\n\tplay(){ }\r\n\tupdateSchema(data){ }\r\n\r\n}\r\n\r\nfunction flatten(obj)\r\n{\r\n\tlet ret = {};\r\n\tif(!obj.prototype){\r\n\t\tret = Object.assign( {schema: {}}, obj );\r\n\t}\r\n\telse {\r\n\t\tret = Object.assign( flatten(obj.prototype), obj );\r\n\t}\r\n\r\n\tObject.assign(ret.schema, obj.schema);\r\n\treturn ret;\r\n}\r\n\r\nfunction registerComponent(name, cls)\r\n{\r\n\tAFRAME.registerComponent(name, flatten(cls));\r\n}\r\n\r\nexport { AFrameComponent, registerComponent };\r\n","'use strict';\r\n\r\nfunction safeDeepSet(obj, keys, value)\r\n{\r\n\tif(keys.length === 0)\r\n\t\treturn value;\r\n\telse {\r\n\t\tobj[keys[0]] = safeDeepSet(obj[keys[0]] || {}, keys.slice(1), value);\r\n\t\treturn obj;\r\n\t}\r\n}\r\n\r\nexport { safeDeepSet };\r\n","/**\r\n* Enable or disable cursor collision on the object.\r\n* @mixin altspace-cursor-collider\r\n* @memberof altspace\r\n* @prop {boolean} enabled=true - The state of the cursor collider.\r\n*/\r\n\r\n'use strict';\r\n\r\nimport {AFrameComponent} from './AFrameComponent';\r\nimport {safeDeepSet} from './utilities';\r\n\r\n\r\nexport default class AltspaceCursorCollider extends AFrameComponent\r\n{\r\n\tget schema(){\r\n\t\treturn {enabled: {type: 'boolean', default: 'true'}};\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tthis.setColliderFlag(this.data.enabled);\r\n\t\tthis.el.addEventListener('model-loaded', (() => {\r\n\t\t\tthis.setColliderFlag(this.data.enabled);\r\n\t\t}).bind(this));\r\n\t}\r\n\r\n\tupdate()\r\n\t{\r\n\t\tthis.setColliderFlag(this.data.enabled);\r\n\t}\r\n\r\n\tsetColliderFlag(state)\r\n\t{\r\n\t\tlet obj = this.el.object3D;\r\n\t\tif(obj){\r\n\t\t\tconsole.log('Setting collider flag to', state);\r\n\t\t\tsafeDeepSet(obj.userData, ['altspace','collider','enabled'], state);\r\n\t\t\tobj.traverse(subobj => {\r\n\t\t\t\tif( subobj instanceof THREE.Mesh ){\r\n\t\t\t\t\tsafeDeepSet(subobj.userData, ['altspace','collider','enabled'], state);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n};\r\n","/**\r\n* Enables tracked control support for A-Frame applications that use the built-in\r\n* `tracked-controls`, `vive-controls` or `hand-controls` components.\r\n* @mixin altspace-tracked-controls\r\n* @memberof altspace\r\n*/\r\n'use strict';\r\n\r\nimport {AFrameComponent} from './AFrameComponent';\r\n\r\nexport default class AltspaceTrackedControls extends AFrameComponent\r\n{\r\n\tinit()\r\n\t{\r\n\t\tthis.gamepadIndex = null;\r\n\t\tthis.trackedControlsSystem = document.querySelector('a-scene').systems['tracked-controls'];\r\n\t\tthis.systemGamepads = 0;\r\n\t\taltspace.getGamepads();\r\n\t}\r\n\r\n\ttick()\r\n\t{\r\n\t\tif (\r\n\t\t\tthis.trackedControlsSystem &&\r\n\t\t\tthis.systemGamepads !== this.trackedControlsSystem.controllers.length &&\r\n\t\t\twindow.altspace && altspace.getGamepads && altspace.getGamepads().length\r\n\t\t) {\r\n\t\t\tvar components = this.el.components;\r\n\t\t\tif (components['paint-controls']) {\r\n\t\t\t\tthis.gamepadIndex = components['paint-controls'].data.hand === 'left' ? 2 : 1;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.gamepadIndex === null && components['hand-controls']) {\r\n\t\t\t\tthis.gamepadIndex = components['hand-controls'].data === 'left' ? 2 : 1;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.gamepadIndex === null && components['vive-controls']) {\r\n\t\t\t\tthis.gamepadIndex = components['vive-controls'].data.hand === 'left' ? 2 : 1;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.gamepadIndex === null && components['tracked-controls']) {\r\n\t\t\t\tthis.gamepadIndex = components['tracked-controls'].data.controller;\r\n\t\t\t}\r\n\r\n\t\t\tthis.el.setAttribute('tracked-controls', 'id', altspace.getGamepads()[this.gamepadIndex].id);\r\n\t\t\tthis.el.setAttribute('tracked-controls', 'controller', 0);\r\n\t\t\tthis.systemGamepads = this.trackedControlsSystem.controllers.length;\r\n\t\t}\r\n\t}\r\n}\r\n","'use strict';\r\n\r\nif (typeof AFRAME === 'undefined') {\r\n  throw new Error('Component attempted to register before AFRAME was available.');\r\n}\r\n\r\nimport {registerComponent} from './AFrameComponent';\r\n\r\nimport AltspaceCursorCollider from './AltspaceCursorCollider';\r\nregisterComponent('altspace-cursor-collider', AltspaceCursorCollider);\r\n\r\nimport AltspaceTrackedControls from './AltspaceTrackedControls';\r\nregisterComponent('altspace-tracked-controls', AltspaceTrackedControls);\r\n\r\nexport {AltspaceCursorCollider};\r\n"],"names":["let","this"],"mappings":"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"}