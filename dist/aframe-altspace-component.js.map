{"version":3,"file":"aframe-altspace-component.js","sources":["../src/AFrameComponent.js","../src/utilities.js","../src/AltspaceCursorCollider.js","../src/AltspaceTrackedControls.js","../src/AltspaceComponent.js","../src/SyncColor.js","../src/index.js"],"sourcesContent":["'use strict';\r\n\r\nclass AFrameComponent\r\n{\r\n\tget schema(){\r\n\t\treturn null;\r\n\t}\r\n\r\n\tinit(){ }\r\n\tupdate(oldData){ }\r\n\tremove(){ }\r\n\ttick(time, timeDelta){ }\r\n\tpause(){ }\r\n\tplay(){ }\r\n\tupdateSchema(data){ }\r\n\r\n}\r\n\r\nfunction flatten(obj)\r\n{\r\n\tlet ret = {};\r\n\tif(!obj.prototype){\r\n\t\tret = Object.assign( {schema: {}, dependencies: []}, obj );\r\n\t}\r\n\telse {\r\n\t\tret = Object.assign( flatten(obj.prototype), obj );\r\n\t}\r\n\r\n\tif(obj.schema)\r\n\t\tObject.assign(ret.schema, obj.schema);\r\n\t\t\r\n\tif(obj.dependencies)\r\n\t\tret.dependencies.push(...obj.dependencies);\r\n\r\n\treturn ret;\r\n}\r\n\r\nfunction registerComponent(name, cls)\r\n{\r\n\tAFRAME.registerComponent(name, flatten(cls));\r\n}\r\n\r\nexport { AFrameComponent, registerComponent };\r\n","'use strict';\r\n\r\nfunction safeDeepSet(obj, keys, value)\r\n{\r\n\tif(keys.length === 0)\r\n\t\treturn value;\r\n\telse {\r\n\t\tobj[keys[0]] = safeDeepSet(obj[keys[0]] || {}, keys.slice(1), value);\r\n\t\treturn obj;\r\n\t}\r\n}\r\n\r\nexport { safeDeepSet };\r\n","/**\r\n* Enable or disable cursor collision on the object.\r\n* @mixin altspace-cursor-collider\r\n* @memberof altspace\r\n* @prop {boolean} enabled=true - The state of the cursor collider.\r\n*/\r\n\r\n'use strict';\r\n\r\nimport {AFrameComponent} from './AFrameComponent';\r\nimport {safeDeepSet} from './utilities';\r\n\r\n\r\nexport default class AltspaceCursorCollider extends AFrameComponent\r\n{\r\n\tget schema(){\r\n\t\treturn {enabled: {type: 'boolean', default: 'true'}};\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tthis.setColliderFlag(this.data.enabled);\r\n\t\tthis.el.addEventListener('model-loaded', (() => {\r\n\t\t\tthis.setColliderFlag(this.data.enabled);\r\n\t\t}).bind(this));\r\n\t}\r\n\r\n\tupdate()\r\n\t{\r\n\t\tthis.setColliderFlag(this.data.enabled);\r\n\t}\r\n\r\n\tsetColliderFlag(state)\r\n\t{\r\n\t\tlet obj = this.el.object3D;\r\n\t\tif(obj){\r\n\t\t\tconsole.log('Setting collider flag to', state);\r\n\t\t\tsafeDeepSet(obj.userData, ['altspace','collider','enabled'], state);\r\n\t\t\tobj.traverse(subobj => {\r\n\t\t\t\tif( subobj instanceof THREE.Mesh ){\r\n\t\t\t\t\tsafeDeepSet(subobj.userData, ['altspace','collider','enabled'], state);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n};\r\n","/**\r\n* Enables tracked control support for A-Frame applications that use the built-in\r\n* `tracked-controls`, `vive-controls` or `hand-controls` components.\r\n* @mixin altspace-tracked-controls\r\n* @memberof altspace\r\n*/\r\n'use strict';\r\n\r\nimport {AFrameComponent} from './AFrameComponent';\r\n\r\nexport default class AltspaceTrackedControls extends AFrameComponent\r\n{\r\n\tinit()\r\n\t{\r\n\t\tthis.gamepadIndex = null;\r\n\t\tthis.trackedControlsSystem = document.querySelector('a-scene').systems['tracked-controls'];\r\n\t\tthis.systemGamepads = 0;\r\n\t\taltspace.getGamepads();\r\n\t}\r\n\r\n\ttick()\r\n\t{\r\n\t\tif (\r\n\t\t\tthis.trackedControlsSystem &&\r\n\t\t\tthis.systemGamepads !== this.trackedControlsSystem.controllers.length &&\r\n\t\t\twindow.altspace && altspace.getGamepads && altspace.getGamepads().length\r\n\t\t) {\r\n\t\t\tvar components = this.el.components;\r\n\t\t\tif (components['paint-controls']) {\r\n\t\t\t\tthis.gamepadIndex = components['paint-controls'].data.hand === 'left' ? 2 : 1;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.gamepadIndex === null && components['hand-controls']) {\r\n\t\t\t\tthis.gamepadIndex = components['hand-controls'].data === 'left' ? 2 : 1;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.gamepadIndex === null && components['vive-controls']) {\r\n\t\t\t\tthis.gamepadIndex = components['vive-controls'].data.hand === 'left' ? 2 : 1;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.gamepadIndex === null && components['tracked-controls']) {\r\n\t\t\t\tthis.gamepadIndex = components['tracked-controls'].data.controller;\r\n\t\t\t}\r\n\r\n\t\t\tthis.el.setAttribute('tracked-controls', 'id', altspace.getGamepads()[this.gamepadIndex].id);\r\n\t\t\tthis.el.setAttribute('tracked-controls', 'controller', 0);\r\n\t\t\tthis.systemGamepads = this.trackedControlsSystem.controllers.length;\r\n\t\t}\r\n\t}\r\n}\r\n","/**\r\n* @namespace altspace\r\n*/\r\n\r\n/**\r\n* The altspace component makes A-Frame apps compatible with AltspaceVR.\r\n*\r\n* **Note**: If you use the `embedded` A-Frame component on your scene, you must include it *before* the `altspace` component, or your app will silently fail.\r\n* @mixin altspace\r\n* @memberof altspace\r\n* @property {boolean} usePixelScale=`false` - Allows you to use A-Frame units as CSS pixels.\r\n* This is the default behavior for three.js apps, but not for A-Frame apps.\r\n* @property {string} verticalAlign=`middle` - Puts the origin at the `bottom`, `middle` (default),\r\n* or `top` of the Altspace enclosure.\r\n* @property {boolean} enclosuresOnly=`true` - Prevents the scene from being created if\r\n* enclosure is flat.\r\n* @property {boolean} fullspace=`false` - Puts the app into fullspace mode.\r\n*\r\n* @example\r\n* <head>\r\n*   <title>My A-Frame Scene</title>\r\n*   <script src=\"https://aframe.io/releases/0.3.0/aframe.min.js\"></script>\r\n*   <script src=\"https://cdn.rawgit.com/AltspaceVR/aframe-altspace-component/vAFRAME_ALTSPACE_VERSION/dist/aframe-altspace-component.min.js\"></script>\r\n* </head>\r\n* <body>\r\n*   <a-scene altspace>\r\n*     <a-entity geometry=\"primitive: box\" material=\"color: #C03546\"></a-entity>\r\n*   </a-scene>\r\n* </body>\r\n*/\r\n'use strict';\r\n\r\nimport {AFrameComponent} from './AFrameComponent';\r\n\r\nexport default class AltspaceComponent extends AFrameComponent\r\n{\r\n\tget version(){\r\n\t\treturn 'AFRAME_ALTSPACE_VERSION';\r\n\t}\r\n\r\n\tget schema(){\r\n\t\treturn {\r\n\t\t\tusePixelScale: { type: 'boolean', default: 'false'},\r\n\t\t\tverticalAlign: { type: 'string',  default: 'middle'},\r\n\t\t\tenclosuresOnly:{ type: 'boolean', default: 'true'},\r\n\t\t\tfullspace:     { type: 'boolean', default: 'false'}\r\n\t\t}\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tif(!this.el.object3D instanceof THREE.Scene){\r\n\t\t\tconsole.warn('aframe-altspace-component can only be attached to a-scene');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (window.altspace && window.altspace.inClient) {\r\n\t\t\tthis.el.setAttribute('vr-mode-ui', {enabled: false});\r\n\t\t\tthis.initRenderer();\r\n\t\t\tthis.initCursorEvents();\r\n\t\t\tthis.initCollisionEvents();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconsole.warn('aframe-altspace-component only works inside of AltspaceVR');\r\n\t\t}\r\n\t}\r\n\r\n\ttick(t, dt)\r\n\t{\r\n\t\tif(this.el.object3D.updateAllBehaviors)\r\n\t\t\tthis.el.object3D.updateAllBehaviors();\r\n\t}\r\n\r\n\t/*\r\n\t* Swap in Altspace renderer when running in AltspaceVR.\r\n\t*/\r\n\tinitRenderer()\r\n\t{\r\n\t\tlet scene = this.el.object3D;\r\n\t\taltspace.getEnclosure().then((e =>\r\n\t\t{\r\n\t\t\tif(this.data.fullspace){\r\n\t\t\t\te.requestFullspace();\r\n\t\t\t\te.addEventListener('fullspacechange', () => {\r\n\t\t\t\t\tscene.scale.setScalar(e.pixelsPerMeter);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (!this.data.usePixelScale || this.data.fullspace){\r\n\t\t\t\tscene.scale.setScalar(e.pixelsPerMeter);\r\n\t\t\t}\r\n\r\n\t\t\tswitch (this.data.verticalAlign) {\r\n\t\t\t\tcase 'bottom':\r\n\t\t\t\t\tscene.position.y -= e.innerHeight / 2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'top':\r\n\t\t\t\t\tscene.position.y += e.innerHeight / 2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'middle':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconsole.warn('Unexpected value for verticalAlign: ', this.data.verticalAlign);\r\n\t\t\t}\r\n\r\n\t\t\tif(this.data.enclosuresOnly && e.innerDepth === 1){\r\n\t\t\t\tthis.el.renderer.render(new THREE.Scene());\r\n\t\t\t\tthis.el.renderer = this.el.effect = oldRenderer;\r\n\r\n\t\t\t}\r\n\t\t}).bind(this));\r\n\r\n\t\tlet oldRenderer = this.el.renderer;\r\n\t\tlet renderer = this.el.renderer = this.el.effect = altspace.getThreeJSRenderer({\r\n\t\t\taframeComponentVersion: this.version\r\n\t\t});\r\n\r\n\t\tlet noop = function() {};\r\n\t\trenderer.setSize = noop;\r\n\t\trenderer.setPixelRatio = noop;\r\n\t\trenderer.setClearColor = noop;\r\n\t\trenderer.clear = noop;\r\n\t\trenderer.enableScissorTest = noop;\r\n\t\trenderer.setScissor = noop;\r\n\t\trenderer.setViewport = noop;\r\n\t\trenderer.getPixelRatio = noop;\r\n\t\trenderer.getMaxAnisotropy = noop;\r\n\t\trenderer.setFaceCulling = noop;\r\n\t\trenderer.context = {canvas: {}};\r\n\t\trenderer.shadowMap = {};\r\n\t}\r\n\r\n\t/*\r\n\t* Emulate A-Frame cursor events when running in AltspaceVR.\r\n\t*/\r\n\tinitCursorEvents()\r\n\t{\r\n\r\n\t\tlet scene = this.el.object3D;\r\n\t\tlet cursorEl = document.querySelector('a-cursor') || document.querySelector('a-entity[cursor]');\r\n\t\tif (cursorEl) {\r\n\t\t\t// Hide A-Frame cursor mesh.\r\n\t\t\tcursorEl.setAttribute('material', 'transparent', true);\r\n\t\t\tcursorEl.setAttribute('material', 'opacity', 0.0);\r\n\t\t}\r\n\r\n\t\tfunction emit(eventName, event)\r\n\t\t{\r\n\t\t\t// Fire events on intersected object and A-Frame cursor.\r\n\t\t\tlet targetEl = event.target.el;\r\n\t\t\tif (cursorEl){\r\n\t\t\t\tcursorEl.emit(eventName, { target: targetEl, ray: event.ray, point: event.point });\r\n\t\t\t}\r\n\r\n\t\t\tif (targetEl){\r\n\t\t\t\ttargetEl.emit(eventName, { target: targetEl, ray: event.ray, point: event.point });\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet cursordownObj = null;\r\n\t\tscene.addEventListener('cursordown', event => {\r\n\t\t\tcursordownObj = event.target;\r\n\t\t\temit('mousedown', event);\r\n\t\t});\r\n\r\n\t\tscene.addEventListener('cursorup', event => {\r\n\t\t\temit('mouseup', event);\r\n\t\t\tif (event.target.uuid === cursordownObj.uuid) {\r\n\t\t\t\temit('click', event);\r\n\t\t\t}\r\n\t\t\tcursordownObj = null;\r\n\t\t});\r\n\r\n\t\tscene.addEventListener('cursorenter', event => {\r\n\t\t\tif (!event.target.el){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tevent.target.el.addState('hovered');\r\n\t\t\tif (cursorEl){\r\n\t\t\t\tcursorEl.addState('hovering');\r\n\t\t\t}\r\n\t\t\temit('mouseenter', event);\r\n\t\t});\r\n\r\n\t\tscene.addEventListener('cursorleave', event => {\r\n\t\t\tif (!event.target.el){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tevent.target.el.removeState('hovered');\r\n\t\t\tif (cursorEl){\r\n\t\t\t\tcursorEl.removeState('hovering');\r\n\t\t\t}\r\n\t\t\temit('mouseleave', event);\r\n\t\t});\r\n    }\r\n\r\n\tinitCollisionEvents()\r\n\t{\r\n\t\tlet scene = this.el.object3D;\r\n\r\n\t\tfunction emit(eventName, event)\r\n\t\t{\r\n\t\t\tlet targetEl = event.target.el;\r\n\t\t\tif (!targetEl)\r\n\t\t\t\treturn;\r\n\r\n\t\t\t//remap target and other from object3Ds to aframe element\r\n\t\t\tevent.target = targetEl;\r\n\t\t\tif (event.other && event.other.el) {\r\n\t\t\t\tevent.other = event.other.el;\r\n\t\t\t}\r\n\t\t\ttargetEl.emit(eventName, event);\r\n\t\t};\r\n\r\n\t\tscene.addEventListener('collisionenter', event => {\r\n\t\t\temit('collisionenter', event);\r\n\t\t});\r\n\r\n\t\tscene.addEventListener('collisionexit', event => {\r\n\t\t\temit('collisionexit', event);\r\n\t\t});\r\n\r\n\t\tscene.addEventListener('triggerenter', event => {\r\n\t\t\temit('triggerenter', event);\r\n\t\t});\r\n\r\n\t\tscene.addEventListener('triggerexit', event => {\r\n\t\t\temit('triggerexit', event);\r\n\t\t});\r\n\r\n    }\r\n}\r\n","/**\r\n* Sync the color property of the object between clients.\r\n* Requires both a {@link sync.sync-system} component on the `a-scene`, and a\r\n* {@link sync.sync} component on the target entity.\r\n* @mixin sync-color\r\n* @memberof sync\r\n*/\r\n\r\nimport {AFrameComponent} from './AFrameComponent';\r\n\r\nexport default class SyncColor extends AFrameComponent\r\n{\r\n\tget dependencies(){\r\n\t\treturn ['sync'];\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tlet component = this;\r\n\t\tlet sync = component.el.components.sync;\r\n\r\n\t\t// wait for firebase connection to start sync routine\r\n\t\tif(sync.isConnected)\r\n\t\t\tstart();\r\n\t\telse\r\n\t\t\tcomponent.el.addEventListener('connected', start);\r\n\r\n\t\tfunction start()\r\n\t\t{\r\n\t\t\tlet colorRef = sync.dataRef.child('material/color');\r\n\t\t\tlet refChangedLocked = false;\r\n\t\t\tlet firstValue = true;\r\n\r\n\t\t\tcomponent.el.addEventListener('componentchanged', event =>\r\n\t\t\t{\r\n\t\t\t\tlet name = event.detail.name;\r\n\t\t\t\tlet oldData = event.detail.oldData;\r\n\t\t\t\tlet newData = event.detail.newData;\r\n\r\n\t\t\t\tif (name === 'material' && !refChangedLocked && oldData.color !== newData.color && sync.isMine)\r\n\t\t\t\t{\r\n\t\t\t\t\t//For some reason A-Frame has a misconfigured material reference if we do this too early\r\n\t\t\t\t\tsetTimeout(() => colorRef.set(newData.color), 0);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tcolorRef.on('value', snapshot => {\r\n\t\t\t\tif(!sync.isMine || firstValue)\r\n\t\t\t\t{\r\n\t\t\t\t\tlet color = snapshot.val();\r\n\r\n\t\t\t\t\trefChangedLocked = true;\r\n\t\t\t\t\tcomponent.el.setAttribute('material', 'color', color);\r\n\t\t\t\t\trefChangedLocked = false;\r\n\r\n\t\t\t\t\tfirstValue = false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n}\r\n","'use strict';\r\n\r\nif (typeof AFRAME === 'undefined') {\r\n    throw new Error('Component attempted to register before AFRAME was available.');\r\n}\r\n\r\nimport {registerComponent} from './AFrameComponent';\r\n\r\nimport AltspaceCursorCollider from './AltspaceCursorCollider';\r\nregisterComponent('altspace-cursor-collider', AltspaceCursorCollider);\r\n\r\nimport AltspaceTrackedControls from './AltspaceTrackedControls';\r\nregisterComponent('altspace-tracked-controls', AltspaceTrackedControls);\r\n\r\nimport AltspaceComponent from './AltspaceComponent';\r\nregisterComponent('altspace', AltspaceComponent);\r\n\r\nimport SyncColor from './SyncColor';\r\nregisterComponent('sync-color', SyncColor);\r\n\r\nexport {AltspaceCursorCollider};\r\n"],"names":["let","this"],"mappings":"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"}