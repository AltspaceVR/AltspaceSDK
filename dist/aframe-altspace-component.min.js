!function(e){function t(i){if(n[i])return n[i].exports;var a=n[i]={exports:{},id:i,loaded:!1};return e[i].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t){if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");AFRAME.registerComponent("editor",{_setSelectedObject:function(e){e.target.el.dataset&&e.target.el.dataset.editorAsset||(this.placingObject&&(this.placingObject=null,this.raycastFloor.userData.altspace.collider.enabled=!1),e.target!==this.raycastFloor&&(this.selectedObject=e.target))},_moveSelectedObject:function(e){if(this.selectedObject){var t=this.selectedObject.el,n=Object.assign({},t.components.position.data);switch(e.keyCode){case"I".charCodeAt(0):n.z--;break;case"J".charCodeAt(0):n.x--;break;case"K".charCodeAt(0):n.z++;break;case"L".charCodeAt(0):n.x++;break;case"P".charCodeAt(0):n.y+=.25;break;case";".charCodeAt(0):n.y-=.25}t.setAttribute("position",n)}},_placeObject:function(e){if(this.placingObject){this.raycastFloor.userData.altspace.collider.enabled=!0,this.raycaster.set(e.ray.origin,e.ray.direction);var t=this.raycaster.intersectObject(this.raycastFloor)[0];if(t){var n=t.point.clone().multiplyScalar(1/this.scene.object3D.scale.x);n.x=Math.ceil(n.x),n.z=Math.floor(n.z),n.x+=.5,n.z-=.5,this.placingObject.setAttribute("position",n)}}},_assets:["Architecture/Ceiling_2Wx2L","Architecture/Ceiling_2Wx4L","Architecture/Ceiling_4Wx2L","Architecture/Ceiling_4Wx4L","Architecture/Ceiling_Skylight_4Wx4L","Architecture/Ceiling_Skylight_Corner_2Wx2L","Architecture/Ceiling_Skylight_Edge_2W","Architecture/Ceiling_Skylight_Edge_4W","Architecture/Ceiling_Skylight_Filled_4Wx4L","Architecture/Ceiling_Skylight_Filled2_4Wx4L","Architecture/Ceiling_Slice_Concave_2R","Architecture/Ceiling_Slice_Concave_4R","Architecture/Ceiling_Slice_Convex_2R","Architecture/Ceiling_Slice_Convex_4R","Architecture/Door_4Wx4H","Architecture/Floor_2Wx2L","Architecture/Floor_2Wx4L","Architecture/Floor_4Wx2L","Architecture/Floor_4Wx4L","Architecture/Floor_Slice_Concave_2R","Architecture/Floor_Slice_Concave_4R","Architecture/Floor_Slice_Convex_2R","Architecture/Floor_Slice_Convex_4R","Architecture/Railing_2L","Architecture/Railing_4L","Architecture/Railing_Curve_Concave_2R","Architecture/Wall_2Wx4H","Architecture/Wall_4Wx4H","Architecture/Wall_Base_2W","Architecture/Wall_Base_4W","Architecture/Wall_Base_Curve_Concave_2R","Architecture/Wall_Base_Curve_Concave_4R","Architecture/Wall_Base_Curve_Convex_2R","Architecture/Wall_Base_Curve_Convex_4R","Architecture/Wall_Bulkhead_2W","Architecture/Wall_Bulkhead_4W","Architecture/Wall_Bulkhead_Curve_Concave_2R","Architecture/Wall_Bulkhead_Curve_Concave_4R","Architecture/Wall_Bulkhead_Curve_Convex_2R","Architecture/Wall_Bulkhead_Curve_Convex_4R","Architecture/Wall_Curve_Concave_2Rx4H","Architecture/Wall_Curve_Concave_4Rx4H","Architecture/Wall_Curve_Convex_2Rx4H","Architecture/Wall_Curve_Convex_4Rx4H","Architecture/Wall_Curve_Window_Concave_4Rx4H","Architecture/Wall_Curve_Window_Gap_Concave_4Rx4H","Architecture/Wall_Curve_Window_Gap_End_L_Concave_4Rx4H","Architecture/Wall_Curve_Window_Gap_End_R_Concave_4Rx4H","Architecture/Wall_Filler_Corner_Inner_4H","Architecture/Wall_Filler_Corner_Outer_4H","Architecture/Wall_Window_4Wx4H","Architecture/Wall_Window_GapEnd_R_4Wx4H","Architecture/Wall_Window_Gap_2Wx4H","Architecture/Wall_Window_Gap_4Wx4H","Architecture/Wall_Window_Gap_End_L_2Wx4H","Architecture/Wall_Window_Gap_End_L_4Wx4H","Architecture/Wall_Window_Gap_End_R_2Wx4H","Architecture/Wall_Window2","Architecture/Window_Wall_Curve_Concave_4Rx4H"],_setPlacingObject:function(e){var t=document.createElement("n-entity");t.setAttribute("asset",e.target.el.querySelector("n-entity").getAttribute("asset")),this.placingObject=t,this.scene.appendChild(t)},_addAssetToPalette:function(e,t){var n=document.createElement("n-entity");n.setAttribute("asset",e),setTimeout(function(e){return function(){e.setAttribute("scale","0.1 0.1 0.1")}}(n),500);var i=document.createElement("a-box");i.dataset.editorAsset=!0,i.setAttribute("scale","0.2 0.2 0.2"),i.setAttribute("material","opacity: 0.1"),i.appendChild(n);var a=3,r=.2,o=1+1/3,c={x:t%a*(r*o),y:-Math.floor(t/a)*(r*o),z:0};i.setAttribute("position",c),i.object3D.addEventListener("cursordown",this._setPlacingObject.bind(this)),this.palette.appendChild(i)},_createPalette:function(){this.palette=document.createElement("a-entity"),this.palette.id="editorPalette",this.palette.setAttribute("position","0 1.5 5"),this._assets.forEach(this._addAssetToPalette.bind(this)),this.scene.appendChild(this.palette)},init:function(){this.scene=document.querySelector("a-scene"),this.scene.object3D.addEventListener("cursordown",this._setSelectedObject.bind(this)),window.addEventListener("keydown",this._moveSelectedObject.bind(this)),this.raycastFloor=new THREE.Mesh(new THREE.PlaneGeometry(100,100),new THREE.MeshBasicMaterial({color:"white"})),this.raycastFloor.material.visible=!1,this.raycastFloor.userData.altspace={collider:{enabled:!1}};var e=function(){};this.raycastFloor.el={removeState:e,addState:e,emit:e},this.raycastFloor.rotation.x=-Math.PI/2,this.scene.object3D.add(this.raycastFloor),this.raycaster=new THREE.Raycaster,this.scene.object3D.addEventListener("cursormove",this._placeObject.bind(this)),this._createPalette()}}),function(){function e(){var e=this.el.getOrCreateObject3D("mesh",c);altspace._internal.callClientFunction("AddNativeComponent",{MeshId:e.id,Type:this.name},{argsType:"JSTypeAddNativeComponent"})}function t(){var e=this.el.getObject3D("mesh");altspace._internal.callClientFunction("RemoveNativeComponent",{MeshId:e.id,Type:this.name},{argsType:"JSTypeRemoveNativeComponent"})}function n(e){var t;t=this.data instanceof Object?JSON.stringify(this.data):JSON.stringify({singularProperty:this.data}),altspace._internal.callClientFunction("UpdateNativeComponent",{MeshId:this.el.object3DMap.mesh.id,ComponentName:this.name,Attributes:t},{argsType:"JSTypeUpdateNativeComponent"})}function i(e,t){altspace._internal.callClientFunction("CallNativeComponent",{MeshId:this.el.object3DMap.mesh.id,ComponentName:this.name,FunctionName:e,Arguments:JSON.stringify(t)},{argsType:"JSTypeCallNativeComponent"})}function a(e){return"true"===e}var r=new THREE.BoxGeometry(.001,.001,.001),o=new THREE.MeshBasicMaterial({color:0});o.visible=!1;var c=function(){THREE.Mesh.call(this,r,o),this.userData.altspace={collider:{enabled:!1}}};c.prototype=Object.create(THREE.Mesh.prototype),c.prototype.constructor=THREE.PlaceholderMesh;var s={"default":"false false false",parse:function(e){return e.split(" ").map(a)},stringify:function(e){return e.join(" ")}};AFRAME.registerComponent("n-object",{schema:{type:"string"},init:e,update:n,remove:t}),AFRAME.registerComponent("n-text",{init:e,update:n,remove:t,schema:{text:{"default":"",type:"string"},fontSize:{"default":"10",type:"int"},width:{"default":"10",type:"number"},height:{"default":"1",type:"number"},horizontalAlign:{"default":"middle"},verticalAlign:{"default":"middle"}}}),AFRAME.registerComponent("n-sphere-collider",{init:e,remove:t,update:n,schema:{isTrigger:{"default":!1,type:"boolean"},center:{type:"vec3"},radius:{"default":"0",type:"number"}}}),AFRAME.registerComponent("n-box-collider",{init:e,remove:t,update:n,schema:{isTrigger:{"default":!1,type:"boolean"},center:{type:"vec3"},radius:{"default":"0",type:"number"},size:{type:"vec3"}}}),AFRAME.registerComponent("n-capsule-collider",{init:e,remove:t,update:n,schema:{isTrigger:{"default":!1,type:"boolean"},center:{type:"vec3"},radius:{"default":"0",type:"number"},height:{"default":"0",type:"number"},direction:{"default":"y"}}}),AFRAME.registerComponent("n-mesh-collider",{init:e,remove:t,update:n,schema:{isTrigger:{"default":!1,type:"boolean"},convex:{"default":!0,type:"boolean"}}}),AFRAME.registerComponent("n-rigidbody",{init:function(){e.call(this),this.addRelativeForce=function(e,t){i.call(this,"addRelativeForce",{force:e,mode:t||"impulse"})}.bind(this),this.addForce=function(e,t){i.call(this,"addForce",{force:e,mode:t||"impulse"})}.bind(this),this.worldPosition=new THREE.Vector3,this.worldQuaternion=new THREE.Quaternion,this.el.object3DMap.mesh.addEventListener("nativetransformupdate",function(e){this.worldPosition.x=e.worldPosition.x,this.worldPosition.y=e.worldPosition.y,this.worldPosition.z=e.worldPosition.z,this.worldQuaternion.x=e.worldQuaternion.x,this.worldQuaternion.y=e.worldQuaternion.y,this.worldQuaternion.z=e.worldQuaternion.z,this.worldQuaternion.w=e.worldQuaternion.w}.bind(this))},remove:t,update:n,schema:{mass:{"default":1,type:"number"},drag:{"default":0,type:"number"},angularDrag:{"default":.05,type:"number"},useGravity:{"default":!0,type:"boolean"},isKinematic:{"default":!1,type:"boolean"},positionConstraints:s,rotationConstraints:s}}),AFRAME.registerComponent("n-browser",{init:e,remove:t,update:n,schema:{url:{type:"string"},controls:{"default":"above",type:"string"}}})}(),AFRAME.registerComponent("altspace",{schema:{usePixelScale:{type:"boolean","default":"false"},verticalAlign:{type:"string","default":"middle"},enclosuresOnly:{type:"boolean","default":"true"}},init:function(){return this.el.object3D instanceof THREE.Scene?void(window.altspace&&window.altspace.inClient?(this.el.setAttribute("vr-mode-ui",{enabled:!1}),this.initRenderer(),this.initCursorEvents(),this.initCollisionEvents()):console.warn("aframe-altspace-component only works inside of AltspaceVR")):void console.warn("aframe-altspace-component can only be attached to a-scene")},update:function(e){},remove:function(){},pause:function(){},play:function(){},initRenderer:function(){var e=this.el.object3D;altspace.getEnclosure().then(function(n){switch(this.data.usePixelScale||e.scale.multiplyScalar(n.pixelsPerMeter),this.data.verticalAlign){case"bottom":e.position.y-=n.innerHeight/2;break;case"top":e.position.y+=n.innerHeight/2;break;case"middle":break;default:console.warn("Unexpected value for verticalAlign: ",this.data.verticalAlign)}this.data.enclosuresOnly&&1===n.innerDepth&&(this.el.renderer.render(new THREE.Scene),this.el.renderer=this.el.effect=t)}.bind(this));var t=this.el.renderer,n=this.el.renderer=this.el.effect=altspace.getThreeJSRenderer(),i=function(){};n.setSize=i,n.setPixelRatio=i,n.setClearColor=i,n.clear=i,n.enableScissorTest=i,n.setScissor=i,n.setViewport=i,n.getPixelRatio=i,n.getMaxAnisotropy=i,n.setFaceCulling=i,n.context={canvas:{}},n.shadowMap={}},initCursorEvents:function(){var e=this.el.object3D,t=document.querySelector("a-cursor")||document.querySelector("a-entity[cursor]");t&&(t.setAttribute("material","transparent",!0),t.setAttribute("material","opacity",0));var n=function(e,n){var i=n.target.el;t&&t.emit(e,{target:i,ray:n.ray,point:n.point}),i&&i.emit(e,{target:i,ray:n.ray,point:n.point})},i=null;e.addEventListener("cursordown",function(e){i=e.target,n("mousedown",e)}),e.addEventListener("cursorup",function(e){n("mouseup",e),e.target.uuid===i.uuid&&n("click",e),i=null}),e.addEventListener("cursorenter",function(e){e.target.el&&(e.target.el.addState("hovered"),t&&t.addState("hovering"),n("mouseenter",e))}),e.addEventListener("cursorleave",function(e){e.target.el&&(e.target.el.removeState("hovered"),t&&t.removeState("hovering"),n("mouseleave",e))})},initCollisionEvents:function(){var e=this.el.object3D,t=function(e,t){var n=t.target.el;n&&(t.target=n,t.other&&t.other.el&&(t.other=t.other.el),n.emit(e,t))};e.addEventListener("collisionenter",function(e){t("collisionenter",e)}),e.addEventListener("collisionexit",function(e){t("collisionexit",e)})}}),AFRAME.registerComponent("altspace-tracked-controls",{init:function(){this.gamepadIndex=null,this.trackedControlsSystem=document.querySelector("a-scene").systems["tracked-controls"],this.systemGamepads=0,altspace.getGamepads()},tick:function(){if(this.trackedControlsSystem&&this.systemGamepads!==this.trackedControlsSystem.controllers.length&&window.altspace&&altspace.getGamepads&&altspace.getGamepads().length){var e=this.el.components;e["paint-controls"]&&(this.gamepadIndex="left"===e["paint-controls"].data.hand?2:1),null===this.gamepadIndex&&e["hand-controls"]&&(this.gamepadIndex="left"===e["hand-controls"].data?2:1),null===this.gamepadIndex&&e["vive-controls"]&&(this.gamepadIndex="left"===e["vive-controls"].data.hand?2:1),null===this.gamepadIndex&&e["tracked-controls"]&&(this.gamepadIndex=e["tracked-controls"].data.controller),this.el.setAttribute("tracked-controls","id",altspace.getGamepads()[this.gamepadIndex].id),this.el.setAttribute("tracked-controls","controller",0),this.systemGamepads=this.trackedControlsSystem.controllers.length}}}),AFRAME.registerSystem("sync-system",{schema:{author:{type:"string","default":null},app:{type:"string","default":null},instance:{type:"string","default":null},"ref-url":{type:"string","default":null}},init:function(){var e=this;return this.data?(e.isConnected=!1,void altspace.utilities.sync.connect({authorId:this.data.author,appId:this.data.app,instanceId:this.data.instance,baseRefUrl:this.data["ref-url"]}).then(function(t){this.connection=t,this.sceneRef=this.connection.instance.child("scene"),this.clientsRef=this.connection.instance.child("clients"),this.clientId=this.sceneEl.object3D.uuid;var n;this.clientsRef.on("value",function(e){var t=e.val(),i=Object.keys(t)[0];n=t[i]}),this.clientsRef.on("child_added",function(t){var n=t.val();setTimeout(function(){e.sceneEl.emit("clientjoined",{id:n},!1)},0)}),this.clientsRef.on("child_removed",function(t){var n=t.val();setTimeout(function(){e.sceneEl.emit("clientleft",{id:n},!1)},0)}),this.clientsRef.push(this.clientId).onDisconnect().remove(),this.connection.instance.child("initialized").once("value",function(t){var n=!t.val();t.ref().set(!0),e.sceneEl.emit("connected",{shouldInitialize:n},!1),e.isConnected=!0}.bind(this)),Object.defineProperty(this,"isMasterClient",{get:function(){return n===this.clientId}.bind(this)})}.bind(this))):void console.warn("The sync-system must be present on the scene and configured with required data.")}}),AFRAME.registerComponent("sync",{schema:{mode:{"default":"link"},ownOn:{type:"string"}},init:function(){function e(){if(s.addEventListener("clientleft",function(e){var t=(!c||c===e.detail.id)&&l.isMasterClient;t&&u.takeOwnership()}),"link"!==u.data.mode)return void console.error("Unsupported sync mode: "+u.data.mode);var e=u.el.id;return e?(console.log("syncSys: "+l),console.log("syncSys.sceneRef: "+l.sceneRef),t(l.sceneRef.child(e)),n(),u.isConnected=!0,void u.el.emit("connected",null,!1)):void console.error("Entities cannot be synced using link mode without an id.")}function t(e){i=e,a=i.key(),r=i.child("data"),u.dataRef=r,o=i.child("owner")}function n(){o.transaction(function(e){if(!e)return o.onDisconnect().set(null),l.clientId}),o.on("value",function(e){var t=e.val(),n=t===l.clientId&&!d;n&&u.el.emit("ownershipgained",null,!1);var i=t!==l.clientId&&d;i&&(u.el.emit("ownershiplost",null,!1),o.onDisconnect().cancel()),c=t,d=t===l.clientId})}var i,a,r,o,c,s=document.querySelector("a-scene"),l=s.systems["sync-system"],d=!1,u=this;if(u.isConnected=!1,l.isConnected?e():s.addEventListener("connected",e),u.data.ownOn)for(var h=u.data.ownOn.split(/[ ,]+/),p=0,v=h.length;p<v;p++)u.el.addEventListener(h[p],function(){u.isConnected&&u.takeOwnership()});u.takeOwnership=function(){o.set(l.clientId),o.onDisconnect().set(null)},Object.defineProperty(u,"isMine",{get:function(){return d}})}}),AFRAME.registerComponent("sync-transform",{dependencies:["sync"],schema:{},init:function(){function e(){function e(e,i){if(!n.isMine){var a=e.val();a&&t.el.setAttribute(i,a)}}function i(e){if(n.isMine){var t=e.detail.name,i=e.detail.newData;if("position"===t)l(i);else if("rotation"===t)d(i);else{if("scale"!==t)return;u(i)}}}function a(e,t,n){var i,a,r,o,c=0;n||(n={});var s=function(){c=n.leading===!1?0:Date.now(),i=null,o=e.apply(a,r),i||(a=r=null)},l=function(){var l=Date.now();c||n.leading!==!1||(c=l);var d=t-(l-c);return a=this,r=arguments,d<=0||d>t?(i&&(clearTimeout(i),i=null),c=l,o=e.apply(a,r),i||(a=r=null)):i||n.trailing===!1||(i=setTimeout(s,d)),o};return l.cancel=function(){clearTimeout(i),c=0,i=a=r=null},l}var r=n.dataRef.child("position"),o=n.dataRef.child("rotation"),c=n.dataRef.child("scale");t.updateRate=100;var s=[];t.el.addEventListener("ownershiplost",function(){for(var e=t.el.children,n=0;n<e.length;n++){var i=e[n].tagName.toLowerCase();"a-animation"===i&&(s.push(e[n]),e[n].stop())}}),t.el.addEventListener("ownershipgained",function(){for(var e=0;e<s.length;e++){var t=s[e];t.start()}s=[]}),r.on("value",function(t){e(t,"position")}),o.on("value",function(t){e(t,"rotation")}),c.on("value",function(t){e(t,"scale")});var l=a(function(e){r.set(e)},t.updateRate),d=a(function(e){o.set(e)},t.updateRate),u=a(function(e){c.set(e)},t.updateRate);t.el.addEventListener("componentchanged",i)}var t=this,n=t.el.components.sync;n.isConnected?e():t.el.addEventListener("connected",e)}}),AFRAME.registerComponent("sync-color",{dependencies:["sync"],schema:{},init:function(){function e(){var e=n.dataRef.child("material/color"),i=!1,a=!0;t.el.addEventListener("componentchanged",function(t){var a=t.detail.name,r=t.detail.oldData,o=t.detail.newData;"material"===a&&(i||r.color!==o.color&&n.isMine&&setTimeout(function(){e.set(o.color)},0))}),e.on("value",function(e){if(!n.isMine||a){var r=e.val();i=!0,t.el.setAttribute("material","color",r),i=!1,a=!1}})}var t=this,n=t.el.components.sync;n.isConnected?e():t.el.addEventListener("connected",e)}})}]);