!function(e){function t(i){if(a[i])return a[i].exports;var r=a[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t){if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");AFRAME.registerComponent("editor",{_setSelectedObject:function(e){e.target.el.dataset.editorAsset||(this.placingObject&&(this.placingObject=null,this.raycastFloor.userData.altspace.collider.enabled=!1),this.selectedObject=e.target)},_moveSelectedObject:function(e){if(this.selectedObject){var t=this.selectedObject.el,a=Object.assign({},t.components.position.data);switch(e.keyCode){case"I".charCodeAt(0):a.z--;break;case"J".charCodeAt(0):a.x--;break;case"K".charCodeAt(0):a.z++;break;case"L".charCodeAt(0):a.x++;break;case"P".charCodeAt(0):a.y+=.25;break;case";".charCodeAt(0):a.y-=.25}t.setAttribute("position",a)}},_placeObject:function(e){if(this.placingObject){this.raycastFloor.userData.altspace.collider.enabled=!0,this.raycaster.set(e.ray.origin,e.ray.direction);var t=this.raycaster.intersectObject(this.raycastFloor)[0];if(t){var a=t.point.clone().multiplyScalar(1/this.scene.object3D.scale.x);a.x=Math.ceil(a.x),a.z=Math.floor(a.z),a.x+=.5,a.z-=.5,this.placingObject.setAttribute("position",a)}}},_assets:["Architecture/Ceiling_2Wx2L","Architecture/Ceiling_2Wx4L","Architecture/Ceiling_4Wx2L","Architecture/Ceiling_4Wx4L","Architecture/Ceiling_Skylight_4Wx4L","Architecture/Ceiling_Skylight_Corner_2Wx2L","Architecture/Ceiling_Skylight_Edge_2W","Architecture/Ceiling_Skylight_Edge_4W","Architecture/Ceiling_Skylight_Filled_4Wx4L","Architecture/Ceiling_Skylight_Filled2_4Wx4L","Architecture/Ceiling_Slice_Concave_2R","Architecture/Ceiling_Slice_Concave_4R","Architecture/Ceiling_Slice_Convex_2R","Architecture/Ceiling_Slice_Convex_4R","Architecture/Door_4Wx4H","Architecture/Floor_2Wx2L","Architecture/Floor_2Wx4L","Architecture/Floor_4Wx2L","Architecture/Floor_4Wx4L","Architecture/Floor_Slice_Concave_2R","Architecture/Floor_Slice_Concave_4R","Architecture/Floor_Slice_Convex_2R","Architecture/Floor_Slice_Convex_4R","Architecture/Railing_2L","Architecture/Railing_4L","Architecture/Railing_Curve_Concave_2R","Architecture/Wall_2Wx4H","Architecture/Wall_4Wx4H","Architecture/Wall_Base_2W","Architecture/Wall_Base_4W","Architecture/Wall_Base_Curve_Concave_2R","Architecture/Wall_Base_Curve_Concave_4R","Architecture/Wall_Base_Curve_Convex_2R","Architecture/Wall_Base_Curve_Convex_4R","Architecture/Wall_Bulkhead_2W","Architecture/Wall_Bulkhead_4W","Architecture/Wall_Bulkhead_Curve_Concave_2R","Architecture/Wall_Bulkhead_Curve_Concave_4R","Architecture/Wall_Bulkhead_Curve_Convex_2R","Architecture/Wall_Bulkhead_Curve_Convex_4R","Architecture/Wall_Curve_Concave_2Rx4H","Architecture/Wall_Curve_Concave_4Rx4H","Architecture/Wall_Curve_Convex_2Rx4H","Architecture/Wall_Curve_Convex_4Rx4H","Architecture/Wall_Curve_Window_Concave_4Rx4H","Architecture/Wall_Curve_Window_Gap_Concave_4Rx4H","Architecture/Wall_Curve_Window_Gap_End_L_Concave_4Rx4H","Architecture/Wall_Curve_Window_Gap_End_R_Concave_4Rx4H","Architecture/Wall_Filler_Corner_Inner_4H","Architecture/Wall_Filler_Corner_Outer_4H","Architecture/Wall_Window_4Wx4H","Architecture/Wall_Window_GapEnd_R_4Wx4H","Architecture/Wall_Window_Gap_2Wx4H","Architecture/Wall_Window_Gap_4Wx4H","Architecture/Wall_Window_Gap_End_L_2Wx4H","Architecture/Wall_Window_Gap_End_L_4Wx4H","Architecture/Wall_Window_Gap_End_R_2Wx4H","Architecture/Wall_Window2","Architecture/Window_Wall_Curve_Concave_4Rx4H"],_setPlacingObject:function(e){var t=document.createElement("a-entity");t.setAttribute("native-object",{asset:e.target.el.components["native-object"].data.asset}),this.placingObject=t,this.scene.appendChild(t)},_addAssetToPalette:function(e,t){var a=document.createElement("a-entity");a.dataset.editorAsset=!0,a.setAttribute("native-object",{asset:e}),setTimeout(function(e){return function(){e.setAttribute("scale","0.05 0.05 0.05")}}(a),500);var i=3,r=.2,n=1+1/3,c={x:t%i*(r*n),y:-Math.floor(t/i)*(r*n)};a.setAttribute("position",c),a.object3D.addEventListener("cursordown",this._setPlacingObject.bind(this)),this.palette.appendChild(a)},_createPalette:function(){this.palette=document.createElement("a-entity"),this.palette.id="editorPalette",this.palette.setAttribute("position","0 1.5 5"),this._assets.forEach(this._addAssetToPalette.bind(this)),this.scene.appendChild(this.palette)},init:function(){this.scene=document.querySelector("a-scene"),this.scene.object3D.addEventListener("cursordown",this._setSelectedObject.bind(this)),window.addEventListener("keydown",this._moveSelectedObject.bind(this)),this.raycastFloor=new THREE.Mesh(new THREE.PlaneGeometry(100,100),new THREE.MeshBasicMaterial({color:"white"})),this.raycastFloor.material.visible=!1,this.raycastFloor.userData.altspace={collider:{enabled:!1}};var e=function(){};this.raycastFloor.el={removeState:e,addState:e,emit:e},this.raycastFloor.rotation.x=-Math.PI/2,this.scene.object3D.add(this.raycastFloor),this.raycaster=new THREE.Raycaster,this.scene.object3D.addEventListener("cursormove",this._placeObject.bind(this)),this._createPalette()}}),AFRAME.registerComponent("native",{schema:{asset:{type:"string"},attributes:{type:"string"}},init:function(){this.el.setObject3D("native",altspace.instantiateNativeObject(this.data.asset))},update:function(e){this.data.attributes&&altspace._internal.callClientFunction("UpdateNativeAttributes",{MeshId:this.el.object3DMap["native"].id,Attributes:this.data.attributes},{argsType:"JSTypeUpdateNativeAttributes"})},remove:function(){this.el.removeObject3D("native")}}),function(){function e(e,t){function a(){var t=this.el.getOrCreateObject3D("mesh",THREE.Mesh);altspace._internal.callClientFunction("AddNativeComponent",{MeshId:t.id,Type:e},{argsType:"JSTypeAddNativeComponent"})}function i(t){console.log("calling update for "+this.el.object3DMap.mesh.id),altspace._internal.callClientFunction("UpdateNativeComponent",{MeshId:this.el.object3DMap.mesh.id,ComponentName:e,Attributes:JSON.stringify(this.data)},{argsType:"JSTypeUpdateNativeComponent"})}t.init=t.init||a,t.update=t.update||i,AFRAME.registerComponent(e,t)}function t(e){return"true"===e}var a={"default":"false false false",parse:function(e){return e.split(" ").map(t)},stringify:function(e){return e.join(" ")}};e("n-sphere-collider",{schema:{isTrigger:{"default":!1,type:"boolean"},radius:{"default":"0",type:"number"},center:{type:"vec3"}}}),e("n-rigidbody",{schema:{mass:{"default":1,type:"number"},drag:{"default":0,type:"number"},angularDrag:{"default":.05,type:"number"},useGravity:{"default":!0,type:"boolean"},isKinematic:{"default":!1,type:"boolean"},positionConstraints:a,rotationConstraints:a}})}(),AFRAME.registerPrimitive("n-entity",{defaultComponents:{"native":{}},mappings:{asset:"native.asset",attributes:"native.attributes"}}),AFRAME.registerComponent("altspace",{schema:{usePixelScale:{type:"boolean","default":"false"},verticalAlign:{type:"string","default":"middle"}},init:function(){return this.el.object3D instanceof THREE.Scene?void(window.altspace&&window.altspace.inClient?(this.el.setAttribute("vr-mode-ui",{enabled:!1}),this.initRenderer(),this.initCursorEvents()):console.warn("aframe-altspace-component only works inside of AltspaceVR")):void console.warn("aframe-altspace-component can only be attached to a-scene")},update:function(e){},remove:function(){},pause:function(){},play:function(){},initRenderer:function(){var e=this.el.object3D;this.data.usePixelScale||altspace.getEnclosure().then(function(t){e.scale.multiplyScalar(t.pixelsPerMeter)});var t=this.data.verticalAlign;"center"!==t&&altspace.getEnclosure().then(function(a){switch(t){case"bottom":e.position.y-=a.innerHeight/2;break;case"top":e.position.y+=a.innerHeight/2;break;default:console.warn("Unexpected value for verticalAlign: ",this.data.verticalAlign)}});var a=this.el.renderer=this.el.effect=altspace.getThreeJSRenderer(),i=function(){};a.setSize=i,a.setPixelRatio=i,a.setClearColor=i,a.clear=i,a.enableScissorTest=i,a.setScissor=i,a.setViewport=i,a.getPixelRatio=i,a.getMaxAnisotropy=i,a.setFaceCulling=i,a.context={canvas:{}},a.shadowMap={}},initCursorEvents:function(){var e=this.el.object3D,t=document.querySelector("a-cursor")||document.querySelector("a-entity[cursor]");t&&(t.setAttribute("material","transparent",!0),t.setAttribute("material","opacity",0));var a=function(e,a){t&&t.emit(e,{target:a}),a&&a.emit(e,{target:a})},i=null;e.addEventListener("cursordown",function(e){i=e.target,a("mousedown",e.target.el)}),e.addEventListener("cursorup",function(e){a("mouseup",e.target.el),e.target.uuid===i.uuid&&a("click",e.target.el),i=null}),e.addEventListener("cursorenter",function(e){e.target.el&&(e.target.el.addState("hovered"),t&&t.addState("hovering"),a("mouseenter",e.target.el))}),e.addEventListener("cursorleave",function(e){e.target.el&&(e.target.el.removeState("hovered"),t&&t.removeState("hovering"),a("mouseleave",e.target.el))})}}),AFRAME.registerComponent("altspace-tracked-controls",{init:function(){this.gamepadIndex=null,this.trackedControlsSystem=document.querySelector("a-scene").systems["tracked-controls"],this.systemGamepads=0,altspace.getGamepads()},tick:function(){if(this.trackedControlsSystem&&this.systemGamepads!==this.trackedControlsSystem.controllers.length&&window.altspace&&altspace.getGamepads&&altspace.getGamepads().length){var e=this.el.components;e["paint-controls"]&&(this.gamepadIndex="left"===e["paint-controls"].data.hand?2:1),null===this.gamepadIndex&&e["hand-controls"]&&(this.gamepadIndex="left"===e["hand-controls"].data?2:1),null===this.gamepadIndex&&e["vive-controls"]&&(this.gamepadIndex="left"===e["vive-controls"].data.hand?2:1),null===this.gamepadIndex&&e["tracked-controls"]&&(this.gamepadIndex=e["tracked-controls"].data.controller),this.el.setAttribute("tracked-controls","id",altspace.getGamepads()[this.gamepadIndex].id),this.el.setAttribute("tracked-controls","controller",0),this.systemGamepads=this.trackedControlsSystem.controllers.length}}})}]);