{"version":3,"file":"altspace.min.js.map","sources":["../../src/components/AFrameComponent.js","../../src/components/utilities.js","../../src/utilities/sync.js","../../src/utilities/multiloader.js","../../src/utilities/codepen.js","../../src/components/AltspaceCursorCollider.js","../../src/components/AltspaceTrackedControls.js","../../src/components/AltspaceComponent.js","../../src/components/SyncColor.js","../../src/components/SyncComponent.js","../../src/components/SyncSystem.js","../../src/components/sync-transform.js","../../src/components/sync-n-sound.js","../../src/components/native-components.js","../../src/components/wire.js","../../src/components/index.js","../../src/utilities/simulation.js","../../src/index.js"],"sourcesContent":["'use strict';\r\n\r\n/**\r\n* Stubs out the A-Frame \"system\" concept.\r\n* @see {@link https://aframe.io/docs/0.3.0/core/systems.html}\r\n*/\r\nclass AFrameSystem\r\n{\r\n\tget schema(){\r\n\t\treturn null;\r\n\t}\r\n\r\n\tinit(){ }\r\n\ttick(time, timeDelta){ }\r\n\tpause(){ }\r\n\tplay(){ }\r\n}\r\n\r\n/**\r\n* Stubs out the A-Frame \"component\" concept.\r\n* @extends AFrameSystem\r\n* @see {@link https://aframe.io/docs/0.3.0/core/component.html}\r\n*/\r\nclass AFrameComponent extends AFrameSystem\r\n{\r\n\tupdate(oldData){ }\r\n\tremove(){ }\r\n\tupdateSchema(data){ }\r\n}\r\n\r\nfunction flatten(obj)\r\n{\r\n\tlet ret = {};\r\n\tif(!obj.__proto__){\r\n\t\tret = Object.assign( {schema: {}, dependencies: []}, obj );\r\n\t}\r\n\telse {\r\n\t\tret = Object.assign( flatten(obj.__proto__), obj );\r\n\t}\r\n\r\n\tif(obj.schema)\r\n\t\tObject.assign(ret.schema, obj.schema);\r\n\r\n\tif(obj.dependencies)\r\n\t\tret.dependencies.push(...obj.dependencies);\r\n\r\n\treturn ret;\r\n}\r\n\r\nfunction registerComponentClass(name, cls)\r\n{\r\n\tAFRAME.registerComponent(name, flatten(new cls(true)));\r\n}\r\n\r\nfunction registerSystemClass(name, cls)\r\n{\r\n\tAFRAME.registerSystem(name, flatten(new cls(true)));\r\n}\r\n\r\nexport { AFrameComponent, AFrameSystem, registerComponentClass, registerSystemClass, flatten };\r\n","'use strict';\r\n\r\nfunction safeDeepSet(obj, keys, value)\r\n{\r\n\tif(keys.length === 0)\r\n\t\treturn value;\r\n\telse {\r\n\t\tobj[keys[0]] = safeDeepSet(obj[keys[0]] || {}, keys.slice(1), value);\r\n\t\treturn obj;\r\n\t}\r\n}\r\n\r\nexport { safeDeepSet };\r\n","/**\r\n * The Sync utility is currently based on Firebase. It provides a quick way\r\n * to synchronize apps between users (even when they are running outside of\r\n * AltspaceVR).\r\n * During the SDK beta, please consider all data stored with the sync\r\n * utility to be ephemeral (it may be cleared or clobbered at any time).\r\n * You do not need a Firebase account to use the Sync utility.\r\n *\r\n *\r\n * Refer to the [Firebase API documentation](https://www.firebase.com/docs/web/api/)\r\n * when working with the sync instance.\r\n * @module altspace/utilities/sync\r\n */\r\n\r\nlet Firebase = window.Firebase;\r\nlet inAltspace = altspace && altspace.inClient;\r\nlet canonicalUrl = getCanonicalUrl();\r\n\r\nlet instance;\r\n\r\nfunction dashEscape(keyName) {\r\n\treturn keyName ? encodeURIComponent(keyName).replace(/\\./g, '%2E').replace(/%[A-Z0-9]{2}/g, '-') : null;\r\n}\r\n\r\nfunction getCanonicalUrl() {\r\n\tvar canonicalElement = document.querySelector('link[rel=canonical]');\r\n\treturn canonicalElement ? canonicalElement.href : window.location.href;\r\n}\r\n\r\nfunction getProjectId(appId, authorId, canonicalUrl) {\r\n\treturn dashEscape(authorId || canonicalUrl) + ':' + dashEscape(appId || '');\r\n}\r\n\r\n\r\n/**\r\n* Retreived\r\n* via [altspace.utilities.sync.connect]{@link module:altspace/utilities/sync#connect}.\r\n* @class module:altspace/utilities/sync~Connection\r\n* @memberof module:altspace/utilities/sync\r\n*/\r\n\r\n/**\r\n* (In-client only) A Firebase reference for the current user (on a per app basis). This can be used for things like a persistent inventory or personal highscores.\r\n* @instance\r\n* @member {Firebase} user\r\n* @memberof module:altspace/utilities/sync~Connection\r\n*/\r\n\r\n/**\r\n* A Firebase reference to the current instance of the app.\r\n* This will change if the query paramater is removed through navigation, rebeaming, the space timing out, or other reasons.\r\n* This can be used as an input to SceneSync\r\n* @instance\r\n* @member {Firebase} instance\r\n* @memberof module:altspace/utilities/sync~Connection\r\n*/\r\n\r\n/**\r\n* (In-client only) A Firebase reference for the current space. Especially useful if multiple apps / instances need to communicate inside the space.\r\n* @instance\r\n* @member {Firebase} space\r\n* @memberof module:altspace/utilities/sync~Connection\r\n*/\r\n\r\n/**\r\n* A Firebase reference for the app.\r\n* This can be used for things like persistent high-scores, dynamic configuration, or inter-instance communication.\r\n* @instance\r\n* @member {Firebase} app\r\n* @memberof module:altspace/utilities/sync~Connection\r\n*/\r\n\r\n\r\n/**\r\n* Connect to a sync session to obtain Firebase references that can be used for syncronization of real-time and persistent state.\r\n* Returns a promise that will fulfill with a [Connection]{@link module:altspace/utilities/sync~Connection}.\r\n*\r\n* @method connect\r\n* @param {Object} config\r\n* @param {String} config.authorId A unique identifier for yourself or your organization\r\n* @param {String} config.appId The name of your app\r\n* @param {String} [config.baseRefUrl] Override the base reference. Set this to use your own Firebase.\r\n* @param {String} [config.instanceId] Override the instanceId. Can also be overriden using a query parameter.\r\n* @param {String} [config.spaceId] Override the spaceId. Can also be overriden using a query parameter.\r\n* @param {String} [config.userId] Override the userId. Can also be overriden using a query parameter.\r\n* @return {Promise}\r\n* @memberof module:altspace/utilities/sync\r\n**/\r\n//todo clients\r\nfunction connect(config)\r\n{\r\n\tconfig = config || {};\r\n\r\n\tvar url = new Url();\r\n\r\n\t// Our ref used for example apps. Data may be cleared periodically.\r\n\tvar baseRefUrl = config.baseRefUrl || 'https://altspace-apps.firebaseio.com/apps/examples/';\r\n\tvar baseRef = new Firebase(baseRefUrl);\r\n\r\n\t// Gather query paramaters (some may only be used as testing overrides)\r\n\tvar instanceId = config.instanceId || url.query['altspace-sync-instance'];\r\n\tvar spaceId = config.spaceId || url.query['altspace-sync-space'];\r\n\tvar userId = config.userId || url.query['altspace-sync-user'];\r\n\r\n\tif (!config.appId || !config.authorId) {\r\n\t\tthrow new Error('Both the appId and authorId must be provided to connect.');\r\n\t}\r\n\r\n\tvar tasks = [];\r\n\tif (inAltspace) {\r\n\t\tif (!spaceId) tasks.unshift(altspace.getSpace());\r\n\t\tif (!userId) tasks.unshift(altspace.getUser());\r\n\t}\r\n\r\n\tfunction getRefs() {\r\n\t\tvar refs = {};\r\n\r\n\t\tvar projectId = getProjectId(config.appId, config.authorId, canonicalUrl);\r\n\t\trefs.app = baseRef.child(projectId).child('app');\r\n\t\trefs.space = spaceId ? refs.app.child('spaces').child(spaceId) : null;\r\n\t\trefs.user = userId ? refs.app.child('users').child(userId) : null;\r\n\r\n\t\tvar instancesRef = refs.app.child('instances');\r\n\t\tif (instanceId) {\r\n\t\t\trefs.instance = instancesRef.child(instanceId);\r\n\t\t} else {\r\n\t\t\trefs.instance = instancesRef.push();\r\n\t\t\tinstanceId = refs.instance.key();\r\n\t\t}\r\n\t\treturn refs;\r\n\t}\r\n\r\n\tfunction updateUrl() {\r\n\t\tif (!url.query['altspace-sync-instance']) {\r\n\t\t\turl.query['altspace-sync-instance'] = instanceId;\r\n\t\t\twindow.location.href = url.toString();\r\n\t\t}\r\n\t}\r\n\r\n\treturn Promise.all(tasks).then(function (results) {\r\n\t\tif (inAltspace) {\r\n\t\t\tif (!spaceId) spaceId = results.pop().sid;\r\n\t\t\tif (!userId) userId = results.pop().userId;\r\n\t\t}\r\n\r\n\t\tspaceId = dashEscape(spaceId);\r\n\t\tuserId = dashEscape(userId);\r\n\t\tinstanceId = dashEscape(instanceId);\r\n\r\n\t\tvar connection = getRefs();\r\n\r\n\t\tupdateUrl();\r\n\r\n\t\treturn connection;\r\n\t});\r\n}\r\n\r\nexport { connect };\r\n","'use strict';\r\n\r\nvar loader;\r\nvar TRACE;\r\nvar baseUrl = '';\r\nvar crossOrigin = '';//assigned to THREE.MTLLoader.crossOrigin\r\n\r\nfunction LoadRequest(){\r\n\t//To create loadRequst: new MultiLoader.LoadRequest()\r\n\r\n\tvar objUrls = [];//Paths to model geometry file, in Wavefront OBJ format.\r\n\tvar mtlUrls = [];//Paths to model materials file, in Wavefront MTL format.\r\n\tvar objects = [];//objects[i] is result of loader.load(objUrl[i], mtlUrl[i])\r\n\tvar error;//String indicating loading error with at least one file.\r\n\tvar objectsLoaded = 0;//Used internally to determine when loading complete.\r\n\r\n\treturn {\r\n\t\tobjUrls: objUrls,\r\n\t\tmtlUrls: mtlUrls,\r\n\t\tobjects: objects,\r\n\t\terror: error,\r\n\t\tobjectsLoaded: objectsLoaded\r\n\t};\r\n\r\n}//end of LoadRequest\r\n\r\nfunction init(params){\r\n\tvar p = params || {};\r\n\tTRACE = p.TRACE || false;\r\n\tif (p.crossOrigin) crossOrigin = p.crossOrigin;\r\n\tif (p.baseUrl) baseUrl = p.baseUrl;\r\n\tif (baseUrl.slice(-1) !== '/') baseUrl += '/';\r\n\r\n\tloader = new altspace.utilities.shims.OBJMTLLoader();\r\n\tloader.crossOrigin = crossOrigin;\r\n\tif (TRACE) console.log('MultiLoader initialized with params', params);\r\n}\r\n\r\nfunction load(loadRequest, onComplete){\r\n\tvar req = loadRequest;\r\n\tvar start = Date.now();\r\n\tif (!req || !req instanceof LoadRequest){\r\n\t\tthrow new Error('MultiLoader.load expects first arg of type LoadRequest');\r\n\t}\r\n\tif (!onComplete || typeof(onComplete) !== 'function'){\r\n\t\tthrow new Error('MultiLoader.load expects second arg of type function');\r\n\t}\r\n\tif (!req.objUrls || !req.mtlUrls || req.objUrls.length !== req.mtlUrls.length){\r\n\t\tthrow new Error('MultiLoader.load called with bad LoadRequest');\r\n\t}\r\n\tvar reqCount = req.objUrls.length;\r\n\tif (TRACE) console.log('Loading models...')\r\n\tfor (var i=0; i < reqCount; i++){\r\n\t\tvar loadModel = function(req, i){//We need i in the closure to store result.\r\n\t\t\tvar objUrl = baseUrl + req.objUrls[i];\r\n\t\t\tvar mtlUrl = baseUrl + req.mtlUrls[i];\r\n\t\t\tif (TRACE) console.log('Loading obj:'+objUrl+', mtl:'+mtlUrl);\r\n\t\t\tloader.load(objUrl, mtlUrl, function(object3d){//onLoaded\r\n\t\t\t\treq.objects[i] = object3d;\r\n\t\t\t\treq.objectsLoaded++;\r\n\t\t\t\tif(req.objectsLoaded === reqCount){\r\n\t\t\t\t\tvar elapsed = ((Date.now()-start)/1000.0).toFixed(2);\r\n\t\t\t\t\tif (TRACE) console.log('Loaded '+reqCount+' models in '+elapsed+' seconds');\r\n\t\t\t\t\tonComplete();\r\n\t\t\t\t}\r\n\t\t\t}, onProgress, function(){//onError\r\n\t\t\t\tvar url = xhr.target.responseURL || '';\r\n\t\t\t\treq.error = 'Error loading file '+url;\r\n\t\t\t});\r\n\t\t};\r\n\t\tloadModel(req, i);\r\n\t}\r\n}\r\n\r\nfunction onProgress(xhr){\r\n\tif (xhr.lengthComputable && xhr.target.responseURL) {\r\n\t\t//Skip progress log if no xhr url, meaning it's a local file.\r\n\t\tvar percentComplete = xhr.loaded / xhr.total * 100;\r\n\t\tvar filename = xhr.target.responseURL.split('/').pop();\r\n\t\tif (TRACE) console.log('...'+filename+' '+Math.round(percentComplete,2)+'% downloaded');\r\n\t}\r\n}\r\n\r\nexport { init, load, LoadRequest };\r\n","/**\r\n * Utilities to help build AltspaceVR apps on CodePen.io.\r\n * @module altspace/utilities/codePen\r\n */\r\n\r\nvar Please = window.Please;\r\nvar Url = window.Url;\r\n\r\nvar name = 'VR CodePen';\r\nvar inTile = window.name && window.name.slice(0, 4) === 'pen-';\r\nvar inVR = !!window.altspace.inClient;\r\nvar inCodePen = !!location.href.match('codepen.io/');\r\n\r\nfunction printDebugInfo() {\r\n\tconsole.log(\"In a tile: \" + inTile);\r\n\tconsole.log(\"In VR: \" + inVR);\r\n}\r\n\r\n/**\r\n * Will stop code exection and post a message informing the user to\r\n * open the example in VR\r\n * @method ensureInVR\r\n * @memberof module:altspace/utilities/codePen\r\n */\r\nfunction ensureInVR() {\r\n\tif (inTile || !inVR) //inTile && inAltspace\r\n\t{\r\n\t\tvar css = document.createElement(\"style\");\r\n\t\tcss.type = \"text/css\";\r\n\t\tcss.innerHTML = \"@import url(https://fonts.googleapis.com/css?family=Open+Sans:800);.altspace-info{text-align:center;font-family:'Open Sans',sans-serif;line-height:.5}.altspace-vr-notice{color:rgba(0,0,0,.7);font-size:5vw}.altspace-pen-name{font-size:7vw}\";\r\n\t\tdocument.head.appendChild(css);\r\n\r\n\t\tdocument.body.style.background = Please.make_color({ seed: getPenId() });\r\n\r\n\t\tvar info = document.createElement(\"div\");\r\n\t\tinfo.className = \"altspace-info\";\r\n\t\tdocument.body.appendChild(info);\r\n\r\n\t\tvar nameEl = document.createElement(\"span\");\r\n\t\tnameEl.className = \"altspace-pen-name\";\r\n\t\tnameEl.innerHTML = '<p>' + name.toUpperCase() + '</p>';\r\n\t\tinfo.appendChild(nameEl);\r\n\r\n\t\tif (inTile) {\r\n\t\t\tvar errorMsg = 'VR mode does not support preview tiles. Stopping code execution.';\r\n\t\t\tconsole.log('ERROR: ' + errorMsg);\r\n\t\t\tthrow new Error(errorMsg);\r\n\t\t}\r\n\r\n\t\tif (!inVR) {\r\n\r\n\t\t\tvar launchEl = document.createElement(\"span\");\r\n\t\t\tlaunchEl.className = \"altspace-vr-notice\";\r\n\t\t\tlaunchEl.innerHTML = '<p>View</p>';\r\n\t\t\tinfo.insertBefore(launchEl, nameEl);\r\n\r\n\t\t\tvar notice = document.createElement(\"span\");\r\n\t\t\tnotice.className = \"altspace-vr-notice\";\r\n\t\t\tnotice.innerHTML = '<p>in <a href=\"http://altvr.com\"> AltspaceVR </a></p>';\r\n\t\t\tinfo.appendChild(notice);\r\n\r\n\r\n\t\t\tvar errorMsg = 'Not in VR mode. Stopping code execution.';\r\n\t\t\tif (inTile) {\r\n\t\t\t\tconsole.log('ERROR: ' + errorMsg);//thrown error message not displayed in console when inTile, log it\r\n\t\t\t}\r\n\t\t\tthrow new Error(errorMsg);\r\n\t\t}\r\n\t\treturn;\r\n\r\n\t}\r\n}\r\n\r\n/**\r\n * Sets the name to be used by ensureInVR()\r\n * @method setName\r\n * @param {String} name\r\n * @memberof module:altspace/utilities/codePen\r\n */\r\nfunction setName(n) {//TODO: A better method for this would be awesome\r\n\tname = n;\r\n}\r\n\r\nfunction getParsedUrl() {\r\n\tvar canonicalElement = document.querySelector('link[rel=canonical]');\r\n\tvar fullUrl = canonicalElement ? canonicalElement.href : window.location.href;\r\n\treturn new Url(fullUrl);\r\n}\r\n\r\n\r\n/**\r\n * Returns the pen ID, useful for setting the sync instanceId.\r\n * @method getPenId\r\n * @return {String}\r\n * @memberof module:altspace/utilities/codePen\r\n */\r\nfunction getPenId() {\r\n\tvar url = getParsedUrl();\r\n\tvar splitPath = url.path.split('/');\r\n\tvar id = splitPath[splitPath.length - 1];\r\n\treturn id;\r\n}\r\n\r\n/**\r\n * Returns the pen author ID, useful for setting the sync authorId.\r\n * @method getAuthorId\r\n * @return {String}\r\n * @memberof module:altspace/utilities/codePen\r\n */\r\nfunction getAuthorId() {\r\n\tvar url = getParsedUrl();\r\n\tvar splitPath = url.path.split('/');\r\n\tvar isTeam = splitPath[1] == 'team';\r\n\tvar id = isTeam ? 'team-' + splitPath[2] : splitPath[1];\r\n\treturn id;\r\n}\r\n\r\nexport { inTile, inVR, inCodePen, ensureInVR, setName, getPenId, getAuthorId, printDebugInfo };\r\n","/**\r\n* Enable or disable cursor collision on the object.\r\n* @mixin altspace-cursor-collider\r\n* @memberof altspace\r\n* @prop {boolean} enabled=true - The state of the cursor collider.\r\n*/\r\n\r\n'use strict';\r\n\r\nimport {AFrameComponent} from './AFrameComponent';\r\nimport {safeDeepSet} from './utilities';\r\n\r\n\r\nexport default class AltspaceCursorCollider extends AFrameComponent\r\n{\r\n\tget schema(){\r\n\t\treturn {enabled: {type: 'boolean', default: 'true'}};\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tthis.setColliderFlag(this.data.enabled);\r\n\t\tthis.el.addEventListener('model-loaded', (() => {\r\n\t\t\tthis.setColliderFlag(this.data.enabled);\r\n\t\t}).bind(this));\r\n\t}\r\n\r\n\tupdate()\r\n\t{\r\n\t\tthis.setColliderFlag(this.data.enabled);\r\n\t}\r\n\r\n\tsetColliderFlag(state)\r\n\t{\r\n\t\tlet obj = this.el.object3D;\r\n\t\tif(obj){\r\n\t\t\tconsole.log('Setting collider flag to', state);\r\n\t\t\tsafeDeepSet(obj.userData, ['altspace','collider','enabled'], state);\r\n\t\t\tobj.traverse(subobj => {\r\n\t\t\t\tif( subobj instanceof THREE.Mesh ){\r\n\t\t\t\t\tsafeDeepSet(subobj.userData, ['altspace','collider','enabled'], state);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n};\r\n","/**\r\n* Enables tracked control support for A-Frame applications that use the built-in\r\n* `tracked-controls`, `vive-controls` or `hand-controls` components.\r\n* @mixin altspace-tracked-controls\r\n* @memberof altspace\r\n*/\r\n'use strict';\r\n\r\nimport {AFrameComponent} from './AFrameComponent';\r\n\r\nexport default class AltspaceTrackedControls extends AFrameComponent\r\n{\r\n\tinit()\r\n\t{\r\n\t\tthis.gamepadIndex = null;\r\n\t\tthis.trackedControlsSystem = document.querySelector('a-scene').systems['tracked-controls'];\r\n\t\tthis.systemGamepads = 0;\r\n\t\taltspace.getGamepads();\r\n\t}\r\n\r\n\ttick()\r\n\t{\r\n\t\tif (\r\n\t\t\tthis.trackedControlsSystem &&\r\n\t\t\tthis.systemGamepads !== this.trackedControlsSystem.controllers.length &&\r\n\t\t\twindow.altspace && altspace.getGamepads && altspace.getGamepads().length\r\n\t\t) {\r\n\t\t\tvar components = this.el.components;\r\n\t\t\tif (components['paint-controls']) {\r\n\t\t\t\tthis.gamepadIndex = components['paint-controls'].data.hand === 'left' ? 2 : 1;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.gamepadIndex === null && components['hand-controls']) {\r\n\t\t\t\tthis.gamepadIndex = components['hand-controls'].data === 'left' ? 2 : 1;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.gamepadIndex === null && components['vive-controls']) {\r\n\t\t\t\tthis.gamepadIndex = components['vive-controls'].data.hand === 'left' ? 2 : 1;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.gamepadIndex === null && components['tracked-controls']) {\r\n\t\t\t\tthis.gamepadIndex = components['tracked-controls'].data.controller;\r\n\t\t\t}\r\n\r\n\t\t\tthis.el.setAttribute('tracked-controls', 'id', altspace.getGamepads()[this.gamepadIndex].id);\r\n\t\t\tthis.el.setAttribute('tracked-controls', 'controller', 0);\r\n\t\t\tthis.systemGamepads = this.trackedControlsSystem.controllers.length;\r\n\t\t}\r\n\t}\r\n}\r\n","/**\r\n* @namespace altspace\r\n*/\r\n\r\n/**\r\n* The altspace component makes A-Frame apps compatible with AltspaceVR.\r\n*\r\n* **Note**: If you use the `embedded` A-Frame component on your scene, you must include it *before* the `altspace` component, or your app will silently fail.\r\n* @mixin altspace\r\n* @memberof altspace\r\n* @property {boolean} usePixelScale=`false` - Allows you to use A-Frame units as CSS pixels.\r\n* This is the default behavior for three.js apps, but not for A-Frame apps.\r\n* @property {string} verticalAlign=`middle` - Puts the origin at the `bottom`, `middle` (default),\r\n* or `top` of the Altspace enclosure.\r\n* @property {boolean} enclosuresOnly=`true` - Prevents the scene from being created if\r\n* enclosure is flat.\r\n* @property {boolean} fullspace=`false` - Puts the app into fullspace mode.\r\n*\r\n* @example\r\n* <head>\r\n*   <title>My A-Frame Scene</title>\r\n*   <script src=\"https://aframe.io/releases/0.3.0/aframe.min.js\"></script>\r\n*   <script src=\"https://cdn.rawgit.com/AltspaceVR/aframe-altspace-component/vAFRAME_ALTSPACE_VERSION/dist/aframe-altspace-component.min.js\"></script>\r\n* </head>\r\n* <body>\r\n*   <a-scene altspace>\r\n*     <a-entity geometry=\"primitive: box\" material=\"color: #C03546\"></a-entity>\r\n*   </a-scene>\r\n* </body>\r\n*/\r\n'use strict';\r\n\r\nimport {AFrameComponent} from './AFrameComponent';\r\n\r\nexport default class AltspaceComponent extends AFrameComponent\r\n{\r\n\tget schema(){\r\n\t\treturn {\r\n\t\t\tusePixelScale: { type: 'boolean', default: 'false'},\r\n\t\t\tverticalAlign: { type: 'string',  default: 'middle'},\r\n\t\t\tenclosuresOnly:{ type: 'boolean', default: 'true'},\r\n\t\t\tfullspace:     { type: 'boolean', default: 'false'}\r\n\t\t}\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tthis.version = 'AFRAME_ALTSPACE_VERSION';\r\n\t\tif(!this.el.object3D instanceof THREE.Scene){\r\n\t\t\tconsole.warn('aframe-altspace-component can only be attached to a-scene');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (window.altspace && window.altspace.inClient) {\r\n\t\t\tthis.el.setAttribute('vr-mode-ui', {enabled: false});\r\n\t\t\tthis.initRenderer();\r\n\t\t\tthis.initCursorEvents();\r\n\t\t\tthis.initCollisionEvents();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconsole.warn('aframe-altspace-component only works inside of AltspaceVR');\r\n\t\t}\r\n\t}\r\n\r\n\ttick(t, dt)\r\n\t{\r\n\t\tif(this.el.object3D.updateAllBehaviors)\r\n\t\t\tthis.el.object3D.updateAllBehaviors();\r\n\t}\r\n\r\n\t/*\r\n\t* Swap in Altspace renderer when running in AltspaceVR.\r\n\t*/\r\n\tinitRenderer()\r\n\t{\r\n\t\tlet scene = this.el.object3D;\r\n\t\taltspace.getEnclosure().then((e =>\r\n\t\t{\r\n\t\t\tif(this.data.fullspace){\r\n\t\t\t\te.requestFullspace();\r\n\t\t\t\te.addEventListener('fullspacechange', () => {\r\n\t\t\t\t\tscene.scale.setScalar(e.pixelsPerMeter);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (!this.data.usePixelScale || this.data.fullspace){\r\n\t\t\t\tscene.scale.setScalar(e.pixelsPerMeter);\r\n\t\t\t}\r\n\r\n\t\t\tswitch (this.data.verticalAlign) {\r\n\t\t\t\tcase 'bottom':\r\n\t\t\t\t\tscene.position.y -= e.innerHeight / 2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'top':\r\n\t\t\t\t\tscene.position.y += e.innerHeight / 2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'middle':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconsole.warn('Unexpected value for verticalAlign: ', this.data.verticalAlign);\r\n\t\t\t}\r\n\r\n\t\t\tif(this.data.enclosuresOnly && e.innerDepth === 1){\r\n\t\t\t\tthis.el.renderer.render(new THREE.Scene());\r\n\t\t\t\tthis.el.renderer = this.el.effect = oldRenderer;\r\n\r\n\t\t\t}\r\n\t\t}).bind(this));\r\n\r\n\t\tlet oldRenderer = this.el.renderer;\r\n\t\tlet renderer = this.el.renderer = this.el.effect = altspace.getThreeJSRenderer({\r\n\t\t\taframeComponentVersion: this.version\r\n\t\t});\r\n\r\n\t\tlet noop = function() {};\r\n\t\trenderer.setSize = noop;\r\n\t\trenderer.setPixelRatio = noop;\r\n\t\trenderer.setClearColor = noop;\r\n\t\trenderer.clear = noop;\r\n\t\trenderer.enableScissorTest = noop;\r\n\t\trenderer.setScissor = noop;\r\n\t\trenderer.setViewport = noop;\r\n\t\trenderer.getPixelRatio = noop;\r\n\t\trenderer.getMaxAnisotropy = noop;\r\n\t\trenderer.setFaceCulling = noop;\r\n\t\trenderer.context = {canvas: {}};\r\n\t\trenderer.shadowMap = {};\r\n\t}\r\n\r\n\t/*\r\n\t* Emulate A-Frame cursor events when running in AltspaceVR.\r\n\t*/\r\n\tinitCursorEvents()\r\n\t{\r\n\r\n\t\tlet scene = this.el.object3D;\r\n\t\tlet cursorEl = document.querySelector('a-cursor') || document.querySelector('a-entity[cursor]');\r\n\t\tif (cursorEl) {\r\n\t\t\t// Hide A-Frame cursor mesh.\r\n\t\t\tcursorEl.setAttribute('material', 'transparent', true);\r\n\t\t\tcursorEl.setAttribute('material', 'opacity', 0.0);\r\n\t\t}\r\n\r\n\t\tfunction emit(eventName, event)\r\n\t\t{\r\n\t\t\t// Fire events on intersected object and A-Frame cursor.\r\n\t\t\tlet targetEl = event.target.el;\r\n\t\t\tif (cursorEl){\r\n\t\t\t\tcursorEl.emit(eventName, { target: targetEl, ray: event.ray, point: event.point });\r\n\t\t\t}\r\n\r\n\t\t\tif (targetEl){\r\n\t\t\t\ttargetEl.emit(eventName, { target: targetEl, ray: event.ray, point: event.point });\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet cursordownObj = null;\r\n\t\tscene.addEventListener('cursordown', event => {\r\n\t\t\tcursordownObj = event.target;\r\n\t\t\temit('mousedown', event);\r\n\t\t});\r\n\r\n\t\tscene.addEventListener('cursorup', event => {\r\n\t\t\temit('mouseup', event);\r\n\t\t\tif (event.target.uuid === cursordownObj.uuid) {\r\n\t\t\t\temit('click', event);\r\n\t\t\t}\r\n\t\t\tcursordownObj = null;\r\n\t\t});\r\n\r\n\t\tscene.addEventListener('cursorenter', event => {\r\n\t\t\tif (!event.target.el){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tevent.target.el.addState('hovered');\r\n\t\t\tif (cursorEl){\r\n\t\t\t\tcursorEl.addState('hovering');\r\n\t\t\t}\r\n\t\t\temit('mouseenter', event);\r\n\t\t});\r\n\r\n\t\tscene.addEventListener('cursorleave', event => {\r\n\t\t\tif (!event.target.el){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tevent.target.el.removeState('hovered');\r\n\t\t\tif (cursorEl){\r\n\t\t\t\tcursorEl.removeState('hovering');\r\n\t\t\t}\r\n\t\t\temit('mouseleave', event);\r\n\t\t});\r\n    }\r\n\r\n\tinitCollisionEvents()\r\n\t{\r\n\t\tlet scene = this.el.object3D;\r\n\r\n\t\tfunction emit(eventName, event)\r\n\t\t{\r\n\t\t\tlet targetEl = event.target.el;\r\n\t\t\tif (!targetEl)\r\n\t\t\t\treturn;\r\n\r\n\t\t\t//remap target and other from object3Ds to aframe element\r\n\t\t\tevent.target = targetEl;\r\n\t\t\tif (event.other && event.other.el) {\r\n\t\t\t\tevent.other = event.other.el;\r\n\t\t\t}\r\n\t\t\ttargetEl.emit(eventName, event);\r\n\t\t};\r\n\r\n\t\tscene.addEventListener('collisionenter', event => {\r\n\t\t\temit('collisionenter', event);\r\n\t\t});\r\n\r\n\t\tscene.addEventListener('collisionexit', event => {\r\n\t\t\temit('collisionexit', event);\r\n\t\t});\r\n\r\n\t\tscene.addEventListener('triggerenter', event => {\r\n\t\t\temit('triggerenter', event);\r\n\t\t});\r\n\r\n\t\tscene.addEventListener('triggerexit', event => {\r\n\t\t\temit('triggerexit', event);\r\n\t\t});\r\n\r\n    }\r\n}\r\n","/**\r\n* Sync the color property of the object between clients.\r\n* Requires both a {@link sync.sync-system} component on the `a-scene`, and a\r\n* {@link sync.sync} component on the target entity.\r\n* @mixin sync-color\r\n* @memberof sync\r\n*/\r\n'use strict';\r\n\r\nimport {AFrameComponent} from './AFrameComponent';\r\n\r\nexport default class SyncColor extends AFrameComponent\r\n{\r\n\tget dependencies(){\r\n\t\treturn ['sync'];\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tthis.sync = this.el.components.sync;\r\n\r\n\t\t// wait for firebase connection to start sync routine\r\n\t\tif(this.sync.isConnected)\r\n\t\t\tstart();\r\n\t\telse\r\n\t\t\tthis.el.addEventListener('connected', this.start.bind(this));\r\n\t}\r\n\r\n\tstart()\r\n\t{\r\n\t\tlet colorRef = this.sync.dataRef.child('material/color');\r\n\t\tlet refChangedLocked = false;\r\n\t\tlet firstValue = true;\r\n\r\n\t\tcomponent.el.addEventListener('componentchanged', event =>\r\n\t\t{\r\n\t\t\tlet name = event.detail.name;\r\n\t\t\tlet oldData = event.detail.oldData;\r\n\t\t\tlet newData = event.detail.newData;\r\n\r\n\t\t\tif (name === 'material' && !refChangedLocked && oldData.color !== newData.color && sync.isMine)\r\n\t\t\t{\r\n\t\t\t\t//For some reason A-Frame has a misconfigured material reference if we do this too early\r\n\t\t\t\tsetTimeout(() => colorRef.set(newData.color), 0);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tcolorRef.on('value', snapshot => {\r\n\t\t\tif(!sync.isMine || firstValue)\r\n\t\t\t{\r\n\t\t\t\tlet color = snapshot.val();\r\n\r\n\t\t\t\trefChangedLocked = true;\r\n\t\t\t\tcomponent.el.setAttribute('material', 'color', color);\r\n\t\t\t\trefChangedLocked = false;\r\n\r\n\t\t\t\tfirstValue = false;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n","/**\r\n* Enables the synchronization of properties of entities. All property sync components\r\n* require both a {@link sync.sync-system} on `a-scene`, and a {@link sync.sync}\r\n* on the entity to be synced.\r\n* @name sync\r\n* @namespace sync\r\n* @example\r\n* <a-scene sync-system='app: example sync; author: altspacevr'>\r\n*   <a-entity sync='ownOn: cursordown' sync-color></a-entity>\r\n* </a-scene>\r\n*/\r\n\r\n/**\r\n* Enables the synchronization of properties of the entity. Must be used in\r\n* conjuction with the {@link sync.sync-system} component and a component for a\r\n* specific property (e.g. {@link sync.sync-transform}).\r\n* @memberof sync\r\n* @mixin sync\r\n* @prop {string} ownOn - The name of the event, or a list of events, that\r\n* will cause the local client to take ownership of this object. This field\r\n* cannot be updated after initialization.\r\n*/\r\n\r\nimport {AFrameComponent} from './AFrameComponent';\r\n\r\nexport default class SyncComponent extends AFrameComponent\r\n{\r\n\tconstructor(isComponent = false)\r\n\t{\r\n\t\tthis._isComponent = isComponent;\r\n\r\n\t\tthis.scene = undefined;\r\n\t\tthis.syncSys = undefined;\r\n\t\tthis.ref = undefined;\r\n\t\tthis.key = undefined;\r\n\t\tthis.dataRef = undefined;\r\n\t\tthis.ownerRef = undefined;\r\n\t\tthis.ownerId = undefined;\r\n\r\n\t\tthis.isConnected = false;\r\n\r\n\t\t/**\r\n\t\t* Indicates whether the sync ownership is yours.\r\n\t\t* @member sync.sync#isMine\r\n\t\t* @readonly\r\n\t\t*/\r\n\t\tthis.isMine = false;\r\n\t}\r\n\r\n\tget schema(){\r\n\t\treturn {\r\n\t\t\tmode: { default: 'link' },\r\n\t\t\townOn: { type: 'string' } //cannot be changed after creation\r\n\t\t};\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tthis.scene = this.el.sceneEl;\r\n\t\tthis.syncSys = this.scene.systems['sync-system'];\r\n\r\n\t\tif(this.syncSys.isConnected)\r\n\t\t\tstart();\r\n\t\telse\r\n\t\t\tthis.scene.addEventListener('connected', this.start.bind(this));\r\n\r\n\t\tif(this.data.ownOn)\r\n\t\t{\r\n\t\t\tlet ownershipEvents = this.data.ownOn.split(/[ ,]+/);\r\n\t\t\townershipEvents.forEach((e => {\r\n\t\t\t\tthis.el.addEventListener(e, (() => {\r\n\t\t\t\t\tif(this.isConnected){\r\n\t\t\t\t\t\tthis.takeOwnership();\r\n\t\t\t\t\t}\r\n\t\t\t\t}).bind(this));\r\n\t\t\t}).bind(this));\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t* Tell sync to start pushing local property values instead of updating\r\n\t* local from remote values.\r\n\t* @method sync.sync#takeOwnership\r\n\t*/\r\n\ttakeOwnership()\r\n\t{\r\n\t\tthis.ownerRef.set(this.syncSys.clientId);\r\n\r\n\t\t//clear our ownership if we disconnect\r\n\t\t//this is needed if we are the last user in the room, but we expect people to join later\r\n\t\tthis.ownerRef.onDisconnect().set(null);\r\n\t}\r\n\r\n\tstart()\r\n\t{\r\n\t\t//Make sure someone always owns an object. If the owner leaves and we are the master client, we will take it.\r\n\t\t//This ensures, for example, that synced animations keep playing\r\n\t\tthis.scene.addEventListener('clientleft', (event => {\r\n\t\t\tlet shouldTakeOwnership = (!ownerId || ownerId === event.detail.id) && this.syncSys.isMasterClient;\r\n\t\t\tif(shouldTakeOwnership)\r\n\t\t\t\tthis.takeOwnership();\r\n\t\t}).bind(this));\r\n\r\n\t\tif (this.data.mode === 'link') {\r\n\t\t\tlet id = this.el.id;\r\n\t\t\tif (!id) {\r\n\t\t\t\tconsole.error('Entities cannot be synced using link mode without an id.');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconsole.log('syncSys: ' + this.syncSys);\r\n\t\t\tconsole.log('syncSys.sceneRef: ' + this.syncSys.sceneRef);\r\n\r\n\t\t\tthis.link(this.syncSys.sceneRef.child(id));\r\n\t\t\tthis.setupReceive();\r\n\r\n\t\t} else {\r\n\t\t\tconsole.error('Unsupported sync mode: ' + this.data.mode);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.isConnected = true;\r\n\t\tthis.el.emit('connected', null, false);\r\n\t}\r\n\r\n\tlink(entityRef)\r\n\t{\r\n\t\tthis.ref = entityRef;\r\n\t\tthis.key = this.ref.key();\r\n\t\tthis.dataRef = this.ref.child('data');\r\n\t\tthis.ownerRef = this.ref.child('owner');\r\n\t}\r\n\r\n\tsetupReceive()\r\n\t{\r\n\t\t//if nobody has owned the object yet, we will.\r\n\t\tthis.ownerRef.transaction((owner => {\r\n\t\t\tif (owner) return undefined;\r\n\t\t\tthis.ownerRef.onDisconnect().set(null);\r\n\t\t\treturn this.syncSys.clientId;\r\n\t\t}).bind(this));\r\n\r\n\t\tthis.ownerRef.on('value', (snapshot =>\r\n\t\t{\r\n\t\t\tlet newOwnerId = snapshot.val();\r\n\t\t\tlet gained = newOwnerId === this.syncSys.clientId && !this.isMine;\r\n\t\t\tif (gained)\r\n\t\t\t\tthis.el.emit('ownershipgained', null, false);\r\n\r\n\t\t\t//note this also fires when we start up without ownership\r\n\t\t\tlet lost = newOwnerId !== this.syncSys.clientId && this.isMine;\r\n\t\t\tif (lost){\r\n\t\t\t\tthis.el.emit('ownershiplost', null, false);\r\n\r\n\t\t\t\t//we no longer have to clear our ownership when we disconnect\r\n\t\t\t\tthis.ownerRef.onDisconnect().cancel();\r\n\t\t\t}\r\n\r\n\t\t\tthis.ownerId = newOwnerId;\r\n\r\n\t\t\tthis.isMine = newOwnerId === this.syncSys.clientId;\r\n\t\t}).bind(this));\r\n\t}\r\n}\r\n","'use strict';\r\n\r\nimport {AFrameSystem} from './AFrameComponent';\r\n\r\n/**\r\n* Connect to a remote Firebase server, and facilitate synchronization. These\r\n* options correspond exactly with the configuration options for\r\n* [altspace.utilities.sync.connect]{@link http://altspacevr.github.io/AltspaceSDK/doc/module-altspace_utilities_sync.html#.connect}.\r\n* This component must be present on `a-scene` for any other sync components to work.\r\n* @extends AFrameSystem\r\n* @memberof module:altspace/components\r\n*/\r\nclass SyncSystem extends AFrameSystem\r\n{\r\n\t/**\r\n\t* @prop {string} author - A unique identifier for you or your organization.\r\n\t* @prop {string} app - The name of the app.\r\n\t* @prop {string} refUrl - Override the base reference. Set this to use your own Firebase.\r\n\t* @prop {string} instance - Override the instance ID. Can also be overridden with\r\n\t* a URL parameter.\r\n\t*/\r\n\tget schema(){\r\n\t\treturn {\r\n\t\t\tauthor: { type: 'string', default: null },\r\n\t\t\tapp: { type: 'string', default: null },\r\n\t\t\tinstance: { type: 'string', default: null },\r\n\t\t\trefUrl: { type: 'string', default: null }\r\n\t\t};\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tif(!this.data || !this.data.app){\r\n\t\t\tconsole.warn('The sync-system must be present on the scene and configured with required data.');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconsole.log(this.data);\r\n\r\n\t\tthis.isConnected = false;\r\n\t\taltspace.utilities.sync.connect({\r\n\t\t\tauthorId: this.data.author,\r\n\t\t\tappId: this.data.app,\r\n\t\t\tinstanceId: this.data.instance,\r\n\t\t\tbaseRefUrl: this.data.refUrl\r\n\t\t}).then(this.connected.bind(this));\r\n\t}\r\n\r\n\tconnected(connection)\r\n\t{\r\n\t\tthis.connection = connection;\r\n\r\n\t\tthis.sceneRef = this.connection.instance.child('scene');\r\n\t\tthis.clientsRef = this.connection.instance.child('clients');\r\n\r\n\t\t// temporary way of having unique identifiers for each client\r\n\t\tthis.clientId = this.sceneEl.object3D.uuid;\r\n\t\tthis.masterClientId = null;\r\n\r\n\t\tlet self = this;\r\n\r\n\t\t// local client connected\r\n\t\tthis.clientsRef.on(\"value\", snapshot => {\r\n\t\t\tlet clientIds = snapshot.val();\r\n\t\t\tlet masterClientKey = Object.keys(clientIds)[0];\r\n\t\t\tself.masterClientId = clientIds[masterClientKey];\r\n\t\t});\r\n\r\n\t\t// remote client connected\r\n\t\tthis.clientsRef.on('child_added', childSnapshot => {\r\n\t\t\tlet joinedClientId = childSnapshot.val();\r\n\t\t\t//let the master client flag get set first\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tself.sceneEl.emit('clientjoined', {id: joinedClientId}, false);\r\n\t\t\t}, 0);\r\n\t\t});\r\n\r\n\t\t// remote client disconnected\r\n\t\tthis.clientsRef.on('child_removed', childSnapshot => {\r\n\t\t\tlet leftClientId = childSnapshot.val();\r\n\t\t\t//let the master client flag get set first\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tself.sceneEl.emit('clientleft', {id: leftClientId}, false);\r\n\t\t\t}, 0);\r\n\t\t});\r\n\r\n\t\t// add our client ID to the list of connected clients,\r\n\t\t// but have it be automatically removed by firebase if we disconnect for any reason\r\n\t\tthis.clientsRef.push(this.clientId).onDisconnect().remove();\r\n\r\n\t\tthis.connection.instance.child('initialized').once('value', snapshot => {\r\n\t\t\tlet shouldInitialize = !snapshot.val();\r\n\t\t\tsnapshot.ref().set(true);\r\n\r\n\t\t\tself.sceneEl.emit('connected', { shouldInitialize: shouldInitialize }, false);\r\n\t\t\tself.isConnected = true;\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t* Returns true if the local client is the master client.\r\n\t*/\r\n\tisMasterClient()\r\n\t{\r\n\t\treturn this.masterClientId === this.clientId;\r\n\t}\r\n}\r\n\r\nexport default SyncSystem;\r\n","//TODO: We need to figure out a way to recieve our first update without caring about ownership.\r\n// firstValue is probably not the right way to go, probably something about having sent yet. Need to change for both\r\n\r\n/**\r\n* Synchronize the position, rotation, and scale of this object with all clients.\r\n* Requires both a {@link sync.sync-system} component on the `a-scene`, and a\r\n* {@link sync.sync} component on the target entity.\r\n* @mixin sync-transform\r\n* @memberof sync\r\n*/\r\nAFRAME.registerComponent('sync-transform',\r\n{\r\n\tdependencies: ['sync'],\r\n\tschema: {\r\n\t},\r\n\tinit: function () {\r\n\t\tvar component = this;\r\n\t\tvar sync = component.el.components.sync;\r\n\t\tif(sync.isConnected) start(); else component.el.addEventListener('connected', start);\r\n\r\n\t\tfunction start(){\r\n\r\n\t\t\tvar positionRef = sync.dataRef.child('position');\r\n\t\t\tvar rotationRef = sync.dataRef.child('rotation');\r\n\t\t\tvar scaleRef = sync.dataRef.child('scale');\r\n\r\n\t\t\tcomponent.updateRate = 100;\r\n\r\n\t\t\tvar stoppedAnimations = [];\r\n\t\t\t//pause all animations on ownership loss\r\n\t\t\tcomponent.el.addEventListener('ownershiplost', function() {\r\n\t\t\t\tvar children = component.el.children;\r\n\t\t\t\tfor (var i = 0; i < children.length; i++) {\r\n\t\t\t\t\tvar tagName = children[i].tagName.toLowerCase();\r\n\t\t\t\t\tif (tagName === \"a-animation\") {\r\n\t\t\t\t\t\tstoppedAnimations.push(children[i]);\r\n\t\t\t\t\t\tchildren[i].stop();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tcomponent.el.addEventListener('ownershipgained', function () {\r\n\t\t\t\tfor (var i = 0; i < stoppedAnimations.length; i++) {\r\n\t\t\t\t\tvar animation = stoppedAnimations[i];\r\n\t\t\t\t\tanimation.start();\r\n\t\t\t\t}\r\n\t\t\t\tstoppedAnimations = [];\r\n\t\t\t});\r\n\r\n\t\t\tfunction onTransform(snapshot, componentName) {\r\n\t\t\t\tif (sync.isMine) return;\r\n\r\n\t\t\t\tvar value = snapshot.val();\r\n\t\t\t\tif (!value) return;\r\n\r\n\t\t\t\tcomponent.el.setAttribute(componentName, value);\r\n\t\t\t}\r\n\r\n\t\t\tpositionRef.on('value', function (snapshot) {\r\n\t\t\t\tonTransform(snapshot, 'position');\r\n\t\t\t});\r\n\r\n\t\t\trotationRef.on('value', function (snapshot) {\r\n\t\t\t\tonTransform(snapshot, 'rotation');\r\n\t\t\t});\r\n\r\n\t\t\tscaleRef.on('value', function (snapshot) {\r\n\t\t\t\tonTransform(snapshot, 'scale');\r\n\t\t\t});\r\n\r\n\t\t\tvar sendPosition = throttle(function(value){\r\n\t\t\t\tpositionRef.set(value);\r\n\t\t\t}, component.updateRate);\r\n\r\n\t\t\tvar sendRotation = throttle(function(value){\r\n\t\t\t\trotationRef.set(value);\r\n\t\t\t}, component.updateRate);\r\n\r\n\t\t\tvar sendScale = throttle(function(value){\r\n\t\t\t\tscaleRef.set(value);\r\n\t\t\t}, component.updateRate);\r\n\r\n\t\t\tfunction onComponentChanged(event){\r\n\t\t\t\tif (!sync.isMine) return;\r\n\r\n\t\t\t\tvar name = event.detail.name;\r\n\t\t\t\tvar newData = event.detail.newData;\r\n\r\n\t\t\t\tif (name === 'position') {\r\n\t\t\t\t\tsendPosition(newData);\r\n\t\t\t\t} else if (name === 'rotation') {\r\n\t\t\t\t\tsendRotation(newData);\r\n\t\t\t\t} else if (name === 'scale') {\r\n\t\t\t\t\tsendScale(newData);\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//from underscore.js\r\n\t\t\tfunction throttle(func, wait, options) {\r\n\t\t\t\tvar timeout, context, args, result;\r\n\t\t\t\tvar previous = 0;\r\n\t\t\t\tif (!options) options = {};\r\n\r\n\t\t\t\tvar later = function() {\r\n\t\t\t\t  previous = options.leading === false ? 0 : Date.now();\r\n\t\t\t\t  timeout = null;\r\n\t\t\t\t  result = func.apply(context, args);\r\n\t\t\t\t  if (!timeout) context = args = null;\r\n\t\t\t\t};\r\n\r\n\t\t\t\tvar throttled = function() {\r\n\t\t\t\t  var now = Date.now();\r\n\t\t\t\t  if (!previous && options.leading === false) previous = now;\r\n\t\t\t\t  var remaining = wait - (now - previous);\r\n\t\t\t\t  context = this;\r\n\t\t\t\t  args = arguments;\r\n\t\t\t\t  if (remaining <= 0 || remaining > wait) {\r\n\t\t\t\t\tif (timeout) {\r\n\t\t\t\t\t  clearTimeout(timeout);\r\n\t\t\t\t\t  timeout = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tprevious = now;\r\n\t\t\t\t\tresult = func.apply(context, args);\r\n\t\t\t\t\tif (!timeout) context = args = null;\r\n\t\t\t\t  } else if (!timeout && options.trailing !== false) {\r\n\t\t\t\t\ttimeout = setTimeout(later, remaining);\r\n\t\t\t\t  }\r\n\t\t\t\t  return result;\r\n\t\t\t\t};\r\n\r\n\t\t\t\tthrottled.cancel = function() {\r\n\t\t\t\t  clearTimeout(timeout);\r\n\t\t\t\t  previous = 0;\r\n\t\t\t\t  timeout = context = args = null;\r\n\t\t\t\t};\r\n\r\n\t\t\t\treturn throttled;\r\n\t\t\t  };\r\n\r\n\r\n\t\t\tcomponent.el.addEventListener('componentchanged', onComponentChanged);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nexport default null;\r\n","/**\r\n* Synchronize the playback state of an {@link n.n-sound} component between clients.\r\n* Requires both a {@link sync.sync-system} component on the `a-scene`, and a\r\n* {@link sync.sync} component on the target entity.\r\n* @mixin sync-n-sound\r\n* @memberof sync\r\n*/\r\n'use strict';\r\n\r\nimport {AFrameComponent} from './AFrameComponent';\r\n\r\nexport default class SyncNSound extends AFrameComponent\r\n{\r\n\tget dependencies(){\r\n\t\treturn ['sync'];\r\n\t}\r\n}\r\n\r\nAFRAME.registerComponent('sync-n-sound',\r\n{\r\n\tdependencies: ['sync'],\r\n\tschema: { },\r\n\tinit: function () {\r\n\t\tvar component = this;\r\n\t\tvar sync = component.el.components.sync;\r\n\t\tvar scene = document.querySelector('a-scene');\r\n\t\tvar syncSys = scene.systems['sync-system'];\r\n\t\tif(sync.isConnected) start(); else component.el.addEventListener('connected', start);\r\n\r\n\t\tfunction start(){\r\n\t\t\tcomponent.soundStateRef = sync.dataRef.child('sound/state');\r\n\t\t\tcomponent.soundEventRef = sync.dataRef.child('sound/event');\r\n\r\n\t\t\tfunction sendEvent(event) {\r\n\t\t\t\tif (!sync.isMine) return;\r\n\t\t\t\tvar event = {\r\n\t\t\t\t\ttype: event.type,\r\n\t\t\t\t\tsender: syncSys.clientId,\r\n\t\t\t\t\tel: component.el.id,\r\n\t\t\t\t\ttime: Date.now()\r\n\t\t\t\t};\r\n\t\t\t\tcomponent.soundEventRef.set(event);\r\n\t\t\t}\r\n\r\n\t\t\tcomponent.el.addEventListener('sound-played', sendEvent);\r\n\t\t\tcomponent.el.addEventListener('sound-paused', sendEvent);\r\n\r\n\t\t\tcomponent.soundEventRef.on('value', function (snapshot) {\r\n\t\t\t\tif (sync.isMine) return;\r\n\t\t\t\tvar event = snapshot.val();\r\n\t\t\t\tif (!event) return;\r\n\t\t\t\tif (event.el === component.el.id) {\r\n\t\t\t\t\tvar sound = component.el.components['n-sound'];\r\n\t\t\t\t\tif (event.type === 'sound-played') {\r\n\t\t\t\t\t\tsound.playSound();\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tsound.pauseSound();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tcomponent.el.addEventListener('componentchanged', function (event) {\r\n\t\t\t\tif (!sync.isMine) return;\r\n\t\t\t\tvar name = event.detail.name;\r\n\t\t\t\tif (name !== 'n-sound') return;\r\n\t\t\t\tcomponent.soundStateRef.set(event.detail.newData);\r\n\t\t\t});\r\n\r\n\t\t\tcomponent.soundStateRef.on('value', function (snapshot) {\r\n\t\t\t\tif (sync.isMine) return;\r\n\t\t\t\tvar state = snapshot.val();\r\n\t\t\t\tif (!state) return;\r\n\t\t\t\tcomponent.el.setAttribute('n-sound', state);\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\tremove: function () {\r\n\t\tthis.soundStateRef.off('value');\r\n\t\tthis.soundEventRef.off('value');\r\n\t}\r\n});\r\n","\r\n/**\r\n* This set of components map to various objects and effects that are provided\r\n* natively by AltspaceVR. Your management of these objects may be limited to\r\n* some degree, but they will tend to be more performant than SDK equivalents,\r\n* or may provide some functionality not otherwise available to the SDK.\r\n* @namespace native\r\n*/\r\n(function () {\r\n\tif (!window.altspace || !altspace.inClient) {\r\n\t\tvar noop = function () {};\r\n\t\twindow.altspace = {\r\n\t\t\taddNativeComponent: noop,\r\n\t\t\tupdateNativeComponent: noop,\r\n\t\t\tremoveNativeComponent: noop\r\n\t\t};\r\n\t}\r\n\r\n\tvar placeholderGeometry = new THREE.BoxGeometry(0.001, 0.001, 0.001);\r\n\tvar placeholderMaterial = new THREE.MeshBasicMaterial({ color: 0x000000 });\r\n\tplaceholderMaterial.visible = false;\r\n\tvar PlaceholderMesh = function () {\r\n\t\tTHREE.Mesh.call( this, placeholderGeometry, placeholderMaterial );\r\n\t};\r\n\tPlaceholderMesh.prototype = Object.create( THREE.Mesh.prototype );\r\n\tPlaceholderMesh.prototype.constructor = THREE.PlaceholderMesh;\r\n\r\n\tfunction meshInit(mesh) {\r\n\t\t//If you attach native components to an entity, it will not use a default collider\r\n\t\tmesh.userData.altspace = mesh.userData.altspace || {};\r\n\t\tmesh.userData.altspace.collider = mesh.userData.altspace.collider || {};\r\n\t\tmesh.userData.altspace.collider.enabled = false;\r\n\r\n\t\taltspace.addNativeComponent(mesh, this.name);\r\n\t}\r\n\r\n\tfunction nativeComponentInit() {\r\n\t\tvar mesh = this.el.getOrCreateObject3D('mesh', PlaceholderMesh);\r\n\r\n\t\tmeshInit.call(this, mesh);\r\n\r\n\t\t//to pass defaults\r\n\t\tthis.update(this.data);\r\n\t}\r\n\tfunction nativeComponentRemove() {\r\n\t\tvar mesh = this.el.getObject3D('mesh');\r\n\t\taltspace.removeNativeComponent(mesh, this.name);\r\n\t}\r\n\tfunction nativeComponentUpdate(oldData) {\r\n\t\taltspace.updateNativeComponent(this.el.object3DMap.mesh, this.name, this.data);\r\n\t}\r\n\r\n\tfunction callComponent(functionName, functionArguments) {\r\n\t\taltspace.callNativeComponent(this.el.object3DMap.mesh, this.name, functionName, functionArguments)\r\n\t}\r\n\r\n\t/**\r\n\t* Attach a given native object to this entity.\r\n\t* @mixin n-object\r\n\t* @memberof native\r\n\t* @prop {string} res - The identifier for the resource you want. This component\r\n\t* can accept all resources except for `interactables`.\r\n\t* @example <a-entity n-object='res:architecture/wall-4w-4h'></a-entity>\r\n\t*/\r\n\tAFRAME.registerComponent('n-object', {\r\n\t\tschema: {\r\n\t\t\tres: {type: 'string'}\r\n\t\t},\r\n\t\tinit: nativeComponentInit,\r\n\t\tupdate: nativeComponentUpdate,\r\n\t\tremove: nativeComponentRemove\r\n\t});\r\n\r\n\t/**\r\n\t* Create an object that spawns additional copies of itself when grabbed by a user (the copies are not spawners themselves).\r\n\t* These copies will be physically interactive and automatically synchronized\r\n\t* between users.\r\n\t* @mixin n-spawner\r\n\t* @memberof native\r\n\t* @prop {string} res - The identifier for the resource you want. This component\r\n\t* can only accept resources of type `interactables`.\r\n\t* @example <a-entity n-spawner='res: interactables/basketball'></a-entity>\r\n\t*/\r\n\tAFRAME.registerComponent('n-spawner', {\r\n\t\tschema: {\r\n\t\t\tres: {type: 'string'}\r\n\t\t},\r\n\t\tinit: nativeComponentInit,\r\n\t\tupdate: nativeComponentUpdate,\r\n\t\tremove: nativeComponentRemove\r\n\t});\r\n\r\n\t/**\r\n\t* Creates dynamic 2D text on the entity. The text will wrap automatically based on the width and height provided.\r\n\t* This text will be clearer than texture-based text and more performant than geometry-based test.\r\n\t* @mixin n-text\r\n\t* @memberof native\r\n\t* @prop {string} text - The text to be drawn.\r\n\t* @prop {number} fontSize=10 - The height of the letters. 10pt ~= 1m\r\n\t* @prop {number} width=10 - The width of the text area in meters. If the\r\n\t* text is wider than this value, the overflow will be wrapped to the next line.\r\n\t* @prop {number} height=1 - The height of the text area in meters. If the\r\n\t* text is taller than this value, the overflow will be cut off.\r\n\t* @prop {string} horizontalAlign=middle - The horizontal anchor point for\r\n\t* the text. Can be `left`, `middle`, or `right`.\r\n\t* @prop {string} verticalAlign=middle - The vertical anchor point for the\r\n\t* text. Can be `top`, `middle`, or `bottom`.\r\n\t*/\r\n\tAFRAME.registerComponent('n-text', {\r\n\t\tinit: nativeComponentInit,\r\n\t\tupdate: nativeComponentUpdate,\r\n\t\tremove: nativeComponentRemove,\r\n\t\tschema: {\r\n\t\t\ttext: { default: '', type: 'string' },\r\n\t\t\t/*color: { default: 'white',\r\n\t\t\t\tparse: function(value) {\r\n\t\t\t\t\treturn parseFloat(value, 10);\r\n\t\t\t\t},\r\n\t\t\t\tstringify: function(value) {\r\n\t\t\t\t\treturn value.toString();\r\n\t\t\t\t}},*/\r\n\t\t\tfontSize: { default: '10', type: 'int' },//roughly a meter tall\r\n\t\t\twidth: { default: '10', type: 'number' },//in meters\r\n\t\t\theight: { default: '1', type: 'number' },//in meters\r\n\t\t\thorizontalAlign: { default: 'middle'},\r\n\t\t\tverticalAlign: { default: 'middle'}\r\n\t\t}\r\n\t});\r\n\r\n\t//object: collides against: objects / enviroment / cursor\r\n\t//environment: can be teleported onto, and collides against: objects / environment / cursor\r\n\t//hologram: collides against: cursor / holograms\r\n\r\n\t/**\r\n\t* Abstract base class for {@link n.n-sphere-collider}, {@link n.n-box-collider},\r\n\t* {@link n.n-capsule-collider}, and {@link n.n-mesh-collider}. You cannot use\r\n\t* this class directly, but instead you should add one of those components\r\n\t* to your objects.\r\n\t* @name n-collider\r\n\t* @mixin n-collider\r\n\t* @memberof native\r\n\t* @prop {vec3} center=0,0,0 - The offset of the collider in local space.\r\n\t* @prop {string} type=hologram - The type of collider, one of: `object` | `environment` | `hologram`.\r\n\t* Object colliders collide with other objects, the environment, and the cursor.\r\n\t* Environment colliders collide with everything objects do, but you can also\r\n\t* teleport onto them. Hologram colliders only collide with other holograms and\r\n\t* the cursor.\r\n\t*/\r\n\r\n\t/**\r\n\t* Create a spherical collider on this entity.\r\n\t* @mixin n-sphere-collider\r\n\t* @memberof native\r\n\t* @extends native.n-collider\r\n\t* @prop {number} radius=1 - The size of the collider in meters.\r\n\t*/\r\n\tAFRAME.registerComponent('n-sphere-collider', {\r\n\t\tinit:nativeComponentInit,\r\n\t\tremove: nativeComponentRemove,\r\n\t\tupdate: nativeComponentUpdate,\r\n\t\tschema: {\r\n\t\t\tisTrigger: { default: false, type: 'boolean' },\r\n\t\t\tcenter: { type: 'vec3' },\r\n\t\t\tradius: { default: '0', type: 'number' },\r\n\t\t\ttype: {default: 'object'}\r\n\t\t}\r\n\t});\r\n\r\n\r\n\t/**\r\n\t* Create a box-shaped collider on this entity.\r\n\t* @mixin n-box-collider\r\n\t* @memberof native\r\n\t* @extends native.n-collider\r\n\t* @prop {vec3} size=1,1,1 - The dimensions of the collider.\r\n\t*/\r\n\tAFRAME.registerComponent('n-box-collider', {\r\n\t\tinit:nativeComponentInit,\r\n\t\tremove: nativeComponentRemove,\r\n\t\tupdate: nativeComponentUpdate,\r\n\t\tschema: {\r\n\t\t\tisTrigger: { default: false, type: 'boolean' },\r\n\t\t\tcenter: { type: 'vec3' },\r\n\t\t\tsize: { type: 'vec3' },\r\n\t\t\ttype: {default: 'object'}\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t* Create a capsule-shaped collider on this entity. Capsules\r\n\t* are a union of a cylinder and two spheres on top and bottom.\r\n\t* @mixin n-capsule-collider\r\n\t* @memberof native\r\n\t* @extends native.n-collider\r\n\t* @prop {number} radius=1 - The radius of the capsule in meters.\r\n\t* @prop {number} height=1 - The height of the shaft of the capsule in meters.\r\n\t* @prop {string} direction=y - The axis with which the capsule is aligned.\r\n\t* One of `x`, `y`, or `z`.\r\n\t*/\r\n\tAFRAME.registerComponent('n-capsule-collider', {\r\n\t\tinit:nativeComponentInit,\r\n\t\tremove: nativeComponentRemove,\r\n\t\tupdate: nativeComponentUpdate,\r\n\t\tschema: {\r\n\t\t\tisTrigger: { default: false, type: 'boolean' },\r\n\t\t\tcenter: { type: 'vec3' },\r\n\t\t\tradius: { default: '0', type: 'number' },\r\n\t\t\theight: { default: '0', type: 'number' },\r\n\t\t\tdirection: { default: 'y' },\r\n\t\t\ttype: {default: 'object'}\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t* Enable collision for the entire attached mesh. This is expensive to evaluate, so should only be used on\r\n\t* low-poly meshes.\r\n\t* @mixin n-mesh-collider\r\n\t* @memberof native\r\n\t* @extends native.n-collider\r\n\t* @example <a-box n-mesh-collider></a-box>\r\n\t* @prop {bool} convex=true - Whether the collider should be convex or concave. Set this to false if you have holes\r\n\t* in your mesh. Convex colliders are limited to 255 triangles. Note: concave colliders can be significantly more\r\n\t* expensive comparet to conves colliders.\r\n\t*/\r\n\tAFRAME.registerComponent('n-mesh-collider', {\r\n\t\t_forEachMesh: function (func) {\r\n\t\t\tvar obj = this.el.object3DMap.mesh;\r\n\t\t\tif (!obj) { return; }\r\n\t\t\tif (obj instanceof THREE.Mesh) {\r\n\t\t\t\tfunc(obj);\r\n\t\t\t}\r\n\t\t\tobj.traverse(function (childObj) {\r\n\t\t\t\tif (childObj instanceof THREE.Mesh) {\r\n\t\t\t\t\tfunc(childObj);\r\n\t\t\t\t}\r\n\t\t\t}.bind(this));\r\n\t\t},\r\n\t\t_initObj: function () {\r\n\t\t\tthis._forEachMesh(function (mesh) {\r\n\t\t\t\tmeshInit.call(this, mesh);\r\n\r\n\t\t\t\t//to pass defaults\r\n\t\t\t\taltspace.updateNativeComponent(mesh, this.name, this.data);\r\n\t\t\t}.bind(this));\r\n\t\t},\r\n\t\tinit: function () {\r\n\t\t\t// Allow a-frame to create a PlaceholderMesh if there isn't already one, so that the native collider is\r\n\t\t\t// registered.\r\n\t\t\tthis.el.getOrCreateObject3D('mesh', PlaceholderMesh);\r\n\r\n\t\t\t// Initialize the existing mesh\r\n\t\t\tthis._initObj();\r\n\r\n\t\t\tthis.el.addEventListener('model-loaded', function () {\r\n\t\t\t\t// Re-initialize the collider if a new model is loaded\r\n\t\t\t\tthis._initObj();\r\n\t\t\t}.bind(this));\r\n\t\t},\r\n\t\tremove: function () {\r\n\t\t\tthis._forEachMesh(function (mesh) {\r\n\t\t\t\taltspace.removeNativeComponent(mesh, this.name);\r\n\t\t\t}.bind(this));\r\n\t\t},\r\n\t\tupdate: function (oldData) {\r\n\t\t\tthis._forEachMesh(function (mesh) {\r\n\t\t\t\taltspace.updateNativeComponent(mesh, this.name, this.data);\r\n\t\t\t}.bind(this));\r\n\t\t},\r\n\t\tschema: {\r\n\t\t\tisTrigger: { default: false, type: 'boolean' },\r\n\t\t\tconvex: { default: true, type: 'boolean' },\r\n\t\t\ttype: {default: 'object'}\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t* Make the object's +Z always face the viewer. Currently will only directly apply to main mesh or native component on the attached entity, not any children or submeshes.\r\n\t* @mixin n-billboard\r\n\t* @memberof native\r\n\t* @example <a-plane n-billboard></a-plane>\r\n\t*/\r\n\tAFRAME.registerComponent('n-billboard', {\r\n\t\tinit:nativeComponentInit,\r\n\t\tremove: nativeComponentRemove,\r\n\t});\r\n\r\n\t/**\r\n\t* A container keeps a running tally of how many objects are within\r\n\t* its bounds, and adds and removes the states `container-full` and\r\n\t* `container-empty` based on the current count of objects. Can fire three\r\n\t* special events: `container-full`, `container-empty`, and `container-count-changed`.\r\n\t* @mixin n-container\r\n\t* @memberof native\r\n\t* @prop {number} capacity=4 - The value at which the container will fire the\r\n\t* `container-full` event.\r\n\t*/\r\n\tAFRAME.registerComponent('n-container', {\r\n\t\tinit: function(){\r\n\t\t\tnativeComponentInit.call(this);\r\n\r\n\t\t\tvar el = this.el;\r\n\t\t\tvar component = this;\r\n\r\n\t\t\tel.addEventListener('stateadded', function(event){\r\n\t\t\t\tif(event.detail.state === 'container-full'){\r\n\t\t\t\t\tel.emit('container-full');\r\n\t\t\t\t}\r\n\t\t\t\tif(event.detail.state === 'container-empty'){\r\n\t\t\t\t\tel.emit('container-empty');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tel.addEventListener('container-count-changed', function(event){\r\n\t\t\t\tcomponent.count = event.detail.count;\r\n\t\t\t});\r\n\t\t},\r\n\t\tremove: nativeComponentRemove,\r\n\t\tupdate: nativeComponentUpdate,\r\n\t\tschema: {\r\n\t\t\tcapacity: { default: 4, type: 'number' },\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t* Play the sound given by the `src` or `res` property from the location\r\n\t* of the entity.\r\n\t* @mixin n-sound\r\n\t* @memberof native\r\n\t* @prop {string} res - The resource identifier for a built-in sound clip.\r\n\t* @prop {string} src - A URL to an external sound clip. The sound can be in WAV, OGG or MP3 format. However. only\r\n\t* WAV is supported on all platforms. MP3 is supported on Gear VR and OGG is supported on desktop.\r\n\t* @prop {string} on - The name of the event that will play this sound clip.\r\n\t* @prop {boolean} loop=false - Tells the clip to loop back to the beginning of the clip\r\n\t* once it's finished.\r\n\t* @prop {boolean} autoplay=false - Tells the clip to start automatically when\r\n\t* the scene loads, instead of waiting for `playSound()`.\r\n\t* @prop {boolean} oneshot=false - Tells the clip to clean itself up when it\r\n\t* finishes playing. Allows for overlapping instances of the sound.\r\n\t* @prop {number} volume=1 - The volume of the clip, from [0,1].\r\n\t* @prop {number} spatialBlend=1 - How spatialized a sound is, from [0,1].\r\n\t* A value of 1 will be fully localized, and the sound will pan left and\r\n\t* right as you turn your head. A value of 0 makes it non-spatialized, and\r\n\t* it will always be heard in both ears.\r\n\t* @prop {number} pitch=1 - The speed multiplier for the sound. 0.5 is one\r\n\t* octave down, and 2 is one octave up.\r\n\t* @prop {number} minDistance=1 - Inside this distance in meters,\r\n\t* the sound volume is at full volume.\r\n\t* @prop {number} maxDistance=12 - If rolloff is 'logarithmic', the sound will stop attenuating at this distance.\r\n\t* If rolloff is 'linear' or 'cosine', the sound will be silent at this distance.\r\n\t* @prop {string} rolloff='logarithmic' - Set this to 'linear' or 'cosine' if you want to cut sounds off at a\r\n\t* maxDistance.\r\n\t*/\r\n\t/**\r\n\t* Fired when a sound has loaded and is ready to be played\r\n\t* @event native.n-sound#n-sound-loaded\r\n\t*/\r\n\tAFRAME.registerComponent('n-sound', {\r\n\t\tinit: function () {\r\n\t\t\tvar src = this.data.src;\r\n\t\t\tif (src && !src.startsWith('http')) {\r\n\t\t\t\tif (src.startsWith('/')) {\r\n\t\t\t\t\tthis.data.src = location.origin + src;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tvar currPath = location.pathname;\r\n\t\t\t\t\tif (!currPath.endsWith('/')) {\r\n\t\t\t\t\t\tcurrPath = location.pathname.split('/').slice(0, -1).join('/') + '/';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.data.src = location.origin + currPath + src;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tnativeComponentInit.call(this);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t* Stop the playing sound, and preserve position in clip.\r\n\t\t* @method native.n-sound#pauseSound\r\n\t\t*/\r\n\t\tpauseSound: function () {\r\n\t\t\tcallComponent.call(this, 'pause');\r\n\t\t\tthis.el.emit('sound-paused');\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t* Start the sound playing.\r\n\t\t* @method native.n-sound#playSound\r\n\t\t*/\r\n\t\tplaySound: function () {\r\n\t\t\tcallComponent.call(this, 'play');\r\n\t\t\tthis.el.emit('sound-played');\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t* Jump to a position in the clip.\r\n\t\t* @method native.n-sound#seek\r\n\t\t* @param {number} time - The time in milliseconds to jump to.\r\n\t\t*/\r\n\t\tseek: function (time) {\r\n\t\t\tcallComponent.call(this, 'seek', {time: time});\r\n\t\t},\r\n\t\tremove: function () {\r\n\t\t\tnativeComponentRemove.call(this);\r\n\t\t\tif (this.playHandler) {\r\n\t\t\t  this.el.removeEventListener(oldData.on, this.playHandler);\r\n\t\t\t}\r\n\t\t},\r\n\t\tupdate: function (oldData) {\r\n\t\t\tnativeComponentUpdate.call(this, oldData);\r\n\t\t\tif (this.playHandler) {\r\n\t\t\t  this.el.removeEventListener(oldData.on, this.playHandler);\r\n\t\t\t}\r\n\t\t\tif (this.data.on) {\r\n\t\t\t  this.playHandler = this.playSound.bind(this);\r\n\t\t\t  this.el.addEventListener(this.data.on, this.playHandler);\r\n\t\t\t}\r\n\t\t},\r\n\t\tschema: {\r\n\t\t\ton: { type: 'string' },\r\n\t\t\tres: { type: 'string' },\r\n\t\t\tsrc: { type: 'string' },\r\n\t\t\tloop: { type: 'boolean' },\r\n\t\t\tvolume: { type: 'number', default: 1 },\r\n\t\t\tautoplay: { type: 'boolean' },\r\n\t\t\toneshot: { type: 'boolean' },\r\n\t\t\tspatialBlend: { type: 'float', default: 1 },\r\n\t\t\tpitch: { type: 'float', default: 1 },\r\n\t\t\tminDistance: { type: 'float', default: 1 },\r\n\t\t\tmaxDistance: { type: 'float', default: 12 },\r\n\t\t\trolloff: { type: 'string', default: 'logarithmic' },\r\n\t\t}\r\n\t});\r\n\r\n})();\r\n\r\nexport default null;\r\n","/**\r\n * The wire component allows you to trigger an event on another entity when an event occurs on an entity\r\n * @mixin wire\r\n * @property {string} on Name of an event to listen to\r\n * @property {string} gained Name of a state to watch for\r\n * @property {string} lost Name of a state to watch for\r\n * @property {string} emit Name of an event to trigger on the targets\r\n * @property {string} gain Name of a state to add on the target\r\n * @property {string} lose Name of a state to remove on the target\r\n * @property {selector} targets A selector to pick which objects to wire to\r\n * @property {selector} target - A selector to pick a single object to wire to\r\n **/\r\nAFRAME.registerComponent('wire',\r\n{\r\n\tmultiple: true,\r\n\tschema: {\r\n\t\ton: {type: 'string'},\r\n\t\temit: {type: 'string'},\r\n\t\tgained: {type: 'string'},\r\n\t\tlost: {type: 'string'},\r\n\t\tgain: {type: 'string'},\r\n\t\tlose: {type: 'string'},\r\n\t\ttargets: {type: 'selectorAll'},\r\n\t\ttarget: {type: 'selector'}\r\n\t},\r\n\tupdate: function (oldData) {\r\n\t\tif (oldData.on) {\r\n\t\t\tthis.el.removeEventListener(oldData.on, this.actOnTargets);\r\n\t\t}\r\n\t\tif (oldData.gained) {\r\n\t\t\tthis.el.removeEventListener('stateadded', this.actOnTargetsIfStateMatches);\r\n\t\t}\r\n\t\tif (oldData.lost) {\r\n\t\t\tthis.el.removeEventListener('stateremoved', this.actOnTargetsIfStateMatches);\r\n\t\t}\r\n\r\n\t\tthis.actOnTargets = function () {\r\n\t\t\tfunction act(el) {\r\n\t\t\t\tif (this.data.emit) {\r\n\t\t\t\t\tel.emit(this.data.emit);\r\n\t\t\t\t}\r\n\t\t\t\tif (this.data.gain) {\r\n\t\t\t\t\tel.addState(this.data.gain);\r\n\t\t\t\t}\r\n\t\t\t\tif (this.data.lose) {\r\n\t\t\t\t\tel.removeState(this.data.lose);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(this.data.targets) this.data.targets.forEach(act.bind(this));\r\n\t\t\tif(this.data.target) act.call(this, this.data.target);\r\n\t\t}.bind(this);\r\n\r\n\t\tthis.actOnTargetsIfStateMatches = function (event) {\r\n\t\t\tvar state = event.detail.state;\r\n\t\t\tif (state === this.data.gained || state === this.data.lost) {\r\n\t\t\t\tthis.actOnTargets();\r\n\t\t\t}\r\n\t\t}.bind(this);\r\n\r\n\t\tif (this.data.on) {\r\n\t\t\tthis.el.addEventListener(this.data.on, this.actOnTargets);\r\n\t\t}\r\n\t\tif (this.data.gained) {\r\n\t\t\tthis.el.addEventListener('stateadded', this.actOnTargetsIfStateMatches);\r\n\t\t}\r\n\t\tif (this.data.lost) {\r\n\t\t\tthis.el.addEventListener('stateremoved', this.actOnTargetsIfStateMatches);\r\n\t\t}\r\n\t},\r\n\tremove: function () {\r\n\t\tthis.el.removeEventListener(this.data.on, this.actOnTargets);\r\n\t\tthis.el.removeEventListener('stateadded', this.actOnTargetsIfStateMatches);\r\n\t\tthis.el.removeEventListener('stateremoved', this.actOnTargetsIfStateMatches);\r\n\t}\r\n});\r\n\r\nexport default null;\r\n","/**\r\n* @module altspace/components\r\n*/\r\n\r\n'use strict';\r\n\r\nimport {registerComponentClass, registerSystemClass, flatten} from './AFrameComponent';\r\nimport AltspaceCursorCollider from './AltspaceCursorCollider';\r\nimport AltspaceTrackedControls from './AltspaceTrackedControls';\r\nimport AltspaceComponent from './AltspaceComponent';\r\nimport SyncColor from './SyncColor';\r\nimport SyncComponent from './SyncComponent';\r\nimport SyncSystem from './SyncSystem';\r\nimport SyncTransform from './sync-transform';\r\nimport SyncNSound from './sync-n-sound';\r\nimport NativeComponents from './native-components';\r\nimport Wire from './wire';\r\n\r\n// TODO: finish porting aframe components to es6\r\nif (window.AFRAME)\r\n{\r\n    /**\r\n    * @mixin sync-system\r\n    * @memberof module:altspace/components\r\n    * @see {@link module:altspace/components.SyncSystem}\r\n    */\r\n    registerSystemClass('sync-system', SyncSystem);\r\n\r\n    registerComponentClass('altspace-cursor-collider', AltspaceCursorCollider);\r\n    registerComponentClass('altspace-tracked-controls', AltspaceTrackedControls);\r\n    registerComponentClass('altspace', AltspaceComponent);\r\n    registerComponentClass('sync-color', SyncColor);\r\n    registerComponentClass('sync', SyncComponent);\r\n\r\n}\r\n\r\nexport {AltspaceComponent, AltspaceCursorCollider, AltspaceTrackedControls, SyncSystem, SyncComponent, SyncColor, flatten };\r\n","window.altspace = window.altspace || {};\r\nwindow.altspace.utilities = window.altspace.utilities || {};\r\n\r\nimport CursorShim from 'shims/cursor';\r\n\r\n/**\r\n* @module altspace/utilities\r\n*/\r\n\r\n/**\r\n* Simulation is a helper class that lets you quickly setup a three.js app with support for AltspaceVR. It creates a basic scene for you and starts the render and behavior loop.\r\n*\r\n* If all of your application logic is in behaviors, you do not need to create any additional requestAnimationFrame loops.\r\n*\r\n* It also automatically uses the WebGL renderer when running in a\r\n* desktop browser and emulates cursor events with mouse clicks.\r\n* @class Simulation\r\n* @param {Object} [config] Optional parameters.\r\n* @param {Boolean} [config.auto=true] Automatically start the render loop.\r\n* @memberof module:altspace/utilities\r\n*/\r\nclass Simulation\r\n{\r\n\tconstructor({auto = true})\r\n\t{\r\n\t\tthis._scene = null;\r\n\t\tthis._renderer = null;\r\n\t\tthis._camera = null;\r\n\r\n\t\tlet usingAFrame = window.AFRAME && document.querySelector('a-scene');\r\n\r\n\t\tif(usingAFrame)\r\n\t\t{\r\n\t\t\tlet ascene = document.querySelector('a-scene');\r\n\t\t\tthis._scene = ascene.object3D;\r\n\t\t\tthis._renderer = ascene.renderer;\r\n\r\n\t\t\tlet acamera = document.querySelector('a-camera');\r\n\t\t\tif(acamera)\r\n\t\t\t\tthis._camera = acamera.object3D;\r\n\t\t}\r\n\t\telse if (window.altspace && altspace.inClient)\r\n\t\t{\r\n\t\t\tthis._scene = new THREE.Scene();\r\n\t\t\tthis._renderer = altspace.getThreeJSRenderer();\r\n\t\t\tthis._camera = new THREE.PerspectiveCamera(); // TODO: change from shim to symbolic\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._setupWebGL();\r\n\t\t}\r\n\r\n\t\tif(auto && !usingAFrame)\r\n\t\t\tthis.loop();\r\n\t}\r\n\r\n\t_setupWebGL()\r\n\t{\r\n\t\tlet scene = this._scene = new THREE.Scene();\r\n\t\tlet renderer = this._renderer = new THREE.WebGLRenderer({antialias: true});\r\n\t\tlet camera = this._camera = new THREE.PerspectiveCamera();\r\n\r\n\t\tdocument.addEventListener(\"DOMContentLoaded\", event => {\r\n\t\t\tdocument.body.style.margin = '0px';\r\n\t\t\tdocument.body.style.overflow = 'hidden';\r\n\t\t\trenderer.setClearColor('#035F72');\r\n\t\t\tlet container = document.createElement('div');\r\n\t\t\tdocument.body.appendChild(container);\r\n\t\t\tcontainer.appendChild(renderer.domElement);\r\n\t\t});\r\n\r\n\t\tfunction resizeRender(){\r\n\t\t\tcamera.aspect = window.innerWidth / window.innerHeight;\r\n\t\t\tcamera.updateProjectionMatrix();\r\n\t\t\trenderer.setSize(window.innerWidth, window.innerHeight);\r\n\t\t}\r\n\t\twindow.addEventListener('resize', resizeRender);\r\n\t\tresizeRender();\r\n\r\n\t\tcamera.position.z = 500;\r\n\t\tcamera.fov = 45;\r\n\t\tcamera.near = 1;\r\n\t\tcamera.far = 2000;\r\n\t\tscene.add(camera);\r\n\t\tscene.add(new THREE.AmbientLight('white'));\r\n\r\n\t\t// shim cursor\r\n\t\tthis.cursor = new CursorShim(scene, camera);\r\n\t}\r\n\r\n\t/**\r\n\t* Begin the simulation. This loop is begun automatically by default.\r\n\t*/\r\n\tloop()\r\n\t{\r\n\t\twindow.requestAnimationFrame(this.loop.bind(this));\r\n\r\n\t\tif(this.scene.updateAllBehaviors)\r\n\t\t\tthis.scene.updateAllBehaviors();\r\n\r\n\t\tthis.renderer.render(this.scene, this.camera);\r\n\t}\r\n\r\n\t/**\r\n\t* The simulation scene.\r\n\t* @readonly\r\n\t* @instance\r\n\t* @member {THREE.Scene} scene\r\n\t* @memberof module:altspace/utilities.Simulation\r\n\t*/\r\n\tget scene(){ return this._scene; }\r\n\r\n\t/**\r\n\t* The renderer being used.\r\n\t* @readonly\r\n\t* @instance\r\n\t* @member {(THREE.WebGLRenderer|AltRenderer)} renderer\r\n\t* @memberof module:altspace/utilities.Simulation\r\n\t*/\r\n\tget renderer(){ return this._renderer; }\r\n\r\n\t/**\r\n\t* The camera being used by the WebGL renderer.\r\n\t* @readonly\r\n\t* @instance\r\n\t* @member {Three.Camera} camera\r\n\t* @memberof module:altspace/utilities.Simulation\r\n\t*/\r\n\tget camera(){ return this._camera; }\r\n\r\n}\r\n\r\nexport default Simulation;\r\n","'use strict';\r\n\r\n/**\r\n* The main module for the AltspaceVR SDK.\r\n* @module altspace\r\n*/\r\n\r\n// make sure that the core uses the correct version of the SDK\r\nlet version = VERSION;\r\nif (window.altspace && window.altspace.requestVersion) {\r\n\twindow.altspace.requestVersion(version);\r\n}\r\n\r\n// include source packages\r\nimport * as components from './components/index';\r\nimport * as utilities from './utilities/index';\r\n\r\nexport { components, utilities };\r\n"],"names":["flatten","obj","let","ret","__proto__","Object","assign","schema","dependencies","push","ref","registerComponentClass","name","cls","AFRAME","registerComponent","registerSystemClass","registerSystem","safeDeepSet","keys","value","length","slice","dashEscape","keyName","encodeURIComponent","replace","getCanonicalUrl","canonicalElement","document","querySelector","href","window","location","getProjectId","appId","authorId","canonicalUrl","connect","config","getRefs","refs","projectId","app","baseRef","child","space","spaceId","user","userId","instancesRef","instanceId","instance","key","updateUrl","url","query","toString","Url","baseRefUrl","Firebase","Error","tasks","inAltspace","unshift","altspace","getSpace","getUser","Promise","all","then","results","pop","sid","connection","LoadRequest","error","objUrls","mtlUrls","objects","objectsLoaded","init","params","p","TRACE","crossOrigin","baseUrl","loader","utilities","shims","OBJMTLLoader","console","log","load","loadRequest","onComplete","req","start","Date","now","reqCount","i","loadModel","objUrl","mtlUrl","object3d","elapsed","toFixed","onProgress","xhr","target","responseURL","lengthComputable","percentComplete","loaded","total","filename","split","Math","round","printDebugInfo","inTile","inVR","ensureInVR","css","createElement","type","innerHTML","head","appendChild","body","style","background","Please","make_color","seed","getPenId","info","className","nameEl","toUpperCase","errorMsg","launchEl","insertBefore","notice","setName","n","getParsedUrl","fullUrl","splitPath","path","id","getAuthorId","isTeam","AFrameSystem","prototypeAccessors","tick","time","timeDelta","pause","play","AFrameComponent","update","oldData","remove","updateSchema","data","AltspaceCursorCollider","enabled","default","this","setColliderFlag","el","addEventListener","bind","state","object3D","userData","traverse","subobj","THREE","Mesh","AltspaceTrackedControls","gamepadIndex","trackedControlsSystem","systems","systemGamepads","getGamepads","controllers","components","hand","controller","setAttribute","AltspaceComponent","usePixelScale","verticalAlign","enclosuresOnly","fullspace","version","Scene","warn","inClient","initRenderer","initCursorEvents","initCollisionEvents","t","dt","updateAllBehaviors","scene","getEnclosure","e","requestFullspace","scale","setScalar","pixelsPerMeter","position","y","innerHeight","innerDepth","renderer","render","effect","oldRenderer","getThreeJSRenderer","aframeComponentVersion","noop","setSize","setPixelRatio","setClearColor","clear","enableScissorTest","setScissor","setViewport","getPixelRatio","getMaxAnisotropy","setFaceCulling","context","canvas","shadowMap","emit","eventName","event","targetEl","cursorEl","ray","point","cursordownObj","uuid","addState","removeState","other","SyncColor","sync","isConnected","colorRef","dataRef","refChangedLocked","firstValue","component","detail","newData","color","isMine","setTimeout","set","on","snapshot","val","SyncComponent","isComponent","_isComponent","undefined","syncSys","ownerRef","ownerId","mode","ownOn","sceneEl","ownershipEvents","forEach","takeOwnership","clientId","onDisconnect","shouldTakeOwnership","isMasterClient","sceneRef","link","setupReceive","entityRef","transaction","owner","newOwnerId","gained","lost","cancel","SyncSystem","author","refUrl","connected","clientsRef","masterClientId","self","clientIds","masterClientKey","childSnapshot","joinedClientId","leftClientId","once","shouldInitialize","onTransform","componentName","onComponentChanged","sendPosition","sendRotation","sendScale","throttle","func","wait","options","timeout","args","result","previous","later","leading","apply","throttled","remaining","arguments","clearTimeout","trailing","positionRef","rotationRef","scaleRef","updateRate","stoppedAnimations","children","tagName","toLowerCase","stop","animation","sendEvent","sender","soundEventRef","soundStateRef","sound","playSound","pauseSound","off","meshInit","mesh","collider","addNativeComponent","nativeComponentInit","getOrCreateObject3D","PlaceholderMesh","call","nativeComponentRemove","getObject3D","removeNativeComponent","nativeComponentUpdate","updateNativeComponent","object3DMap","callComponent","functionName","functionArguments","callNativeComponent","placeholderGeometry","BoxGeometry","placeholderMaterial","MeshBasicMaterial","visible","prototype","create","constructor","res","text","fontSize","width","height","horizontalAlign","isTrigger","center","radius","size","direction","_forEachMesh","childObj","_initObj","convex","count","capacity","src","startsWith","origin","currPath","pathname","endsWith","join","seek","playHandler","removeEventListener","loop","volume","autoplay","oneshot","spatialBlend","pitch","minDistance","maxDistance","rolloff","multiple","gain","lose","targets","actOnTargets","actOnTargetsIfStateMatches","act","Simulation","_scene","_renderer","_camera","usingAFrame","ascene","acamera","PerspectiveCamera","_setupWebGL","auto","resizeRender","camera","aspect","innerWidth","updateProjectionMatrix","WebGLRenderer","antialias","margin","overflow","container","domElement","z","fov","near","far","add","AmbientLight","cursor","CursorShim","requestAnimationFrame","inCodePen","match","VERSION","requestVersion"],"mappings":"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"}