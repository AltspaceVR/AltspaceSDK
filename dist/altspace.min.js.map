{"version":3,"file":"altspace.min.js.map","sources":["../../src/components/AFrameComponent.js","../../src/components/utilities.js","../../src/utilities/sync.js","../../src/utilities/shims/cursor.js","../../src/utilities/multiloader.js","../../src/utilities/codepen.js","../../src/utilities/shims/bubbling.js","../../src/components/AltspaceCursorCollider.js","../../src/components/AltspaceTrackedControls.js","../../src/components/AltspaceComponent.js","../../src/components/SyncColor.js","../../src/components/SyncComponent.js","../../src/components/SyncSystem.js","../../src/components/sync-transform.js","../../src/components/sync-n-sound.js","../../src/components/native-components.js","../../src/components/wire.js","../../src/components/index.js","../../src/utilities/simulation.js","../../src/utilities/shims/OBJMTLLoader.js","../../src/utilities/shims/behaviors.js","../../src/index.js"],"sourcesContent":["'use strict';\r\n\r\n/**\r\n* Stubs out the A-Frame \"system\" concept.\r\n* @see {@link https://aframe.io/docs/0.3.0/core/systems.html}\r\n*/\r\nclass AFrameSystem\r\n{\r\n\tget schema(){\r\n\t\treturn null;\r\n\t}\r\n\r\n\tinit(){ }\r\n\ttick(time, timeDelta){ }\r\n\tpause(){ }\r\n\tplay(){ }\r\n}\r\n\r\n/**\r\n* Stubs out the A-Frame \"component\" concept.\r\n* @extends AFrameSystem\r\n* @see {@link https://aframe.io/docs/0.3.0/core/component.html}\r\n*/\r\nclass AFrameComponent extends AFrameSystem\r\n{\r\n\tupdate(oldData){ }\r\n\tremove(){ }\r\n\tupdateSchema(data){ }\r\n}\r\n\r\nfunction flatten(obj)\r\n{\r\n\tlet ret = {};\r\n\tif(!obj.__proto__){\r\n\t\tret = Object.assign( {schema: {}, dependencies: []}, obj );\r\n\t}\r\n\telse {\r\n\t\tret = Object.assign( flatten(obj.__proto__), obj );\r\n\t}\r\n\r\n\tif(obj.schema)\r\n\t\tObject.assign(ret.schema, obj.schema);\r\n\r\n\tif(obj.dependencies)\r\n\t\tret.dependencies.push(...obj.dependencies);\r\n\r\n\treturn ret;\r\n}\r\n\r\nfunction registerComponentClass(name, cls)\r\n{\r\n\tAFRAME.registerComponent(name, flatten(new cls(true)));\r\n}\r\n\r\nfunction registerSystemClass(name, cls)\r\n{\r\n\tAFRAME.registerSystem(name, flatten(new cls(true)));\r\n}\r\n\r\nexport { AFrameComponent, AFrameSystem, registerComponentClass, registerSystemClass, flatten };\r\n","'use strict';\r\n\r\nfunction safeDeepSet(obj, keys, value)\r\n{\r\n\tif(keys.length === 0)\r\n\t\treturn value;\r\n\telse {\r\n\t\tobj[keys[0]] = safeDeepSet(obj[keys[0]] || {}, keys.slice(1), value);\r\n\t\treturn obj;\r\n\t}\r\n}\r\n\r\nexport { safeDeepSet };\r\n","/**\r\n * The Sync utility is currently based on Firebase. It provides a quick way\r\n * to synchronize apps between users (even when they are running outside of\r\n * AltspaceVR).\r\n * During the SDK beta, please consider all data stored with the sync\r\n * utility to be ephemeral (it may be cleared or clobbered at any time).\r\n * You do not need a Firebase account to use the Sync utility.\r\n *\r\n *\r\n * Refer to the [Firebase API documentation](https://www.firebase.com/docs/web/api/)\r\n * when working with the sync instance.\r\n * @module altspace/utilities/sync\r\n */\r\n\r\nlet Firebase = window.Firebase;\r\nlet inAltspace = altspace && altspace.inClient;\r\nlet canonicalUrl = getCanonicalUrl();\r\n\r\nlet instance;\r\n\r\nfunction dashEscape(keyName) {\r\n\treturn keyName ? encodeURIComponent(keyName).replace(/\\./g, '%2E').replace(/%[A-Z0-9]{2}/g, '-') : null;\r\n}\r\n\r\nfunction getCanonicalUrl() {\r\n\tvar canonicalElement = document.querySelector('link[rel=canonical]');\r\n\treturn canonicalElement ? canonicalElement.href : window.location.href;\r\n}\r\n\r\nfunction getProjectId(appId, authorId, canonicalUrl) {\r\n\treturn dashEscape(authorId || canonicalUrl) + ':' + dashEscape(appId || '');\r\n}\r\n\r\n\r\n/**\r\n* Retreived\r\n* via [altspace.utilities.sync.connect]{@link module:altspace/utilities/sync#connect}.\r\n* @class module:altspace/utilities/sync~Connection\r\n* @memberof module:altspace/utilities/sync\r\n*/\r\n\r\n/**\r\n* (In-client only) A Firebase reference for the current user (on a per app basis). This can be used for things like a persistent inventory or personal highscores.\r\n* @instance\r\n* @member {Firebase} user\r\n* @memberof module:altspace/utilities/sync~Connection\r\n*/\r\n\r\n/**\r\n* A Firebase reference to the current instance of the app.\r\n* This will change if the query paramater is removed through navigation, rebeaming, the space timing out, or other reasons.\r\n* This can be used as an input to SceneSync\r\n* @instance\r\n* @member {Firebase} instance\r\n* @memberof module:altspace/utilities/sync~Connection\r\n*/\r\n\r\n/**\r\n* (In-client only) A Firebase reference for the current space. Especially useful if multiple apps / instances need to communicate inside the space.\r\n* @instance\r\n* @member {Firebase} space\r\n* @memberof module:altspace/utilities/sync~Connection\r\n*/\r\n\r\n/**\r\n* A Firebase reference for the app.\r\n* This can be used for things like persistent high-scores, dynamic configuration, or inter-instance communication.\r\n* @instance\r\n* @member {Firebase} app\r\n* @memberof module:altspace/utilities/sync~Connection\r\n*/\r\n\r\n\r\n/**\r\n* Connect to a sync session to obtain Firebase references that can be used for syncronization of real-time and persistent state.\r\n* Returns a promise that will fulfill with a [Connection]{@link module:altspace/utilities/sync~Connection}.\r\n*\r\n* @method connect\r\n* @param {Object} config\r\n* @param {String} config.authorId A unique identifier for yourself or your organization\r\n* @param {String} config.appId The name of your app\r\n* @param {String} [config.baseRefUrl] Override the base reference. Set this to use your own Firebase.\r\n* @param {String} [config.instanceId] Override the instanceId. Can also be overriden using a query parameter.\r\n* @param {String} [config.spaceId] Override the spaceId. Can also be overriden using a query parameter.\r\n* @param {String} [config.userId] Override the userId. Can also be overriden using a query parameter.\r\n* @return {Promise}\r\n* @memberof module:altspace/utilities/sync\r\n**/\r\n//todo clients\r\nfunction connect(config)\r\n{\r\n\tconfig = config || {};\r\n\r\n\tvar url = new Url();\r\n\r\n\t// Our ref used for example apps. Data may be cleared periodically.\r\n\tvar baseRefUrl = config.baseRefUrl || 'https://altspace-apps.firebaseio.com/apps/examples/';\r\n\tvar baseRef = new Firebase(baseRefUrl);\r\n\r\n\t// Gather query paramaters (some may only be used as testing overrides)\r\n\tvar instanceId = config.instanceId || url.query['altspace-sync-instance'];\r\n\tvar spaceId = config.spaceId || url.query['altspace-sync-space'];\r\n\tvar userId = config.userId || url.query['altspace-sync-user'];\r\n\r\n\tif (!config.appId || !config.authorId) {\r\n\t\tthrow new Error('Both the appId and authorId must be provided to connect.');\r\n\t}\r\n\r\n\tvar tasks = [];\r\n\tif (inAltspace) {\r\n\t\tif (!spaceId) tasks.unshift(altspace.getSpace());\r\n\t\tif (!userId) tasks.unshift(altspace.getUser());\r\n\t}\r\n\r\n\tfunction getRefs() {\r\n\t\tvar refs = {};\r\n\r\n\t\tvar projectId = getProjectId(config.appId, config.authorId, canonicalUrl);\r\n\t\trefs.app = baseRef.child(projectId).child('app');\r\n\t\trefs.space = spaceId ? refs.app.child('spaces').child(spaceId) : null;\r\n\t\trefs.user = userId ? refs.app.child('users').child(userId) : null;\r\n\r\n\t\tvar instancesRef = refs.app.child('instances');\r\n\t\tif (instanceId) {\r\n\t\t\trefs.instance = instancesRef.child(instanceId);\r\n\t\t} else {\r\n\t\t\trefs.instance = instancesRef.push();\r\n\t\t\tinstanceId = refs.instance.key();\r\n\t\t}\r\n\t\treturn refs;\r\n\t}\r\n\r\n\tfunction updateUrl() {\r\n\t\tif (!url.query['altspace-sync-instance']) {\r\n\t\t\turl.query['altspace-sync-instance'] = instanceId;\r\n\t\t\twindow.location.href = url.toString();\r\n\t\t}\r\n\t}\r\n\r\n\treturn Promise.all(tasks).then(function (results) {\r\n\t\tif (inAltspace) {\r\n\t\t\tif (!spaceId) spaceId = results.pop().sid;\r\n\t\t\tif (!userId) userId = results.pop().userId;\r\n\t\t}\r\n\r\n\t\tspaceId = dashEscape(spaceId);\r\n\t\tuserId = dashEscape(userId);\r\n\t\tinstanceId = dashEscape(instanceId);\r\n\r\n\t\tvar connection = getRefs();\r\n\r\n\t\tupdateUrl();\r\n\r\n\t\treturn connection;\r\n\t});\r\n}\r\n\r\nexport { connect };\r\n","/**\r\n* Detects mouse move/up/down events, raycasts to find intersected objects,\r\n* then dispatches cursor move/up/down/enter/leave events that mimics\r\n* Altspace events.\r\n* @module altspace/utilities/shims/cursor\r\n*/\r\n'use strict';\r\n\r\nvar scene;\r\nvar camera;\r\nvar domElem;\r\n\r\nvar overObject;\r\n\r\nvar raycaster = new THREE.Raycaster();\r\n\r\n/**\r\n * Initializes the cursor module\r\n * @static\r\n * @method init\r\n * @param {THREE.Scene} scene\r\n * @param {THREE.Camera} camera - Camera used for raycasting.\r\n * @param {Object} [options] - An options object\r\n * @param {THREE.WebGLRenderer} [options.renderer] - If supplied, applies cursor movement to render target\r\n *\tinstead of entire client\r\n * @memberof module:altspace/utilities/shims/cursor\r\n */\r\nfunction init(_scene, _camera, _params) {\r\n\tif (!_scene || !_scene instanceof THREE.Scene) {\r\n\t\tthrow new TypeError('Requires THREE.Scene argument');\r\n\t}\r\n\tif (!_camera || !_camera instanceof THREE.Camera) {\r\n\t\tthrow new TypeError('Requires THREE.Camera argument');\r\n\t}\r\n\tscene = _scene;\r\n\tcamera = _camera;\r\n\r\n\tp = _params || {};\r\n\tdomElem = p.renderer && p.renderer.domElement || window;\r\n\r\n\tdomElem.addEventListener('mousedown', mouseDown, false)\r\n\tdomElem.addEventListener('mouseup', mouseUp, false)\r\n\tdomElem.addEventListener('mousemove', mouseMove, false)\r\n}\r\n\r\nfunction mouseDown(event) {\r\n\r\n\tvar intersection = findIntersection(event);\r\n\tif (!intersection || !intersection.point) return;\r\n\r\n\tvar cursorEvent = createCursorEvent('cursordown', intersection);\r\n\tintersection.object.dispatchEvent(cursorEvent);\r\n}\r\n\r\nfunction mouseUp(event) {\r\n\tvar intersection = findIntersection(event);\r\n\r\n\tvar cursorEvent = createCursorEvent('cursorup', intersection);\r\n\r\n\tif (intersection) {\r\n\t\tintersection.object.dispatchEvent(cursorEvent);\r\n\t} else {\r\n\t\tscene.dispatchEvent(cursorEvent);\r\n\t}\r\n}\r\n\r\nfunction mouseMove(event) {\r\n\tvar intersection = findIntersection(event);\r\n\r\n\tvar cursorEvent = createCursorEvent('cursormove', intersection);//TODO improve and don't fire only on scene\r\n\tscene.dispatchEvent(cursorEvent);\r\n\r\n\tvar object = intersection ? intersection.object : null;\r\n\tif (overObject != object) {\r\n\t\tif (overObject) {\r\n\t\t\tcursorEvent = createCursorEvent('cursorleave', intersection);\r\n\t\t\toverObject.dispatchEvent(cursorEvent);\r\n\t\t}\r\n\r\n\t\tif (object) {\r\n\t\t\tcursorEvent = createCursorEvent('cursorenter', intersection);\r\n\t\t\tobject.dispatchEvent(cursorEvent);\r\n\t\t}\r\n\r\n\t\toverObject = object;\r\n\t}\r\n}\r\n\r\nfunction createCursorEvent(type, intersection) {\r\n\treturn {\r\n\t\ttype: type,\r\n\t\tbubbles: true,\r\n\t\ttarget: intersection ? intersection.object : null,\r\n\t\tray: {\r\n\t\t\torigin: raycaster.ray.origin.clone(),\r\n\t\t\tdirection: raycaster.ray.direction.clone()\r\n\t\t},\r\n\t\tpoint: intersection ? intersection.point.clone() : null\r\n\t}\r\n}\r\n\r\nfunction findIntersection(mouseEvent) {\r\n\tvar mouse = new THREE.Vector2();\r\n\tmouse.x = (mouseEvent.offsetX / (domElem.width || domElem.innerWidth)) * 2 - 1;\r\n\tmouse.y = -(mouseEvent.offsetY / (domElem.height || domElem.innerHeight)) * 2 + 1;\r\n\r\n\traycaster.setFromCamera(mouse, camera);\r\n\r\n\tvar intersections = raycaster.intersectObjects(scene.children, true);\r\n\r\n\t// return the first object with an enabled collider\r\n\treturn intersections.find(function(e){\r\n\t\treturn !e.object.userData\r\n\t\t\t|| !e.object.userData.altspace\r\n\t\t\t|| !e.object.userData.altspace.collider\r\n\t\t\t|| e.object.userData.altspace.collider.enabled !== false;\r\n\t}) || null;\r\n}\r\n\r\nexport {init};\r\n","'use strict';\r\n\r\nvar loader;\r\nvar TRACE;\r\nvar baseUrl = '';\r\nvar crossOrigin = '';//assigned to THREE.MTLLoader.crossOrigin\r\n\r\nfunction LoadRequest(){\r\n\t//To create loadRequst: new MultiLoader.LoadRequest()\r\n\r\n\tvar objUrls = [];//Paths to model geometry file, in Wavefront OBJ format.\r\n\tvar mtlUrls = [];//Paths to model materials file, in Wavefront MTL format.\r\n\tvar objects = [];//objects[i] is result of loader.load(objUrl[i], mtlUrl[i])\r\n\tvar error;//String indicating loading error with at least one file.\r\n\tvar objectsLoaded = 0;//Used internally to determine when loading complete.\r\n\r\n\treturn {\r\n\t\tobjUrls: objUrls,\r\n\t\tmtlUrls: mtlUrls,\r\n\t\tobjects: objects,\r\n\t\terror: error,\r\n\t\tobjectsLoaded: objectsLoaded\r\n\t};\r\n\r\n}//end of LoadRequest\r\n\r\nfunction init(params){\r\n\tvar p = params || {};\r\n\tTRACE = p.TRACE || false;\r\n\tif (p.crossOrigin) crossOrigin = p.crossOrigin;\r\n\tif (p.baseUrl) baseUrl = p.baseUrl;\r\n\tif (baseUrl.slice(-1) !== '/') baseUrl += '/';\r\n\r\n\tloader = new altspace.utilities.shims.OBJMTLLoader();\r\n\tloader.crossOrigin = crossOrigin;\r\n\tif (TRACE) console.log('MultiLoader initialized with params', params);\r\n}\r\n\r\nfunction load(loadRequest, onComplete){\r\n\tvar req = loadRequest;\r\n\tvar start = Date.now();\r\n\tif (!req || !req instanceof LoadRequest){\r\n\t\tthrow new Error('MultiLoader.load expects first arg of type LoadRequest');\r\n\t}\r\n\tif (!onComplete || typeof(onComplete) !== 'function'){\r\n\t\tthrow new Error('MultiLoader.load expects second arg of type function');\r\n\t}\r\n\tif (!req.objUrls || !req.mtlUrls || req.objUrls.length !== req.mtlUrls.length){\r\n\t\tthrow new Error('MultiLoader.load called with bad LoadRequest');\r\n\t}\r\n\tvar reqCount = req.objUrls.length;\r\n\tif (TRACE) console.log('Loading models...')\r\n\tfor (var i=0; i < reqCount; i++){\r\n\t\tvar loadModel = function(req, i){//We need i in the closure to store result.\r\n\t\t\tvar objUrl = baseUrl + req.objUrls[i];\r\n\t\t\tvar mtlUrl = baseUrl + req.mtlUrls[i];\r\n\t\t\tif (TRACE) console.log('Loading obj:'+objUrl+', mtl:'+mtlUrl);\r\n\t\t\tloader.load(objUrl, mtlUrl, function(object3d){//onLoaded\r\n\t\t\t\treq.objects[i] = object3d;\r\n\t\t\t\treq.objectsLoaded++;\r\n\t\t\t\tif(req.objectsLoaded === reqCount){\r\n\t\t\t\t\tvar elapsed = ((Date.now()-start)/1000.0).toFixed(2);\r\n\t\t\t\t\tif (TRACE) console.log('Loaded '+reqCount+' models in '+elapsed+' seconds');\r\n\t\t\t\t\tonComplete();\r\n\t\t\t\t}\r\n\t\t\t}, onProgress, function(){//onError\r\n\t\t\t\tvar url = xhr.target.responseURL || '';\r\n\t\t\t\treq.error = 'Error loading file '+url;\r\n\t\t\t});\r\n\t\t};\r\n\t\tloadModel(req, i);\r\n\t}\r\n}\r\n\r\nfunction onProgress(xhr){\r\n\tif (xhr.lengthComputable && xhr.target.responseURL) {\r\n\t\t//Skip progress log if no xhr url, meaning it's a local file.\r\n\t\tvar percentComplete = xhr.loaded / xhr.total * 100;\r\n\t\tvar filename = xhr.target.responseURL.split('/').pop();\r\n\t\tif (TRACE) console.log('...'+filename+' '+Math.round(percentComplete,2)+'% downloaded');\r\n\t}\r\n}\r\n\r\nexport { init, load, LoadRequest };\r\n","/**\r\n * Utilities to help build AltspaceVR apps on CodePen.io.\r\n * @module altspace/utilities/codePen\r\n */\r\n\r\nvar Please = window.Please;\r\nvar Url = window.Url;\r\n\r\nvar name = 'VR CodePen';\r\nvar inTile = window.name && window.name.slice(0, 4) === 'pen-';\r\nvar inVR = !!window.altspace.inClient;\r\nvar inCodePen = !!location.href.match('codepen.io/');\r\n\r\nfunction printDebugInfo() {\r\n\tconsole.log(\"In a tile: \" + inTile);\r\n\tconsole.log(\"In VR: \" + inVR);\r\n}\r\n\r\n/**\r\n * Will stop code exection and post a message informing the user to\r\n * open the example in VR\r\n * @method ensureInVR\r\n * @memberof module:altspace/utilities/codePen\r\n */\r\nfunction ensureInVR() {\r\n\tif (inTile || !inVR) //inTile && inAltspace\r\n\t{\r\n\t\tvar css = document.createElement(\"style\");\r\n\t\tcss.type = \"text/css\";\r\n\t\tcss.innerHTML = \"@import url(https://fonts.googleapis.com/css?family=Open+Sans:800);.altspace-info{text-align:center;font-family:'Open Sans',sans-serif;line-height:.5}.altspace-vr-notice{color:rgba(0,0,0,.7);font-size:5vw}.altspace-pen-name{font-size:7vw}\";\r\n\t\tdocument.head.appendChild(css);\r\n\r\n\t\tdocument.body.style.background = Please.make_color({ seed: getPenId() });\r\n\r\n\t\tvar info = document.createElement(\"div\");\r\n\t\tinfo.className = \"altspace-info\";\r\n\t\tdocument.body.appendChild(info);\r\n\r\n\t\tvar nameEl = document.createElement(\"span\");\r\n\t\tnameEl.className = \"altspace-pen-name\";\r\n\t\tnameEl.innerHTML = '<p>' + name.toUpperCase() + '</p>';\r\n\t\tinfo.appendChild(nameEl);\r\n\r\n\t\tif (inTile) {\r\n\t\t\tvar errorMsg = 'VR mode does not support preview tiles. Stopping code execution.';\r\n\t\t\tconsole.log('ERROR: ' + errorMsg);\r\n\t\t\tthrow new Error(errorMsg);\r\n\t\t}\r\n\r\n\t\tif (!inVR) {\r\n\r\n\t\t\tvar launchEl = document.createElement(\"span\");\r\n\t\t\tlaunchEl.className = \"altspace-vr-notice\";\r\n\t\t\tlaunchEl.innerHTML = '<p>View</p>';\r\n\t\t\tinfo.insertBefore(launchEl, nameEl);\r\n\r\n\t\t\tvar notice = document.createElement(\"span\");\r\n\t\t\tnotice.className = \"altspace-vr-notice\";\r\n\t\t\tnotice.innerHTML = '<p>in <a href=\"http://altvr.com\"> AltspaceVR </a></p>';\r\n\t\t\tinfo.appendChild(notice);\r\n\r\n\r\n\t\t\tvar errorMsg = 'Not in VR mode. Stopping code execution.';\r\n\t\t\tif (inTile) {\r\n\t\t\t\tconsole.log('ERROR: ' + errorMsg);//thrown error message not displayed in console when inTile, log it\r\n\t\t\t}\r\n\t\t\tthrow new Error(errorMsg);\r\n\t\t}\r\n\t\treturn;\r\n\r\n\t}\r\n}\r\n\r\n/**\r\n * Sets the name to be used by ensureInVR()\r\n * @method setName\r\n * @param {String} name\r\n * @memberof module:altspace/utilities/codePen\r\n */\r\nfunction setName(n) {//TODO: A better method for this would be awesome\r\n\tname = n;\r\n}\r\n\r\nfunction getParsedUrl() {\r\n\tvar canonicalElement = document.querySelector('link[rel=canonical]');\r\n\tvar fullUrl = canonicalElement ? canonicalElement.href : window.location.href;\r\n\treturn new Url(fullUrl);\r\n}\r\n\r\n\r\n/**\r\n * Returns the pen ID, useful for setting the sync instanceId.\r\n * @method getPenId\r\n * @return {String}\r\n * @memberof module:altspace/utilities/codePen\r\n */\r\nfunction getPenId() {\r\n\tvar url = getParsedUrl();\r\n\tvar splitPath = url.path.split('/');\r\n\tvar id = splitPath[splitPath.length - 1];\r\n\treturn id;\r\n}\r\n\r\n/**\r\n * Returns the pen author ID, useful for setting the sync authorId.\r\n * @method getAuthorId\r\n * @return {String}\r\n * @memberof module:altspace/utilities/codePen\r\n */\r\nfunction getAuthorId() {\r\n\tvar url = getParsedUrl();\r\n\tvar splitPath = url.path.split('/');\r\n\tvar isTeam = splitPath[1] == 'team';\r\n\tvar id = isTeam ? 'team-' + splitPath[2] : splitPath[1];\r\n\treturn id;\r\n}\r\n\r\nexport { inTile, inVR, inCodePen, ensureInVR, setName, getPenId, getAuthorId, printDebugInfo };\r\n","/**\r\n* The Altspace SDK adds event bubbling to Three.js' events system.\r\n* Simply include the SDK in your app and add a bubbling property to your event to take advantage of this feature.\r\n*\r\n* AltspaceVR cursor events always make use of this bubbling shim.\r\n*\r\n* @example\r\n* var parent = new THREE.Object3D();\r\n* parent.addEventListener('custom', function () {\r\n*     console.log('received custom event');\r\n* });\r\n* var child = new THREE.Object3D();\r\n* parent.add(child);\r\n* child.dispatchEvent({type: 'custom', bubbles: true});\r\n* // Console log shows 'received custom event'\r\n*\r\n* @module altspace/utilities/shims/bubbling\r\n*/\r\n\r\nif(THREE && !altspace.inClient)\r\n{\r\n\tTHREE.EventDispatcher.prototype.dispatchEvent = dispatchEvent;\r\n\tTHREE.Object3D.prototype.dispatchEvent = dispatchEvent;\r\n}\r\n\r\nfunction dispatchEvent( event ) {\r\n\r\n\tvar shouldStopPropagation;\r\n\tvar shouldStopPropagationImmediately;\r\n\r\n\tif ( event.bubbles ) {\r\n\t\tevent.currentTarget = this;\r\n\t\tevent.stopPropagation = function () {\r\n\t\t\tshouldStopPropagation = true;\r\n\t\t}\r\n\r\n\t\tevent.stopImmediatePropagation = function () {\r\n\t\t\tshouldStopPropagationImmediately = true;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tif ( this._listeners ) {\r\n\r\n\t\tvar listeners = this._listeners;\r\n\t\tvar listenerArray = listeners[ event.type ];\r\n\r\n\t\tif ( listenerArray ) {\r\n\t\t\tevent.target = event.target || this;\r\n\r\n\t\t\tvar array = [];\r\n\t\t\tvar length = listenerArray.length;\r\n\r\n\t\t\tfor ( var i = 0; i < length; i ++ ) {\r\n\t\t\t\tarray[ i ] = listenerArray[ i ];\r\n\t\t\t}\r\n\r\n\t\t\tfor ( var i = 0; i < length; i ++ ) {\r\n\t\t\t\tarray[ i ].call( this, event );\r\n\t\t\t\tif ( shouldStopPropagationImmediately ) return;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif ( event.bubbles && this.parent && this.parent.dispatchEvent && ! shouldStopPropagation ) {\r\n\t\tdispatchEvent.call( this.parent, event );\r\n\t}\r\n}\r\n","/**\r\n* Enable or disable cursor collision on the object.\r\n* @mixin altspace-cursor-collider\r\n* @memberof altspace\r\n* @prop {boolean} enabled=true - The state of the cursor collider.\r\n*/\r\n\r\n'use strict';\r\n\r\nimport {AFrameComponent} from './AFrameComponent';\r\nimport {safeDeepSet} from './utilities';\r\n\r\n\r\nexport default class AltspaceCursorCollider extends AFrameComponent\r\n{\r\n\tget schema(){\r\n\t\treturn {enabled: {type: 'boolean', default: 'true'}};\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tthis.setColliderFlag(this.data.enabled);\r\n\t\tthis.el.addEventListener('model-loaded', (() => {\r\n\t\t\tthis.setColliderFlag(this.data.enabled);\r\n\t\t}).bind(this));\r\n\t}\r\n\r\n\tupdate()\r\n\t{\r\n\t\tthis.setColliderFlag(this.data.enabled);\r\n\t}\r\n\r\n\tsetColliderFlag(state)\r\n\t{\r\n\t\tlet obj = this.el.object3D;\r\n\t\tif(obj){\r\n\t\t\tconsole.log('Setting collider flag to', state);\r\n\t\t\tsafeDeepSet(obj.userData, ['altspace','collider','enabled'], state);\r\n\t\t\tobj.traverse(subobj => {\r\n\t\t\t\tif( subobj instanceof THREE.Mesh ){\r\n\t\t\t\t\tsafeDeepSet(subobj.userData, ['altspace','collider','enabled'], state);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n};\r\n","/**\r\n* Enables tracked control support for A-Frame applications that use the built-in\r\n* `tracked-controls`, `vive-controls` or `hand-controls` components.\r\n* @mixin altspace-tracked-controls\r\n* @memberof altspace\r\n*/\r\n'use strict';\r\n\r\nimport {AFrameComponent} from './AFrameComponent';\r\n\r\nexport default class AltspaceTrackedControls extends AFrameComponent\r\n{\r\n\tinit()\r\n\t{\r\n\t\tthis.gamepadIndex = null;\r\n\t\tthis.trackedControlsSystem = document.querySelector('a-scene').systems['tracked-controls'];\r\n\t\tthis.systemGamepads = 0;\r\n\t\taltspace.getGamepads();\r\n\t}\r\n\r\n\ttick()\r\n\t{\r\n\t\tif (\r\n\t\t\tthis.trackedControlsSystem &&\r\n\t\t\tthis.systemGamepads !== this.trackedControlsSystem.controllers.length &&\r\n\t\t\twindow.altspace && altspace.getGamepads && altspace.getGamepads().length\r\n\t\t) {\r\n\t\t\tvar components = this.el.components;\r\n\t\t\tif (components['paint-controls']) {\r\n\t\t\t\tthis.gamepadIndex = components['paint-controls'].data.hand === 'left' ? 2 : 1;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.gamepadIndex === null && components['hand-controls']) {\r\n\t\t\t\tthis.gamepadIndex = components['hand-controls'].data === 'left' ? 2 : 1;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.gamepadIndex === null && components['vive-controls']) {\r\n\t\t\t\tthis.gamepadIndex = components['vive-controls'].data.hand === 'left' ? 2 : 1;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.gamepadIndex === null && components['tracked-controls']) {\r\n\t\t\t\tthis.gamepadIndex = components['tracked-controls'].data.controller;\r\n\t\t\t}\r\n\r\n\t\t\tthis.el.setAttribute('tracked-controls', 'id', altspace.getGamepads()[this.gamepadIndex].id);\r\n\t\t\tthis.el.setAttribute('tracked-controls', 'controller', 0);\r\n\t\t\tthis.systemGamepads = this.trackedControlsSystem.controllers.length;\r\n\t\t}\r\n\t}\r\n}\r\n","/**\r\n* @namespace altspace\r\n*/\r\n\r\n/**\r\n* The altspace component makes A-Frame apps compatible with AltspaceVR.\r\n*\r\n* **Note**: If you use the `embedded` A-Frame component on your scene, you must include it *before* the `altspace` component, or your app will silently fail.\r\n* @mixin altspace\r\n* @memberof altspace\r\n* @property {boolean} usePixelScale=`false` - Allows you to use A-Frame units as CSS pixels.\r\n* This is the default behavior for three.js apps, but not for A-Frame apps.\r\n* @property {string} verticalAlign=`middle` - Puts the origin at the `bottom`, `middle` (default),\r\n* or `top` of the Altspace enclosure.\r\n* @property {boolean} enclosuresOnly=`true` - Prevents the scene from being created if\r\n* enclosure is flat.\r\n* @property {boolean} fullspace=`false` - Puts the app into fullspace mode.\r\n*\r\n* @example\r\n* <head>\r\n*   <title>My A-Frame Scene</title>\r\n*   <script src=\"https://aframe.io/releases/0.3.0/aframe.min.js\"></script>\r\n*   <script src=\"https://cdn.rawgit.com/AltspaceVR/aframe-altspace-component/vAFRAME_ALTSPACE_VERSION/dist/aframe-altspace-component.min.js\"></script>\r\n* </head>\r\n* <body>\r\n*   <a-scene altspace>\r\n*     <a-entity geometry=\"primitive: box\" material=\"color: #C03546\"></a-entity>\r\n*   </a-scene>\r\n* </body>\r\n*/\r\n'use strict';\r\n\r\nimport {AFrameComponent} from './AFrameComponent';\r\n\r\nexport default class AltspaceComponent extends AFrameComponent\r\n{\r\n\tget schema(){\r\n\t\treturn {\r\n\t\t\tusePixelScale: { type: 'boolean', default: 'false'},\r\n\t\t\tverticalAlign: { type: 'string',  default: 'middle'},\r\n\t\t\tenclosuresOnly:{ type: 'boolean', default: 'true'},\r\n\t\t\tfullspace:     { type: 'boolean', default: 'false'}\r\n\t\t}\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tthis.version = 'AFRAME_ALTSPACE_VERSION';\r\n\t\tif(!this.el.object3D instanceof THREE.Scene){\r\n\t\t\tconsole.warn('aframe-altspace-component can only be attached to a-scene');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (window.altspace && window.altspace.inClient) {\r\n\t\t\tthis.el.setAttribute('vr-mode-ui', {enabled: false});\r\n\t\t\tthis.initRenderer();\r\n\t\t\tthis.initCursorEvents();\r\n\t\t\tthis.initCollisionEvents();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconsole.warn('aframe-altspace-component only works inside of AltspaceVR');\r\n\t\t}\r\n\t}\r\n\r\n\ttick(t, dt)\r\n\t{\r\n\t\tif(this.el.object3D.updateAllBehaviors)\r\n\t\t\tthis.el.object3D.updateAllBehaviors();\r\n\t}\r\n\r\n\t/*\r\n\t* Swap in Altspace renderer when running in AltspaceVR.\r\n\t*/\r\n\tinitRenderer()\r\n\t{\r\n\t\tlet scene = this.el.object3D;\r\n\t\taltspace.getEnclosure().then((e =>\r\n\t\t{\r\n\t\t\tif(this.data.fullspace){\r\n\t\t\t\te.requestFullspace();\r\n\t\t\t\te.addEventListener('fullspacechange', () => {\r\n\t\t\t\t\tscene.scale.setScalar(e.pixelsPerMeter);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (!this.data.usePixelScale || this.data.fullspace){\r\n\t\t\t\tscene.scale.setScalar(e.pixelsPerMeter);\r\n\t\t\t}\r\n\r\n\t\t\tswitch (this.data.verticalAlign) {\r\n\t\t\t\tcase 'bottom':\r\n\t\t\t\t\tscene.position.y -= e.innerHeight / 2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'top':\r\n\t\t\t\t\tscene.position.y += e.innerHeight / 2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'middle':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconsole.warn('Unexpected value for verticalAlign: ', this.data.verticalAlign);\r\n\t\t\t}\r\n\r\n\t\t\tif(this.data.enclosuresOnly && e.innerDepth === 1){\r\n\t\t\t\tthis.el.renderer.render(new THREE.Scene());\r\n\t\t\t\tthis.el.renderer = this.el.effect = oldRenderer;\r\n\r\n\t\t\t}\r\n\t\t}).bind(this));\r\n\r\n\t\tlet oldRenderer = this.el.renderer;\r\n\t\tlet renderer = this.el.renderer = this.el.effect = altspace.getThreeJSRenderer({\r\n\t\t\taframeComponentVersion: this.version\r\n\t\t});\r\n\r\n\t\tlet noop = function() {};\r\n\t\trenderer.setSize = noop;\r\n\t\trenderer.setPixelRatio = noop;\r\n\t\trenderer.setClearColor = noop;\r\n\t\trenderer.clear = noop;\r\n\t\trenderer.enableScissorTest = noop;\r\n\t\trenderer.setScissor = noop;\r\n\t\trenderer.setViewport = noop;\r\n\t\trenderer.getPixelRatio = noop;\r\n\t\trenderer.getMaxAnisotropy = noop;\r\n\t\trenderer.setFaceCulling = noop;\r\n\t\trenderer.context = {canvas: {}};\r\n\t\trenderer.shadowMap = {};\r\n\t}\r\n\r\n\t/*\r\n\t* Emulate A-Frame cursor events when running in AltspaceVR.\r\n\t*/\r\n\tinitCursorEvents()\r\n\t{\r\n\r\n\t\tlet scene = this.el.object3D;\r\n\t\tlet cursorEl = document.querySelector('a-cursor') || document.querySelector('a-entity[cursor]');\r\n\t\tif (cursorEl) {\r\n\t\t\t// Hide A-Frame cursor mesh.\r\n\t\t\tcursorEl.setAttribute('material', 'transparent', true);\r\n\t\t\tcursorEl.setAttribute('material', 'opacity', 0.0);\r\n\t\t}\r\n\r\n\t\tfunction emit(eventName, event)\r\n\t\t{\r\n\t\t\t// Fire events on intersected object and A-Frame cursor.\r\n\t\t\tlet targetEl = event.target.el;\r\n\t\t\tif (cursorEl){\r\n\t\t\t\tcursorEl.emit(eventName, { target: targetEl, ray: event.ray, point: event.point });\r\n\t\t\t}\r\n\r\n\t\t\tif (targetEl){\r\n\t\t\t\ttargetEl.emit(eventName, { target: targetEl, ray: event.ray, point: event.point });\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet cursordownObj = null;\r\n\t\tscene.addEventListener('cursordown', event => {\r\n\t\t\tcursordownObj = event.target;\r\n\t\t\temit('mousedown', event);\r\n\t\t});\r\n\r\n\t\tscene.addEventListener('cursorup', event => {\r\n\t\t\temit('mouseup', event);\r\n\t\t\tif (event.target.uuid === cursordownObj.uuid) {\r\n\t\t\t\temit('click', event);\r\n\t\t\t}\r\n\t\t\tcursordownObj = null;\r\n\t\t});\r\n\r\n\t\tscene.addEventListener('cursorenter', event => {\r\n\t\t\tif (!event.target.el){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tevent.target.el.addState('hovered');\r\n\t\t\tif (cursorEl){\r\n\t\t\t\tcursorEl.addState('hovering');\r\n\t\t\t}\r\n\t\t\temit('mouseenter', event);\r\n\t\t});\r\n\r\n\t\tscene.addEventListener('cursorleave', event => {\r\n\t\t\tif (!event.target.el){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tevent.target.el.removeState('hovered');\r\n\t\t\tif (cursorEl){\r\n\t\t\t\tcursorEl.removeState('hovering');\r\n\t\t\t}\r\n\t\t\temit('mouseleave', event);\r\n\t\t});\r\n    }\r\n\r\n\tinitCollisionEvents()\r\n\t{\r\n\t\tlet scene = this.el.object3D;\r\n\r\n\t\tfunction emit(eventName, event)\r\n\t\t{\r\n\t\t\tlet targetEl = event.target.el;\r\n\t\t\tif (!targetEl)\r\n\t\t\t\treturn;\r\n\r\n\t\t\t//remap target and other from object3Ds to aframe element\r\n\t\t\tevent.target = targetEl;\r\n\t\t\tif (event.other && event.other.el) {\r\n\t\t\t\tevent.other = event.other.el;\r\n\t\t\t}\r\n\t\t\ttargetEl.emit(eventName, event);\r\n\t\t};\r\n\r\n\t\tscene.addEventListener('collisionenter', event => {\r\n\t\t\temit('collisionenter', event);\r\n\t\t});\r\n\r\n\t\tscene.addEventListener('collisionexit', event => {\r\n\t\t\temit('collisionexit', event);\r\n\t\t});\r\n\r\n\t\tscene.addEventListener('triggerenter', event => {\r\n\t\t\temit('triggerenter', event);\r\n\t\t});\r\n\r\n\t\tscene.addEventListener('triggerexit', event => {\r\n\t\t\temit('triggerexit', event);\r\n\t\t});\r\n\r\n    }\r\n}\r\n","/**\r\n* Sync the color property of the object between clients.\r\n* Requires both a {@link sync.sync-system} component on the `a-scene`, and a\r\n* {@link sync.sync} component on the target entity.\r\n* @mixin sync-color\r\n* @memberof sync\r\n*/\r\n'use strict';\r\n\r\nimport {AFrameComponent} from './AFrameComponent';\r\n\r\nexport default class SyncColor extends AFrameComponent\r\n{\r\n\tget dependencies(){\r\n\t\treturn ['sync'];\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tthis.sync = this.el.components.sync;\r\n\r\n\t\t// wait for firebase connection to start sync routine\r\n\t\tif(this.sync.isConnected)\r\n\t\t\tstart();\r\n\t\telse\r\n\t\t\tthis.el.addEventListener('connected', this.start.bind(this));\r\n\t}\r\n\r\n\tstart()\r\n\t{\r\n\t\tlet colorRef = this.sync.dataRef.child('material/color');\r\n\t\tlet refChangedLocked = false;\r\n\t\tlet firstValue = true;\r\n\r\n\t\tcomponent.el.addEventListener('componentchanged', event =>\r\n\t\t{\r\n\t\t\tlet name = event.detail.name;\r\n\t\t\tlet oldData = event.detail.oldData;\r\n\t\t\tlet newData = event.detail.newData;\r\n\r\n\t\t\tif (name === 'material' && !refChangedLocked && oldData.color !== newData.color && sync.isMine)\r\n\t\t\t{\r\n\t\t\t\t//For some reason A-Frame has a misconfigured material reference if we do this too early\r\n\t\t\t\tsetTimeout(() => colorRef.set(newData.color), 0);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tcolorRef.on('value', snapshot => {\r\n\t\t\tif(!sync.isMine || firstValue)\r\n\t\t\t{\r\n\t\t\t\tlet color = snapshot.val();\r\n\r\n\t\t\t\trefChangedLocked = true;\r\n\t\t\t\tcomponent.el.setAttribute('material', 'color', color);\r\n\t\t\t\trefChangedLocked = false;\r\n\r\n\t\t\t\tfirstValue = false;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n","/**\r\n* Enables the synchronization of properties of entities. All property sync components\r\n* require both a {@link sync.sync-system} on `a-scene`, and a {@link sync.sync}\r\n* on the entity to be synced.\r\n* @name sync\r\n* @namespace sync\r\n* @example\r\n* <a-scene sync-system='app: example sync; author: altspacevr'>\r\n*   <a-entity sync='ownOn: cursordown' sync-color></a-entity>\r\n* </a-scene>\r\n*/\r\n\r\n/**\r\n* Enables the synchronization of properties of the entity. Must be used in\r\n* conjuction with the {@link sync.sync-system} component and a component for a\r\n* specific property (e.g. {@link sync.sync-transform}).\r\n* @memberof sync\r\n* @mixin sync\r\n* @prop {string} ownOn - The name of the event, or a list of events, that\r\n* will cause the local client to take ownership of this object. This field\r\n* cannot be updated after initialization.\r\n*/\r\n\r\nimport {AFrameComponent} from './AFrameComponent';\r\n\r\nexport default class SyncComponent extends AFrameComponent\r\n{\r\n\tconstructor(isComponent = false)\r\n\t{\r\n\t\tthis._isComponent = isComponent;\r\n\r\n\t\tthis.scene = undefined;\r\n\t\tthis.syncSys = undefined;\r\n\t\tthis.ref = undefined;\r\n\t\tthis.key = undefined;\r\n\t\tthis.dataRef = undefined;\r\n\t\tthis.ownerRef = undefined;\r\n\t\tthis.ownerId = undefined;\r\n\r\n\t\tthis.isConnected = false;\r\n\r\n\t\t/**\r\n\t\t* Indicates whether the sync ownership is yours.\r\n\t\t* @member sync.sync#isMine\r\n\t\t* @readonly\r\n\t\t*/\r\n\t\tthis.isMine = false;\r\n\t}\r\n\r\n\tget schema(){\r\n\t\treturn {\r\n\t\t\tmode: { default: 'link' },\r\n\t\t\townOn: { type: 'string' } //cannot be changed after creation\r\n\t\t};\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tthis.scene = this.el.sceneEl;\r\n\t\tthis.syncSys = this.scene.systems['sync-system'];\r\n\r\n\t\tif(this.syncSys.isConnected)\r\n\t\t\tstart();\r\n\t\telse\r\n\t\t\tthis.scene.addEventListener('connected', this.start.bind(this));\r\n\r\n\t\tif(this.data.ownOn)\r\n\t\t{\r\n\t\t\tlet ownershipEvents = this.data.ownOn.split(/[ ,]+/);\r\n\t\t\townershipEvents.forEach((e => {\r\n\t\t\t\tthis.el.addEventListener(e, (() => {\r\n\t\t\t\t\tif(this.isConnected){\r\n\t\t\t\t\t\tthis.takeOwnership();\r\n\t\t\t\t\t}\r\n\t\t\t\t}).bind(this));\r\n\t\t\t}).bind(this));\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t* Tell sync to start pushing local property values instead of updating\r\n\t* local from remote values.\r\n\t* @method sync.sync#takeOwnership\r\n\t*/\r\n\ttakeOwnership()\r\n\t{\r\n\t\tthis.ownerRef.set(this.syncSys.clientId);\r\n\r\n\t\t//clear our ownership if we disconnect\r\n\t\t//this is needed if we are the last user in the room, but we expect people to join later\r\n\t\tthis.ownerRef.onDisconnect().set(null);\r\n\t}\r\n\r\n\tstart()\r\n\t{\r\n\t\t//Make sure someone always owns an object. If the owner leaves and we are the master client, we will take it.\r\n\t\t//This ensures, for example, that synced animations keep playing\r\n\t\tthis.scene.addEventListener('clientleft', (event => {\r\n\t\t\tlet shouldTakeOwnership = (!ownerId || ownerId === event.detail.id) && this.syncSys.isMasterClient;\r\n\t\t\tif(shouldTakeOwnership)\r\n\t\t\t\tthis.takeOwnership();\r\n\t\t}).bind(this));\r\n\r\n\t\tif (this.data.mode === 'link') {\r\n\t\t\tlet id = this.el.id;\r\n\t\t\tif (!id) {\r\n\t\t\t\tconsole.error('Entities cannot be synced using link mode without an id.');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconsole.log('syncSys: ' + this.syncSys);\r\n\t\t\tconsole.log('syncSys.sceneRef: ' + this.syncSys.sceneRef);\r\n\r\n\t\t\tthis.link(this.syncSys.sceneRef.child(id));\r\n\t\t\tthis.setupReceive();\r\n\r\n\t\t} else {\r\n\t\t\tconsole.error('Unsupported sync mode: ' + this.data.mode);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.isConnected = true;\r\n\t\tthis.el.emit('connected', null, false);\r\n\t}\r\n\r\n\tlink(entityRef)\r\n\t{\r\n\t\tthis.ref = entityRef;\r\n\t\tthis.key = this.ref.key();\r\n\t\tthis.dataRef = this.ref.child('data');\r\n\t\tthis.ownerRef = this.ref.child('owner');\r\n\t}\r\n\r\n\tsetupReceive()\r\n\t{\r\n\t\t//if nobody has owned the object yet, we will.\r\n\t\tthis.ownerRef.transaction((owner => {\r\n\t\t\tif (owner) return undefined;\r\n\t\t\tthis.ownerRef.onDisconnect().set(null);\r\n\t\t\treturn this.syncSys.clientId;\r\n\t\t}).bind(this));\r\n\r\n\t\tthis.ownerRef.on('value', (snapshot =>\r\n\t\t{\r\n\t\t\tlet newOwnerId = snapshot.val();\r\n\t\t\tlet gained = newOwnerId === this.syncSys.clientId && !this.isMine;\r\n\t\t\tif (gained)\r\n\t\t\t\tthis.el.emit('ownershipgained', null, false);\r\n\r\n\t\t\t//note this also fires when we start up without ownership\r\n\t\t\tlet lost = newOwnerId !== this.syncSys.clientId && this.isMine;\r\n\t\t\tif (lost){\r\n\t\t\t\tthis.el.emit('ownershiplost', null, false);\r\n\r\n\t\t\t\t//we no longer have to clear our ownership when we disconnect\r\n\t\t\t\tthis.ownerRef.onDisconnect().cancel();\r\n\t\t\t}\r\n\r\n\t\t\tthis.ownerId = newOwnerId;\r\n\r\n\t\t\tthis.isMine = newOwnerId === this.syncSys.clientId;\r\n\t\t}).bind(this));\r\n\t}\r\n}\r\n","'use strict';\r\n\r\nimport {AFrameSystem} from './AFrameComponent';\r\n\r\n/**\r\n* Connect to a remote Firebase server, and facilitate synchronization. These\r\n* options correspond exactly with the configuration options for\r\n* [altspace.utilities.sync.connect]{@link http://altspacevr.github.io/AltspaceSDK/doc/module-altspace_utilities_sync.html#.connect}.\r\n* This component must be present on `a-scene` for any other sync components to work.\r\n* @extends AFrameSystem\r\n* @memberof module:altspace/components\r\n*/\r\nclass SyncSystem extends AFrameSystem\r\n{\r\n\t/**\r\n\t* @prop {string} author - A unique identifier for you or your organization.\r\n\t* @prop {string} app - The name of the app.\r\n\t* @prop {string} refUrl - Override the base reference. Set this to use your own Firebase.\r\n\t* @prop {string} instance - Override the instance ID. Can also be overridden with\r\n\t* a URL parameter.\r\n\t*/\r\n\tget schema(){\r\n\t\treturn {\r\n\t\t\tauthor: { type: 'string', default: null },\r\n\t\t\tapp: { type: 'string', default: null },\r\n\t\t\tinstance: { type: 'string', default: null },\r\n\t\t\trefUrl: { type: 'string', default: null }\r\n\t\t};\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tif(!this.data || !this.data.app){\r\n\t\t\tconsole.warn('The sync-system must be present on the scene and configured with required data.');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconsole.log(this.data);\r\n\r\n\t\tthis.isConnected = false;\r\n\t\taltspace.utilities.sync.connect({\r\n\t\t\tauthorId: this.data.author,\r\n\t\t\tappId: this.data.app,\r\n\t\t\tinstanceId: this.data.instance,\r\n\t\t\tbaseRefUrl: this.data.refUrl\r\n\t\t}).then(this.connected.bind(this));\r\n\t}\r\n\r\n\tconnected(connection)\r\n\t{\r\n\t\tthis.connection = connection;\r\n\r\n\t\tthis.sceneRef = this.connection.instance.child('scene');\r\n\t\tthis.clientsRef = this.connection.instance.child('clients');\r\n\r\n\t\t// temporary way of having unique identifiers for each client\r\n\t\tthis.clientId = this.sceneEl.object3D.uuid;\r\n\t\tthis.masterClientId = null;\r\n\r\n\t\tlet self = this;\r\n\r\n\t\t// local client connected\r\n\t\tthis.clientsRef.on(\"value\", snapshot => {\r\n\t\t\tlet clientIds = snapshot.val();\r\n\t\t\tlet masterClientKey = Object.keys(clientIds)[0];\r\n\t\t\tself.masterClientId = clientIds[masterClientKey];\r\n\t\t});\r\n\r\n\t\t// remote client connected\r\n\t\tthis.clientsRef.on('child_added', childSnapshot => {\r\n\t\t\tlet joinedClientId = childSnapshot.val();\r\n\t\t\t//let the master client flag get set first\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tself.sceneEl.emit('clientjoined', {id: joinedClientId}, false);\r\n\t\t\t}, 0);\r\n\t\t});\r\n\r\n\t\t// remote client disconnected\r\n\t\tthis.clientsRef.on('child_removed', childSnapshot => {\r\n\t\t\tlet leftClientId = childSnapshot.val();\r\n\t\t\t//let the master client flag get set first\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tself.sceneEl.emit('clientleft', {id: leftClientId}, false);\r\n\t\t\t}, 0);\r\n\t\t});\r\n\r\n\t\t// add our client ID to the list of connected clients,\r\n\t\t// but have it be automatically removed by firebase if we disconnect for any reason\r\n\t\tthis.clientsRef.push(this.clientId).onDisconnect().remove();\r\n\r\n\t\tthis.connection.instance.child('initialized').once('value', snapshot => {\r\n\t\t\tlet shouldInitialize = !snapshot.val();\r\n\t\t\tsnapshot.ref().set(true);\r\n\r\n\t\t\tself.sceneEl.emit('connected', { shouldInitialize: shouldInitialize }, false);\r\n\t\t\tself.isConnected = true;\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t* Returns true if the local client is the master client.\r\n\t*/\r\n\tisMasterClient()\r\n\t{\r\n\t\treturn this.masterClientId === this.clientId;\r\n\t}\r\n}\r\n\r\nexport default SyncSystem;\r\n","//TODO: We need to figure out a way to recieve our first update without caring about ownership.\r\n// firstValue is probably not the right way to go, probably something about having sent yet. Need to change for both\r\n\r\n/**\r\n* Synchronize the position, rotation, and scale of this object with all clients.\r\n* Requires both a {@link sync.sync-system} component on the `a-scene`, and a\r\n* {@link sync.sync} component on the target entity.\r\n* @mixin sync-transform\r\n* @memberof sync\r\n*/\r\nAFRAME.registerComponent('sync-transform',\r\n{\r\n\tdependencies: ['sync'],\r\n\tschema: {\r\n\t},\r\n\tinit: function () {\r\n\t\tvar component = this;\r\n\t\tvar sync = component.el.components.sync;\r\n\t\tif(sync.isConnected) start(); else component.el.addEventListener('connected', start);\r\n\r\n\t\tfunction start(){\r\n\r\n\t\t\tvar positionRef = sync.dataRef.child('position');\r\n\t\t\tvar rotationRef = sync.dataRef.child('rotation');\r\n\t\t\tvar scaleRef = sync.dataRef.child('scale');\r\n\r\n\t\t\tcomponent.updateRate = 100;\r\n\r\n\t\t\tvar stoppedAnimations = [];\r\n\t\t\t//pause all animations on ownership loss\r\n\t\t\tcomponent.el.addEventListener('ownershiplost', function() {\r\n\t\t\t\tvar children = component.el.children;\r\n\t\t\t\tfor (var i = 0; i < children.length; i++) {\r\n\t\t\t\t\tvar tagName = children[i].tagName.toLowerCase();\r\n\t\t\t\t\tif (tagName === \"a-animation\") {\r\n\t\t\t\t\t\tstoppedAnimations.push(children[i]);\r\n\t\t\t\t\t\tchildren[i].stop();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tcomponent.el.addEventListener('ownershipgained', function () {\r\n\t\t\t\tfor (var i = 0; i < stoppedAnimations.length; i++) {\r\n\t\t\t\t\tvar animation = stoppedAnimations[i];\r\n\t\t\t\t\tanimation.start();\r\n\t\t\t\t}\r\n\t\t\t\tstoppedAnimations = [];\r\n\t\t\t});\r\n\r\n\t\t\tfunction onTransform(snapshot, componentName) {\r\n\t\t\t\tif (sync.isMine) return;\r\n\r\n\t\t\t\tvar value = snapshot.val();\r\n\t\t\t\tif (!value) return;\r\n\r\n\t\t\t\tcomponent.el.setAttribute(componentName, value);\r\n\t\t\t}\r\n\r\n\t\t\tpositionRef.on('value', function (snapshot) {\r\n\t\t\t\tonTransform(snapshot, 'position');\r\n\t\t\t});\r\n\r\n\t\t\trotationRef.on('value', function (snapshot) {\r\n\t\t\t\tonTransform(snapshot, 'rotation');\r\n\t\t\t});\r\n\r\n\t\t\tscaleRef.on('value', function (snapshot) {\r\n\t\t\t\tonTransform(snapshot, 'scale');\r\n\t\t\t});\r\n\r\n\t\t\tvar sendPosition = throttle(function(value){\r\n\t\t\t\tpositionRef.set(value);\r\n\t\t\t}, component.updateRate);\r\n\r\n\t\t\tvar sendRotation = throttle(function(value){\r\n\t\t\t\trotationRef.set(value);\r\n\t\t\t}, component.updateRate);\r\n\r\n\t\t\tvar sendScale = throttle(function(value){\r\n\t\t\t\tscaleRef.set(value);\r\n\t\t\t}, component.updateRate);\r\n\r\n\t\t\tfunction onComponentChanged(event){\r\n\t\t\t\tif (!sync.isMine) return;\r\n\r\n\t\t\t\tvar name = event.detail.name;\r\n\t\t\t\tvar newData = event.detail.newData;\r\n\r\n\t\t\t\tif (name === 'position') {\r\n\t\t\t\t\tsendPosition(newData);\r\n\t\t\t\t} else if (name === 'rotation') {\r\n\t\t\t\t\tsendRotation(newData);\r\n\t\t\t\t} else if (name === 'scale') {\r\n\t\t\t\t\tsendScale(newData);\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//from underscore.js\r\n\t\t\tfunction throttle(func, wait, options) {\r\n\t\t\t\tvar timeout, context, args, result;\r\n\t\t\t\tvar previous = 0;\r\n\t\t\t\tif (!options) options = {};\r\n\r\n\t\t\t\tvar later = function() {\r\n\t\t\t\t  previous = options.leading === false ? 0 : Date.now();\r\n\t\t\t\t  timeout = null;\r\n\t\t\t\t  result = func.apply(context, args);\r\n\t\t\t\t  if (!timeout) context = args = null;\r\n\t\t\t\t};\r\n\r\n\t\t\t\tvar throttled = function() {\r\n\t\t\t\t  var now = Date.now();\r\n\t\t\t\t  if (!previous && options.leading === false) previous = now;\r\n\t\t\t\t  var remaining = wait - (now - previous);\r\n\t\t\t\t  context = this;\r\n\t\t\t\t  args = arguments;\r\n\t\t\t\t  if (remaining <= 0 || remaining > wait) {\r\n\t\t\t\t\tif (timeout) {\r\n\t\t\t\t\t  clearTimeout(timeout);\r\n\t\t\t\t\t  timeout = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tprevious = now;\r\n\t\t\t\t\tresult = func.apply(context, args);\r\n\t\t\t\t\tif (!timeout) context = args = null;\r\n\t\t\t\t  } else if (!timeout && options.trailing !== false) {\r\n\t\t\t\t\ttimeout = setTimeout(later, remaining);\r\n\t\t\t\t  }\r\n\t\t\t\t  return result;\r\n\t\t\t\t};\r\n\r\n\t\t\t\tthrottled.cancel = function() {\r\n\t\t\t\t  clearTimeout(timeout);\r\n\t\t\t\t  previous = 0;\r\n\t\t\t\t  timeout = context = args = null;\r\n\t\t\t\t};\r\n\r\n\t\t\t\treturn throttled;\r\n\t\t\t  };\r\n\r\n\r\n\t\t\tcomponent.el.addEventListener('componentchanged', onComponentChanged);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nexport default null;\r\n","/**\r\n* Synchronize the playback state of an {@link n.n-sound} component between clients.\r\n* Requires both a {@link sync.sync-system} component on the `a-scene`, and a\r\n* {@link sync.sync} component on the target entity.\r\n* @mixin sync-n-sound\r\n* @memberof sync\r\n*/\r\n'use strict';\r\n\r\nimport {AFrameComponent} from './AFrameComponent';\r\n\r\nexport default class SyncNSound extends AFrameComponent\r\n{\r\n\tget dependencies(){\r\n\t\treturn ['sync'];\r\n\t}\r\n}\r\n\r\nAFRAME.registerComponent('sync-n-sound',\r\n{\r\n\tdependencies: ['sync'],\r\n\tschema: { },\r\n\tinit: function () {\r\n\t\tvar component = this;\r\n\t\tvar sync = component.el.components.sync;\r\n\t\tvar scene = document.querySelector('a-scene');\r\n\t\tvar syncSys = scene.systems['sync-system'];\r\n\t\tif(sync.isConnected) start(); else component.el.addEventListener('connected', start);\r\n\r\n\t\tfunction start(){\r\n\t\t\tcomponent.soundStateRef = sync.dataRef.child('sound/state');\r\n\t\t\tcomponent.soundEventRef = sync.dataRef.child('sound/event');\r\n\r\n\t\t\tfunction sendEvent(event) {\r\n\t\t\t\tif (!sync.isMine) return;\r\n\t\t\t\tvar event = {\r\n\t\t\t\t\ttype: event.type,\r\n\t\t\t\t\tsender: syncSys.clientId,\r\n\t\t\t\t\tel: component.el.id,\r\n\t\t\t\t\ttime: Date.now()\r\n\t\t\t\t};\r\n\t\t\t\tcomponent.soundEventRef.set(event);\r\n\t\t\t}\r\n\r\n\t\t\tcomponent.el.addEventListener('sound-played', sendEvent);\r\n\t\t\tcomponent.el.addEventListener('sound-paused', sendEvent);\r\n\r\n\t\t\tcomponent.soundEventRef.on('value', function (snapshot) {\r\n\t\t\t\tif (sync.isMine) return;\r\n\t\t\t\tvar event = snapshot.val();\r\n\t\t\t\tif (!event) return;\r\n\t\t\t\tif (event.el === component.el.id) {\r\n\t\t\t\t\tvar sound = component.el.components['n-sound'];\r\n\t\t\t\t\tif (event.type === 'sound-played') {\r\n\t\t\t\t\t\tsound.playSound();\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tsound.pauseSound();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tcomponent.el.addEventListener('componentchanged', function (event) {\r\n\t\t\t\tif (!sync.isMine) return;\r\n\t\t\t\tvar name = event.detail.name;\r\n\t\t\t\tif (name !== 'n-sound') return;\r\n\t\t\t\tcomponent.soundStateRef.set(event.detail.newData);\r\n\t\t\t});\r\n\r\n\t\t\tcomponent.soundStateRef.on('value', function (snapshot) {\r\n\t\t\t\tif (sync.isMine) return;\r\n\t\t\t\tvar state = snapshot.val();\r\n\t\t\t\tif (!state) return;\r\n\t\t\t\tcomponent.el.setAttribute('n-sound', state);\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\tremove: function () {\r\n\t\tthis.soundStateRef.off('value');\r\n\t\tthis.soundEventRef.off('value');\r\n\t}\r\n});\r\n","\r\n/**\r\n* This set of components map to various objects and effects that are provided\r\n* natively by AltspaceVR. Your management of these objects may be limited to\r\n* some degree, but they will tend to be more performant than SDK equivalents,\r\n* or may provide some functionality not otherwise available to the SDK.\r\n* @namespace native\r\n*/\r\n(function () {\r\n\tif (!window.altspace || !altspace.inClient) {\r\n\t\tvar noop = function () {};\r\n\t\twindow.altspace = {\r\n\t\t\taddNativeComponent: noop,\r\n\t\t\tupdateNativeComponent: noop,\r\n\t\t\tremoveNativeComponent: noop\r\n\t\t};\r\n\t}\r\n\r\n\tvar placeholderGeometry = new THREE.BoxGeometry(0.001, 0.001, 0.001);\r\n\tvar placeholderMaterial = new THREE.MeshBasicMaterial({ color: 0x000000 });\r\n\tplaceholderMaterial.visible = false;\r\n\tvar PlaceholderMesh = function () {\r\n\t\tTHREE.Mesh.call( this, placeholderGeometry, placeholderMaterial );\r\n\t};\r\n\tPlaceholderMesh.prototype = Object.create( THREE.Mesh.prototype );\r\n\tPlaceholderMesh.prototype.constructor = THREE.PlaceholderMesh;\r\n\r\n\tfunction meshInit(mesh) {\r\n\t\t//If you attach native components to an entity, it will not use a default collider\r\n\t\tmesh.userData.altspace = mesh.userData.altspace || {};\r\n\t\tmesh.userData.altspace.collider = mesh.userData.altspace.collider || {};\r\n\t\tmesh.userData.altspace.collider.enabled = false;\r\n\r\n\t\taltspace.addNativeComponent(mesh, this.name);\r\n\t}\r\n\r\n\tfunction nativeComponentInit() {\r\n\t\tvar mesh = this.el.getOrCreateObject3D('mesh', PlaceholderMesh);\r\n\r\n\t\tmeshInit.call(this, mesh);\r\n\r\n\t\t//to pass defaults\r\n\t\tthis.update(this.data);\r\n\t}\r\n\tfunction nativeComponentRemove() {\r\n\t\tvar mesh = this.el.getObject3D('mesh');\r\n\t\taltspace.removeNativeComponent(mesh, this.name);\r\n\t}\r\n\tfunction nativeComponentUpdate(oldData) {\r\n\t\taltspace.updateNativeComponent(this.el.object3DMap.mesh, this.name, this.data);\r\n\t}\r\n\r\n\tfunction callComponent(functionName, functionArguments) {\r\n\t\taltspace.callNativeComponent(this.el.object3DMap.mesh, this.name, functionName, functionArguments)\r\n\t}\r\n\r\n\t/**\r\n\t* Attach a given native object to this entity.\r\n\t* @mixin n-object\r\n\t* @memberof native\r\n\t* @prop {string} res - The identifier for the resource you want. This component\r\n\t* can accept all resources except for `interactables`.\r\n\t* @example <a-entity n-object='res:architecture/wall-4w-4h'></a-entity>\r\n\t*/\r\n\tAFRAME.registerComponent('n-object', {\r\n\t\tschema: {\r\n\t\t\tres: {type: 'string'}\r\n\t\t},\r\n\t\tinit: nativeComponentInit,\r\n\t\tupdate: nativeComponentUpdate,\r\n\t\tremove: nativeComponentRemove\r\n\t});\r\n\r\n\t/**\r\n\t* Create an object that spawns additional copies of itself when grabbed by a user (the copies are not spawners themselves).\r\n\t* These copies will be physically interactive and automatically synchronized\r\n\t* between users.\r\n\t* @mixin n-spawner\r\n\t* @memberof native\r\n\t* @prop {string} res - The identifier for the resource you want. This component\r\n\t* can only accept resources of type `interactables`.\r\n\t* @example <a-entity n-spawner='res: interactables/basketball'></a-entity>\r\n\t*/\r\n\tAFRAME.registerComponent('n-spawner', {\r\n\t\tschema: {\r\n\t\t\tres: {type: 'string'}\r\n\t\t},\r\n\t\tinit: nativeComponentInit,\r\n\t\tupdate: nativeComponentUpdate,\r\n\t\tremove: nativeComponentRemove\r\n\t});\r\n\r\n\t/**\r\n\t* Creates dynamic 2D text on the entity. The text will wrap automatically based on the width and height provided.\r\n\t* This text will be clearer than texture-based text and more performant than geometry-based test.\r\n\t* @mixin n-text\r\n\t* @memberof native\r\n\t* @prop {string} text - The text to be drawn.\r\n\t* @prop {number} fontSize=10 - The height of the letters. 10pt ~= 1m\r\n\t* @prop {number} width=10 - The width of the text area in meters. If the\r\n\t* text is wider than this value, the overflow will be wrapped to the next line.\r\n\t* @prop {number} height=1 - The height of the text area in meters. If the\r\n\t* text is taller than this value, the overflow will be cut off.\r\n\t* @prop {string} horizontalAlign=middle - The horizontal anchor point for\r\n\t* the text. Can be `left`, `middle`, or `right`.\r\n\t* @prop {string} verticalAlign=middle - The vertical anchor point for the\r\n\t* text. Can be `top`, `middle`, or `bottom`.\r\n\t*/\r\n\tAFRAME.registerComponent('n-text', {\r\n\t\tinit: nativeComponentInit,\r\n\t\tupdate: nativeComponentUpdate,\r\n\t\tremove: nativeComponentRemove,\r\n\t\tschema: {\r\n\t\t\ttext: { default: '', type: 'string' },\r\n\t\t\t/*color: { default: 'white',\r\n\t\t\t\tparse: function(value) {\r\n\t\t\t\t\treturn parseFloat(value, 10);\r\n\t\t\t\t},\r\n\t\t\t\tstringify: function(value) {\r\n\t\t\t\t\treturn value.toString();\r\n\t\t\t\t}},*/\r\n\t\t\tfontSize: { default: '10', type: 'int' },//roughly a meter tall\r\n\t\t\twidth: { default: '10', type: 'number' },//in meters\r\n\t\t\theight: { default: '1', type: 'number' },//in meters\r\n\t\t\thorizontalAlign: { default: 'middle'},\r\n\t\t\tverticalAlign: { default: 'middle'}\r\n\t\t}\r\n\t});\r\n\r\n\t//object: collides against: objects / enviroment / cursor\r\n\t//environment: can be teleported onto, and collides against: objects / environment / cursor\r\n\t//hologram: collides against: cursor / holograms\r\n\r\n\t/**\r\n\t* Abstract base class for {@link n.n-sphere-collider}, {@link n.n-box-collider},\r\n\t* {@link n.n-capsule-collider}, and {@link n.n-mesh-collider}. You cannot use\r\n\t* this class directly, but instead you should add one of those components\r\n\t* to your objects.\r\n\t* @name n-collider\r\n\t* @mixin n-collider\r\n\t* @memberof native\r\n\t* @prop {vec3} center=0,0,0 - The offset of the collider in local space.\r\n\t* @prop {string} type=hologram - The type of collider, one of: `object` | `environment` | `hologram`.\r\n\t* Object colliders collide with other objects, the environment, and the cursor.\r\n\t* Environment colliders collide with everything objects do, but you can also\r\n\t* teleport onto them. Hologram colliders only collide with other holograms and\r\n\t* the cursor.\r\n\t*/\r\n\r\n\t/**\r\n\t* Create a spherical collider on this entity.\r\n\t* @mixin n-sphere-collider\r\n\t* @memberof native\r\n\t* @extends native.n-collider\r\n\t* @prop {number} radius=1 - The size of the collider in meters.\r\n\t*/\r\n\tAFRAME.registerComponent('n-sphere-collider', {\r\n\t\tinit:nativeComponentInit,\r\n\t\tremove: nativeComponentRemove,\r\n\t\tupdate: nativeComponentUpdate,\r\n\t\tschema: {\r\n\t\t\tisTrigger: { default: false, type: 'boolean' },\r\n\t\t\tcenter: { type: 'vec3' },\r\n\t\t\tradius: { default: '0', type: 'number' },\r\n\t\t\ttype: {default: 'object'}\r\n\t\t}\r\n\t});\r\n\r\n\r\n\t/**\r\n\t* Create a box-shaped collider on this entity.\r\n\t* @mixin n-box-collider\r\n\t* @memberof native\r\n\t* @extends native.n-collider\r\n\t* @prop {vec3} size=1,1,1 - The dimensions of the collider.\r\n\t*/\r\n\tAFRAME.registerComponent('n-box-collider', {\r\n\t\tinit:nativeComponentInit,\r\n\t\tremove: nativeComponentRemove,\r\n\t\tupdate: nativeComponentUpdate,\r\n\t\tschema: {\r\n\t\t\tisTrigger: { default: false, type: 'boolean' },\r\n\t\t\tcenter: { type: 'vec3' },\r\n\t\t\tsize: { type: 'vec3' },\r\n\t\t\ttype: {default: 'object'}\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t* Create a capsule-shaped collider on this entity. Capsules\r\n\t* are a union of a cylinder and two spheres on top and bottom.\r\n\t* @mixin n-capsule-collider\r\n\t* @memberof native\r\n\t* @extends native.n-collider\r\n\t* @prop {number} radius=1 - The radius of the capsule in meters.\r\n\t* @prop {number} height=1 - The height of the shaft of the capsule in meters.\r\n\t* @prop {string} direction=y - The axis with which the capsule is aligned.\r\n\t* One of `x`, `y`, or `z`.\r\n\t*/\r\n\tAFRAME.registerComponent('n-capsule-collider', {\r\n\t\tinit:nativeComponentInit,\r\n\t\tremove: nativeComponentRemove,\r\n\t\tupdate: nativeComponentUpdate,\r\n\t\tschema: {\r\n\t\t\tisTrigger: { default: false, type: 'boolean' },\r\n\t\t\tcenter: { type: 'vec3' },\r\n\t\t\tradius: { default: '0', type: 'number' },\r\n\t\t\theight: { default: '0', type: 'number' },\r\n\t\t\tdirection: { default: 'y' },\r\n\t\t\ttype: {default: 'object'}\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t* Enable collision for the entire attached mesh. This is expensive to evaluate, so should only be used on\r\n\t* low-poly meshes.\r\n\t* @mixin n-mesh-collider\r\n\t* @memberof native\r\n\t* @extends native.n-collider\r\n\t* @example <a-box n-mesh-collider></a-box>\r\n\t* @prop {bool} convex=true - Whether the collider should be convex or concave. Set this to false if you have holes\r\n\t* in your mesh. Convex colliders are limited to 255 triangles. Note: concave colliders can be significantly more\r\n\t* expensive comparet to conves colliders.\r\n\t*/\r\n\tAFRAME.registerComponent('n-mesh-collider', {\r\n\t\t_forEachMesh: function (func) {\r\n\t\t\tvar obj = this.el.object3DMap.mesh;\r\n\t\t\tif (!obj) { return; }\r\n\t\t\tif (obj instanceof THREE.Mesh) {\r\n\t\t\t\tfunc(obj);\r\n\t\t\t}\r\n\t\t\tobj.traverse(function (childObj) {\r\n\t\t\t\tif (childObj instanceof THREE.Mesh) {\r\n\t\t\t\t\tfunc(childObj);\r\n\t\t\t\t}\r\n\t\t\t}.bind(this));\r\n\t\t},\r\n\t\t_initObj: function () {\r\n\t\t\tthis._forEachMesh(function (mesh) {\r\n\t\t\t\tmeshInit.call(this, mesh);\r\n\r\n\t\t\t\t//to pass defaults\r\n\t\t\t\taltspace.updateNativeComponent(mesh, this.name, this.data);\r\n\t\t\t}.bind(this));\r\n\t\t},\r\n\t\tinit: function () {\r\n\t\t\t// Allow a-frame to create a PlaceholderMesh if there isn't already one, so that the native collider is\r\n\t\t\t// registered.\r\n\t\t\tthis.el.getOrCreateObject3D('mesh', PlaceholderMesh);\r\n\r\n\t\t\t// Initialize the existing mesh\r\n\t\t\tthis._initObj();\r\n\r\n\t\t\tthis.el.addEventListener('model-loaded', function () {\r\n\t\t\t\t// Re-initialize the collider if a new model is loaded\r\n\t\t\t\tthis._initObj();\r\n\t\t\t}.bind(this));\r\n\t\t},\r\n\t\tremove: function () {\r\n\t\t\tthis._forEachMesh(function (mesh) {\r\n\t\t\t\taltspace.removeNativeComponent(mesh, this.name);\r\n\t\t\t}.bind(this));\r\n\t\t},\r\n\t\tupdate: function (oldData) {\r\n\t\t\tthis._forEachMesh(function (mesh) {\r\n\t\t\t\taltspace.updateNativeComponent(mesh, this.name, this.data);\r\n\t\t\t}.bind(this));\r\n\t\t},\r\n\t\tschema: {\r\n\t\t\tisTrigger: { default: false, type: 'boolean' },\r\n\t\t\tconvex: { default: true, type: 'boolean' },\r\n\t\t\ttype: {default: 'object'}\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t* Make the object's +Z always face the viewer. Currently will only directly apply to main mesh or native component on the attached entity, not any children or submeshes.\r\n\t* @mixin n-billboard\r\n\t* @memberof native\r\n\t* @example <a-plane n-billboard></a-plane>\r\n\t*/\r\n\tAFRAME.registerComponent('n-billboard', {\r\n\t\tinit:nativeComponentInit,\r\n\t\tremove: nativeComponentRemove,\r\n\t});\r\n\r\n\t/**\r\n\t* A container keeps a running tally of how many objects are within\r\n\t* its bounds, and adds and removes the states `container-full` and\r\n\t* `container-empty` based on the current count of objects. Can fire three\r\n\t* special events: `container-full`, `container-empty`, and `container-count-changed`.\r\n\t* @mixin n-container\r\n\t* @memberof native\r\n\t* @prop {number} capacity=4 - The value at which the container will fire the\r\n\t* `container-full` event.\r\n\t*/\r\n\tAFRAME.registerComponent('n-container', {\r\n\t\tinit: function(){\r\n\t\t\tnativeComponentInit.call(this);\r\n\r\n\t\t\tvar el = this.el;\r\n\t\t\tvar component = this;\r\n\r\n\t\t\tel.addEventListener('stateadded', function(event){\r\n\t\t\t\tif(event.detail.state === 'container-full'){\r\n\t\t\t\t\tel.emit('container-full');\r\n\t\t\t\t}\r\n\t\t\t\tif(event.detail.state === 'container-empty'){\r\n\t\t\t\t\tel.emit('container-empty');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tel.addEventListener('container-count-changed', function(event){\r\n\t\t\t\tcomponent.count = event.detail.count;\r\n\t\t\t});\r\n\t\t},\r\n\t\tremove: nativeComponentRemove,\r\n\t\tupdate: nativeComponentUpdate,\r\n\t\tschema: {\r\n\t\t\tcapacity: { default: 4, type: 'number' },\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t* Play the sound given by the `src` or `res` property from the location\r\n\t* of the entity.\r\n\t* @mixin n-sound\r\n\t* @memberof native\r\n\t* @prop {string} res - The resource identifier for a built-in sound clip.\r\n\t* @prop {string} src - A URL to an external sound clip. The sound can be in WAV, OGG or MP3 format. However. only\r\n\t* WAV is supported on all platforms. MP3 is supported on Gear VR and OGG is supported on desktop.\r\n\t* @prop {string} on - The name of the event that will play this sound clip.\r\n\t* @prop {boolean} loop=false - Tells the clip to loop back to the beginning of the clip\r\n\t* once it's finished.\r\n\t* @prop {boolean} autoplay=false - Tells the clip to start automatically when\r\n\t* the scene loads, instead of waiting for `playSound()`.\r\n\t* @prop {boolean} oneshot=false - Tells the clip to clean itself up when it\r\n\t* finishes playing. Allows for overlapping instances of the sound.\r\n\t* @prop {number} volume=1 - The volume of the clip, from [0,1].\r\n\t* @prop {number} spatialBlend=1 - How spatialized a sound is, from [0,1].\r\n\t* A value of 1 will be fully localized, and the sound will pan left and\r\n\t* right as you turn your head. A value of 0 makes it non-spatialized, and\r\n\t* it will always be heard in both ears.\r\n\t* @prop {number} pitch=1 - The speed multiplier for the sound. 0.5 is one\r\n\t* octave down, and 2 is one octave up.\r\n\t* @prop {number} minDistance=1 - Inside this distance in meters,\r\n\t* the sound volume is at full volume.\r\n\t* @prop {number} maxDistance=12 - If rolloff is 'logarithmic', the sound will stop attenuating at this distance.\r\n\t* If rolloff is 'linear' or 'cosine', the sound will be silent at this distance.\r\n\t* @prop {string} rolloff='logarithmic' - Set this to 'linear' or 'cosine' if you want to cut sounds off at a\r\n\t* maxDistance.\r\n\t*/\r\n\t/**\r\n\t* Fired when a sound has loaded and is ready to be played\r\n\t* @event native.n-sound#n-sound-loaded\r\n\t*/\r\n\tAFRAME.registerComponent('n-sound', {\r\n\t\tinit: function () {\r\n\t\t\tvar src = this.data.src;\r\n\t\t\tif (src && !src.startsWith('http')) {\r\n\t\t\t\tif (src.startsWith('/')) {\r\n\t\t\t\t\tthis.data.src = location.origin + src;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tvar currPath = location.pathname;\r\n\t\t\t\t\tif (!currPath.endsWith('/')) {\r\n\t\t\t\t\t\tcurrPath = location.pathname.split('/').slice(0, -1).join('/') + '/';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.data.src = location.origin + currPath + src;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tnativeComponentInit.call(this);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t* Stop the playing sound, and preserve position in clip.\r\n\t\t* @method native.n-sound#pauseSound\r\n\t\t*/\r\n\t\tpauseSound: function () {\r\n\t\t\tcallComponent.call(this, 'pause');\r\n\t\t\tthis.el.emit('sound-paused');\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t* Start the sound playing.\r\n\t\t* @method native.n-sound#playSound\r\n\t\t*/\r\n\t\tplaySound: function () {\r\n\t\t\tcallComponent.call(this, 'play');\r\n\t\t\tthis.el.emit('sound-played');\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t* Jump to a position in the clip.\r\n\t\t* @method native.n-sound#seek\r\n\t\t* @param {number} time - The time in milliseconds to jump to.\r\n\t\t*/\r\n\t\tseek: function (time) {\r\n\t\t\tcallComponent.call(this, 'seek', {time: time});\r\n\t\t},\r\n\t\tremove: function () {\r\n\t\t\tnativeComponentRemove.call(this);\r\n\t\t\tif (this.playHandler) {\r\n\t\t\t  this.el.removeEventListener(oldData.on, this.playHandler);\r\n\t\t\t}\r\n\t\t},\r\n\t\tupdate: function (oldData) {\r\n\t\t\tnativeComponentUpdate.call(this, oldData);\r\n\t\t\tif (this.playHandler) {\r\n\t\t\t  this.el.removeEventListener(oldData.on, this.playHandler);\r\n\t\t\t}\r\n\t\t\tif (this.data.on) {\r\n\t\t\t  this.playHandler = this.playSound.bind(this);\r\n\t\t\t  this.el.addEventListener(this.data.on, this.playHandler);\r\n\t\t\t}\r\n\t\t},\r\n\t\tschema: {\r\n\t\t\ton: { type: 'string' },\r\n\t\t\tres: { type: 'string' },\r\n\t\t\tsrc: { type: 'string' },\r\n\t\t\tloop: { type: 'boolean' },\r\n\t\t\tvolume: { type: 'number', default: 1 },\r\n\t\t\tautoplay: { type: 'boolean' },\r\n\t\t\toneshot: { type: 'boolean' },\r\n\t\t\tspatialBlend: { type: 'float', default: 1 },\r\n\t\t\tpitch: { type: 'float', default: 1 },\r\n\t\t\tminDistance: { type: 'float', default: 1 },\r\n\t\t\tmaxDistance: { type: 'float', default: 12 },\r\n\t\t\trolloff: { type: 'string', default: 'logarithmic' },\r\n\t\t}\r\n\t});\r\n\r\n})();\r\n\r\nexport default null;\r\n","/**\r\n * The wire component allows you to trigger an event on another entity when an event occurs on an entity\r\n * @mixin wire\r\n * @property {string} on Name of an event to listen to\r\n * @property {string} gained Name of a state to watch for\r\n * @property {string} lost Name of a state to watch for\r\n * @property {string} emit Name of an event to trigger on the targets\r\n * @property {string} gain Name of a state to add on the target\r\n * @property {string} lose Name of a state to remove on the target\r\n * @property {selector} targets A selector to pick which objects to wire to\r\n * @property {selector} target - A selector to pick a single object to wire to\r\n **/\r\nAFRAME.registerComponent('wire',\r\n{\r\n\tmultiple: true,\r\n\tschema: {\r\n\t\ton: {type: 'string'},\r\n\t\temit: {type: 'string'},\r\n\t\tgained: {type: 'string'},\r\n\t\tlost: {type: 'string'},\r\n\t\tgain: {type: 'string'},\r\n\t\tlose: {type: 'string'},\r\n\t\ttargets: {type: 'selectorAll'},\r\n\t\ttarget: {type: 'selector'}\r\n\t},\r\n\tupdate: function (oldData) {\r\n\t\tif (oldData.on) {\r\n\t\t\tthis.el.removeEventListener(oldData.on, this.actOnTargets);\r\n\t\t}\r\n\t\tif (oldData.gained) {\r\n\t\t\tthis.el.removeEventListener('stateadded', this.actOnTargetsIfStateMatches);\r\n\t\t}\r\n\t\tif (oldData.lost) {\r\n\t\t\tthis.el.removeEventListener('stateremoved', this.actOnTargetsIfStateMatches);\r\n\t\t}\r\n\r\n\t\tthis.actOnTargets = function () {\r\n\t\t\tfunction act(el) {\r\n\t\t\t\tif (this.data.emit) {\r\n\t\t\t\t\tel.emit(this.data.emit);\r\n\t\t\t\t}\r\n\t\t\t\tif (this.data.gain) {\r\n\t\t\t\t\tel.addState(this.data.gain);\r\n\t\t\t\t}\r\n\t\t\t\tif (this.data.lose) {\r\n\t\t\t\t\tel.removeState(this.data.lose);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(this.data.targets) this.data.targets.forEach(act.bind(this));\r\n\t\t\tif(this.data.target) act.call(this, this.data.target);\r\n\t\t}.bind(this);\r\n\r\n\t\tthis.actOnTargetsIfStateMatches = function (event) {\r\n\t\t\tvar state = event.detail.state;\r\n\t\t\tif (state === this.data.gained || state === this.data.lost) {\r\n\t\t\t\tthis.actOnTargets();\r\n\t\t\t}\r\n\t\t}.bind(this);\r\n\r\n\t\tif (this.data.on) {\r\n\t\t\tthis.el.addEventListener(this.data.on, this.actOnTargets);\r\n\t\t}\r\n\t\tif (this.data.gained) {\r\n\t\t\tthis.el.addEventListener('stateadded', this.actOnTargetsIfStateMatches);\r\n\t\t}\r\n\t\tif (this.data.lost) {\r\n\t\t\tthis.el.addEventListener('stateremoved', this.actOnTargetsIfStateMatches);\r\n\t\t}\r\n\t},\r\n\tremove: function () {\r\n\t\tthis.el.removeEventListener(this.data.on, this.actOnTargets);\r\n\t\tthis.el.removeEventListener('stateadded', this.actOnTargetsIfStateMatches);\r\n\t\tthis.el.removeEventListener('stateremoved', this.actOnTargetsIfStateMatches);\r\n\t}\r\n});\r\n\r\nexport default null;\r\n","/**\r\n* @module altspace/components\r\n*/\r\n\r\n'use strict';\r\n\r\nimport {registerComponentClass, registerSystemClass, flatten} from './AFrameComponent';\r\nimport AltspaceCursorCollider from './AltspaceCursorCollider';\r\nimport AltspaceTrackedControls from './AltspaceTrackedControls';\r\nimport AltspaceComponent from './AltspaceComponent';\r\nimport SyncColor from './SyncColor';\r\nimport SyncComponent from './SyncComponent';\r\nimport SyncSystem from './SyncSystem';\r\nimport SyncTransform from './sync-transform';\r\nimport SyncNSound from './sync-n-sound';\r\nimport NativeComponents from './native-components';\r\nimport Wire from './wire';\r\n\r\n// TODO: finish porting aframe components to es6\r\nif (window.AFRAME)\r\n{\r\n    /**\r\n    * @mixin sync-system\r\n    * @memberof module:altspace/components\r\n    * @see {@link module:altspace/components.SyncSystem}\r\n    */\r\n    registerSystemClass('sync-system', SyncSystem);\r\n\r\n    registerComponentClass('altspace-cursor-collider', AltspaceCursorCollider);\r\n    registerComponentClass('altspace-tracked-controls', AltspaceTrackedControls);\r\n    registerComponentClass('altspace', AltspaceComponent);\r\n    registerComponentClass('sync-color', SyncColor);\r\n    registerComponentClass('sync', SyncComponent);\r\n\r\n}\r\n\r\nexport {AltspaceComponent, AltspaceCursorCollider, AltspaceTrackedControls, SyncSystem, SyncComponent, SyncColor, flatten };\r\n","window.altspace = window.altspace || {};\r\nwindow.altspace.utilities = window.altspace.utilities || {};\r\n\r\nimport * as CursorShim from './shims/cursor';\r\n\r\n/**\r\n* @module altspace/utilities\r\n*/\r\n\r\n/**\r\n* Simulation is a helper class that lets you quickly setup a three.js app with support for AltspaceVR. It creates a basic scene for you and starts the render and behavior loop.\r\n*\r\n* If all of your application logic is in behaviors, you do not need to create any additional requestAnimationFrame loops.\r\n*\r\n* It also automatically uses the WebGL renderer when running in a\r\n* desktop browser and emulates cursor events with mouse clicks.\r\n* @class Simulation\r\n* @param {Object} [config] Optional parameters.\r\n* @param {Boolean} [config.auto=true] Automatically start the render loop.\r\n* @memberof module:altspace/utilities\r\n*/\r\nclass Simulation\r\n{\r\n\tconstructor({auto = true})\r\n\t{\r\n\t\tthis._scene = null;\r\n\t\tthis._renderer = null;\r\n\t\tthis._camera = null;\r\n\r\n\t\tlet usingAFrame = window.AFRAME && document.querySelector('a-scene');\r\n\r\n\t\tif(usingAFrame)\r\n\t\t{\r\n\t\t\tlet ascene = document.querySelector('a-scene');\r\n\t\t\tthis._scene = ascene.object3D;\r\n\t\t\tthis._renderer = ascene.renderer;\r\n\r\n\t\t\tlet acamera = document.querySelector('a-camera');\r\n\t\t\tif(acamera)\r\n\t\t\t\tthis._camera = acamera.object3D;\r\n\t\t}\r\n\t\telse if (window.altspace && altspace.inClient)\r\n\t\t{\r\n\t\t\tthis._scene = new THREE.Scene();\r\n\t\t\tthis._renderer = altspace.getThreeJSRenderer();\r\n\t\t\tthis._camera = new THREE.PerspectiveCamera(); // TODO: change from shim to symbolic\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._setupWebGL();\r\n\t\t}\r\n\r\n\t\tif(auto && !usingAFrame)\r\n\t\t\tthis.loop();\r\n\t}\r\n\r\n\t_setupWebGL()\r\n\t{\r\n\t\tlet scene = this._scene = new THREE.Scene();\r\n\t\tlet renderer = this._renderer = new THREE.WebGLRenderer({antialias: true});\r\n\t\tlet camera = this._camera = new THREE.PerspectiveCamera();\r\n\r\n\t\tdocument.addEventListener(\"DOMContentLoaded\", event => {\r\n\t\t\tdocument.body.style.margin = '0px';\r\n\t\t\tdocument.body.style.overflow = 'hidden';\r\n\t\t\trenderer.setClearColor('#035F72');\r\n\t\t\tlet container = document.createElement('div');\r\n\t\t\tdocument.body.appendChild(container);\r\n\t\t\tcontainer.appendChild(renderer.domElement);\r\n\t\t});\r\n\r\n\t\tfunction resizeRender(){\r\n\t\t\tcamera.aspect = window.innerWidth / window.innerHeight;\r\n\t\t\tcamera.updateProjectionMatrix();\r\n\t\t\trenderer.setSize(window.innerWidth, window.innerHeight);\r\n\t\t}\r\n\t\twindow.addEventListener('resize', resizeRender);\r\n\t\tresizeRender();\r\n\r\n\t\tcamera.position.z = 500;\r\n\t\tcamera.fov = 45;\r\n\t\tcamera.near = 1;\r\n\t\tcamera.far = 2000;\r\n\t\tscene.add(camera);\r\n\t\tscene.add(new THREE.AmbientLight('white'));\r\n\r\n\t\t// shim cursor\r\n\t\tthis.cursor = CursorShim.init(scene, camera);\r\n\t}\r\n\r\n\t/**\r\n\t* Begin the simulation. This loop is begun automatically by default.\r\n\t*/\r\n\tloop()\r\n\t{\r\n\t\twindow.requestAnimationFrame(this.loop.bind(this));\r\n\r\n\t\tif(this.scene.updateAllBehaviors)\r\n\t\t\tthis.scene.updateAllBehaviors();\r\n\r\n\t\tthis.renderer.render(this.scene, this.camera);\r\n\t}\r\n\r\n\t/**\r\n\t* The simulation scene.\r\n\t* @readonly\r\n\t* @instance\r\n\t* @member {THREE.Scene} scene\r\n\t* @memberof module:altspace/utilities.Simulation\r\n\t*/\r\n\tget scene(){ return this._scene; }\r\n\r\n\t/**\r\n\t* The renderer being used.\r\n\t* @readonly\r\n\t* @instance\r\n\t* @member {(THREE.WebGLRenderer|AltRenderer)} renderer\r\n\t* @memberof module:altspace/utilities.Simulation\r\n\t*/\r\n\tget renderer(){ return this._renderer; }\r\n\r\n\t/**\r\n\t* The camera being used by the WebGL renderer.\r\n\t* @readonly\r\n\t* @instance\r\n\t* @member {Three.Camera} camera\r\n\t* @memberof module:altspace/utilities.Simulation\r\n\t*/\r\n\tget camera(){ return this._camera; }\r\n\r\n}\r\n\r\nexport default Simulation;\r\n","'use strict';\r\n\r\n/**\r\n* Load an OBJ file and its material definition in one pass.\r\n* @class OBJMTLLoader\r\n* @memberof module:altspace/utilities/shims\r\n*/\r\nclass OBJMTLLoader\r\n{\r\n    /**\r\n    * A function that's passed the result of the OBJMTLLoader.\r\n    * @callback module:altspace/utilities/shims.OBJMTLLoader~LoaderCallback\r\n    * @param {Object3D} object - The loaded object\r\n    */\r\n\r\n    /**\r\n    * Begin loading the definition files.\r\n    * @method load\r\n    * @memberof module:altspace/utilities/shims.OBJMTLLoader\r\n    * @static\r\n    * @param {string} objFile - The URL to the OBJ file\r\n    * @param {string} mtlFile - The URL to the MTL file\r\n    * @param {LoaderCallback} callback - The function called when loading is complete\r\n    */\r\n    load (objFile, mtlFile, callback)\r\n    {\r\n        var mtlLoader = new THREE.MTLLoader()\r\n        var baseUrl = mtlFile.split('/').slice(0, -1).join('/');\r\n        mtlLoader.setBaseUrl(baseUrl + '/');\r\n        mtlLoader.setCrossOrigin(this.crossOrigin);\r\n        mtlLoader.load(mtlFile, function (materials) {\r\n            var objLoader = new THREE.OBJLoader();\r\n            objLoader.setMaterials(materials);\r\n            objLoader.load(objFile, callback);\r\n        });\r\n    }\r\n}\r\n\r\nexport default OBJMTLLoader;\r\n","/**\r\n* @author gavanwilhite / http://gavanwilhite.com\r\n*/\r\n\r\n/**\r\n* The AltspaceDK includes a Behaviors shim that adds Behavior capabilities to\r\n* Three.js.\r\n* It adds methods to Three.js' Scene and Object3D classes which allow you to\r\n* add, remove, retrieve and use Behaviors.\r\n*\r\n* @namespace THREE\r\n*/\r\n\r\n/**\r\n* The AltspaceSDK adds Behavior capabilites to Three.js' Scene class.\r\n* @class Scene\r\n* @memberof THREE\r\n*/\r\n\r\n/**\r\n* Update the behaviors of all the objects in this Scene.\r\n* @instance\r\n* @method updateAllBehaviors\r\n* @memberof THREE.Scene\r\n*/\r\nTHREE.Scene.prototype.updateAllBehaviors = function () {\r\n\r\n\tvar now = performance.now();\r\n\tvar lastNow = this.__lastNow || now;\r\n\r\n\tvar deltaTime = now - lastNow;\r\n\r\n\tvar self = this;\r\n\r\n\t//gather objects first so that behaviors can change the hierarchy during traversal without incident\r\n\tvar objectsWithBehaviors = [];\r\n\r\n\tthis.traverse(function (object3d) {\r\n\r\n\t\tif (object3d.__behaviorList) {\r\n\t\t\tobjectsWithBehaviors.push(object3d);\r\n\t\t}\r\n\r\n\t});\r\n\r\n\tfor (var i = 0, max = objectsWithBehaviors.length; i < max; i++) {\r\n\t\tvar object3d = objectsWithBehaviors[i];\r\n\t\tobject3d.updateBehaviors(deltaTime, self);\r\n\t}\r\n\r\n\tthis.__lastNow = now;\r\n\r\n}\r\n\r\n/**\r\n* The AltspaceSDK adds Behavior capabilites to Three.js' Object3D class.\r\n* @class Object3D\r\n* @memberof THREE\r\n*/\r\n\r\n/**\r\n* Adds the given behavior to this object.\r\n* @instance\r\n* @method addBehavior\r\n* @param {Behavior} behavior Behavior to add.\r\n* @memberof THREE.Object3D\r\n*/\r\nTHREE.Object3D.prototype.addBehavior = function()\r\n{\r\n\tthis.__behaviorList = this.__behaviorList || [];\r\n\tArray.prototype.push.apply(this.__behaviorList, arguments);\r\n}\r\n\r\n/**\r\n* Adds the given behaviors to this object.\r\n* @instance\r\n* @method addBehaviors\r\n* @param {...Behavior} behavior Behavior to add.\r\n* @memberof THREE.Object3D\r\n*/\r\nTHREE.Object3D.prototype.addBehaviors = function()\r\n{\r\n\tthis.__behaviorList = this.__behaviorList || [];\r\n\tArray.prototype.push.apply(this.__behaviorList, arguments);\r\n}\r\n\r\n/**\r\n* Removes the given behavior from this object. The behavior is disposed if\r\n* possible.\r\n* @instance\r\n* @method removeBehavior\r\n* @param {...Behavior} behavior Behavior to remove.\r\n* @memberof THREE.Object3D\r\n*/\r\nTHREE.Object3D.prototype.removeBehavior = function(behavior)\r\n{\r\n\tif (!this.__behaviorList || this.__behaviorList.length === 0) return null;\r\n\r\n\tvar i = this.__behaviorList.indexOf(behavior);\r\n\tif (i !== -1) {\r\n\t\tthis.__behaviorList.splice(i, 1);\r\n\t\ttry {\r\n\r\n\t\t\tif (behavior.dispose) behavior.dispose.call(behavior, this);\r\n\r\n\t\t} catch (error) {\r\n\r\n\t\t\tconsole.group();\r\n\t\t\t(console.error || console.log).call(console, error.stack || error);\r\n\t\t\tconsole.log('[Behavior]');\r\n\t\t\tconsole.log(behavior);\r\n\t\t\tconsole.log('[Object3D]');\r\n\t\t\tconsole.log(this);\r\n\t\t\tconsole.groupEnd();\r\n\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n* Removes all behaviors from this object. The behaviors are disposed if\r\n* possible.\r\n* @instance\r\n* @method removeAllBehaviors\r\n* @memberof THREE.Object3D\r\n*/\r\nTHREE.Object3D.prototype.removeAllBehaviors = function ()\r\n{\r\n\tif (!this.__behaviorList || this.__behaviorList.length === 0) return null;\r\n\r\n\tfor (var i = 0, max = this.__behaviorList.length; i < max; i++) {\r\n\t\tvar behavior = this.__behaviorList[i];\r\n\r\n\t\ttry {\r\n\r\n\t\t\tif (behavior.dispose) behavior.dispose.call(behavior, this);\r\n\r\n\t\t} catch (error) {\r\n\r\n\t\t\tconsole.group();\r\n\t\t\t(console.error || console.log).call(console, error.stack || error);\r\n\t\t\tconsole.log('[Behavior]');\r\n\t\t\tconsole.log(behavior);\r\n\t\t\tconsole.log('[Object3D]');\r\n\t\t\tconsole.log(this);\r\n\t\t\tconsole.groupEnd();\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tthis.__behaviorList.length = 0;\r\n}\r\n\r\n/**\r\n* Retrieve a behavior by type.\r\n* @instance\r\n* @method getBehaviorByType\r\n* @param {String} type\r\n* @returns {Behavior}\r\n* @memberof THREE.Object3D\r\n*/\r\nTHREE.Object3D.prototype.getBehaviorByType = function(type) {\r\n\tif (!this.__behaviorList || this.__behaviorList.length === 0) return null;\r\n\r\n\tfor (var i = 0, max = this.__behaviorList.length; i < max; i++) {\r\n\t\tif (this.__behaviorList[i].type === type)\r\n\t\t\treturn this.__behaviorList[i];\r\n\t}\r\n}\r\n\r\n/**\r\n* Update behaviors on this object.\r\n* @instance\r\n* @method updateBehaviors\r\n* @param {Number} deltaTime Elapsed time in milliseconds\r\n* @memberof THREE.Object3D\r\n*/\r\nTHREE.Object3D.prototype.updateBehaviors = function(deltaTime, scene) {\r\n\r\n\tif (!this.__behaviorList || this.__behaviorList.length === 0) return;\r\n\r\n\tvar toInit = [];\r\n\tvar toUpdate = this.__behaviorList.slice(); // prevent mutation of the behavior list during this loop\r\n\r\n\tfor (var i = 0, max = this.__behaviorList.length; i < max; i++) {\r\n\r\n\t\tvar behavior = this.__behaviorList[i];\r\n\t\tif (!behavior.__isInitialized) toInit.push(behavior);\r\n\r\n\t}\r\n\r\n\t//Awake\r\n\tfor (var i = 0, max = toInit.length; i < max; i++) {\r\n\r\n\t\tvar behavior = toInit[i];\r\n\t\ttry {\r\n\r\n\t\t\tif (behavior.awake) behavior.awake.call(behavior, this, scene);\r\n\r\n\t\t} catch (error) {\r\n\r\n\t\t\tconsole.group();\r\n\t\t\t(console.error || console.log).call(console, error.stack || error);\r\n\t\t\tconsole.log('[Behavior]');\r\n\t\t\tconsole.log(behavior);\r\n\t\t\tconsole.log('[Object3D]');\r\n\t\t\tconsole.log(this);\r\n\t\t\tconsole.groupEnd();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t//Start\r\n\tfor (var i = 0, max = toInit.length; i < max; i++) {\r\n\r\n\t\tvar behavior = toInit[i];\r\n\t\ttry {\r\n\r\n\t\t\tif (behavior.start) behavior.start.call(behavior);\r\n\r\n\t\t} catch (error) {\r\n\r\n\t\t\tconsole.group();\r\n\t\t\t(console.error || console.log).call(console, error.stack || error);\r\n\t\t\tconsole.log('[Behavior]');\r\n\t\t\tconsole.log(behavior);\r\n\t\t\tconsole.log('[Object3D]');\r\n\t\t\tconsole.log(this);\r\n\t\t\tconsole.groupEnd();\r\n\r\n\t\t}\r\n\t\tbehavior.__isInitialized = true;\r\n\r\n\t}\r\n\r\n\t//Update\r\n\tfor (var i = 0, max = toUpdate.length; i < max; i++) {\r\n\r\n\t\tvar behavior = toUpdate[i];\r\n\t\ttry {\r\n\r\n\t\t\tif (behavior.update) behavior.update.call(behavior, deltaTime);\r\n\r\n\t\t} catch (error) {\r\n\r\n\t\t\tconsole.group();\r\n\t\t\t(console.error || console.log).call(console, error.stack || error);\r\n\t\t\tconsole.log('[Behavior]');\r\n\t\t\tconsole.log(behavior);\r\n\t\t\tconsole.log('[Object3D]');\r\n\t\t\tconsole.log(this);\r\n\t\t\tconsole.groupEnd();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n","'use strict';\r\n\r\n/**\r\n* The main module for the AltspaceVR SDK.\r\n* @module altspace\r\n*/\r\n\r\n// make sure that the core uses the correct version of the SDK\r\nlet version = VERSION;\r\nif (window.altspace && window.altspace.requestVersion) {\r\n\twindow.altspace.requestVersion(version);\r\n}\r\n\r\n// include source packages\r\nimport * as components from './components/index';\r\nimport * as utilities from './utilities/index';\r\n\r\nexport { components, utilities };\r\n"],"names":["flatten","obj","let","ret","__proto__","Object","assign","schema","dependencies","push","ref","registerComponentClass","name","cls","AFRAME","registerComponent","registerSystemClass","registerSystem","safeDeepSet","keys","value","length","slice","dashEscape","keyName","encodeURIComponent","replace","getCanonicalUrl","canonicalElement","document","querySelector","href","window","location","getProjectId","appId","authorId","canonicalUrl","connect","config","getRefs","refs","projectId","app","baseRef","child","space","spaceId","user","userId","instancesRef","instanceId","instance","key","updateUrl","url","query","toString","Url","baseRefUrl","Firebase","Error","tasks","inAltspace","unshift","altspace","getSpace","getUser","Promise","all","then","results","pop","sid","connection","init","_scene","_camera","_params","THREE","Scene","TypeError","Camera","scene","camera","p","domElem","renderer","domElement","addEventListener","mouseDown","mouseUp","mouseMove","event","intersection","findIntersection","point","cursorEvent","createCursorEvent","object","dispatchEvent","overObject","type","bubbles","target","ray","origin","raycaster","clone","direction","mouseEvent","mouse","Vector2","x","offsetX","width","innerWidth","y","offsetY","height","innerHeight","setFromCamera","intersections","intersectObjects","children","find","e","userData","collider","enabled","LoadRequest","error","objUrls","mtlUrls","objects","objectsLoaded","params","TRACE","crossOrigin","baseUrl","loader","utilities","shims","OBJMTLLoader","console","log","load","loadRequest","onComplete","req","start","Date","now","reqCount","i","loadModel","objUrl","mtlUrl","object3d","elapsed","toFixed","onProgress","xhr","responseURL","lengthComputable","percentComplete","loaded","total","filename","split","Math","round","printDebugInfo","inTile","inVR","ensureInVR","css","createElement","innerHTML","head","appendChild","body","style","background","Please","make_color","seed","getPenId","info","className","nameEl","toUpperCase","errorMsg","launchEl","insertBefore","notice","setName","n","getParsedUrl","fullUrl","splitPath","path","id","getAuthorId","isTeam","shouldStopPropagation","shouldStopPropagationImmediately","currentTarget","this","stopPropagation","stopImmediatePropagation","_listeners","listeners","listenerArray","array","call","parent","AFrameSystem","prototypeAccessors","tick","time","timeDelta","pause","play","AFrameComponent","update","oldData","remove","updateSchema","data","AltspaceCursorCollider","default","setColliderFlag","el","bind","state","object3D","traverse","subobj","Mesh","AltspaceTrackedControls","gamepadIndex","trackedControlsSystem","systems","systemGamepads","getGamepads","controllers","components","hand","controller","setAttribute","AltspaceComponent","usePixelScale","verticalAlign","enclosuresOnly","fullspace","version","warn","inClient","initRenderer","initCursorEvents","initCollisionEvents","t","dt","updateAllBehaviors","getEnclosure","requestFullspace","scale","setScalar","pixelsPerMeter","position","innerDepth","render","effect","oldRenderer","getThreeJSRenderer","aframeComponentVersion","noop","setSize","setPixelRatio","setClearColor","clear","enableScissorTest","setScissor","setViewport","getPixelRatio","getMaxAnisotropy","setFaceCulling","context","canvas","shadowMap","emit","eventName","targetEl","cursorEl","cursordownObj","uuid","addState","removeState","other","SyncColor","sync","isConnected","colorRef","dataRef","refChangedLocked","firstValue","component","detail","newData","color","isMine","setTimeout","set","on","snapshot","val","SyncComponent","isComponent","_isComponent","undefined","syncSys","ownerRef","ownerId","mode","ownOn","sceneEl","ownershipEvents","forEach","takeOwnership","clientId","onDisconnect","shouldTakeOwnership","isMasterClient","sceneRef","link","setupReceive","entityRef","transaction","owner","newOwnerId","gained","lost","cancel","SyncSystem","author","refUrl","connected","clientsRef","masterClientId","self","clientIds","masterClientKey","childSnapshot","joinedClientId","leftClientId","once","shouldInitialize","onTransform","componentName","onComponentChanged","sendPosition","sendRotation","sendScale","throttle","func","wait","options","timeout","args","result","previous","later","leading","apply","throttled","remaining","arguments","clearTimeout","trailing","positionRef","rotationRef","scaleRef","updateRate","stoppedAnimations","tagName","toLowerCase","stop","animation","sendEvent","sender","soundEventRef","soundStateRef","sound","playSound","pauseSound","off","meshInit","mesh","addNativeComponent","nativeComponentInit","getOrCreateObject3D","PlaceholderMesh","nativeComponentRemove","getObject3D","removeNativeComponent","nativeComponentUpdate","updateNativeComponent","object3DMap","callComponent","functionName","functionArguments","callNativeComponent","placeholderGeometry","BoxGeometry","placeholderMaterial","MeshBasicMaterial","visible","prototype","create","constructor","res","text","fontSize","horizontalAlign","isTrigger","center","radius","size","_forEachMesh","childObj","_initObj","convex","count","capacity","src","startsWith","currPath","pathname","endsWith","join","seek","playHandler","removeEventListener","loop","volume","autoplay","oneshot","spatialBlend","pitch","minDistance","maxDistance","rolloff","multiple","gain","lose","targets","actOnTargets","actOnTargetsIfStateMatches","act","Raycaster","Simulation","_renderer","usingAFrame","ascene","acamera","PerspectiveCamera","_setupWebGL","auto","resizeRender","aspect","updateProjectionMatrix","WebGLRenderer","antialias","margin","overflow","container","z","fov","near","far","add","AmbientLight","cursor","CursorShim.init","requestAnimationFrame","inCodePen","match","objFile","mtlFile","callback","mtlLoader","MTLLoader","setBaseUrl","setCrossOrigin","materials","objLoader","OBJLoader","setMaterials","EventDispatcher","Object3D","performance","lastNow","__lastNow","deltaTime","objectsWithBehaviors","__behaviorList","max","updateBehaviors","addBehavior","Array","addBehaviors","removeBehavior","behavior","indexOf","splice","dispose","group","stack","groupEnd","removeAllBehaviors","getBehaviorByType","toInit","toUpdate","__isInitialized","awake","VERSION","requestVersion"],"mappings":"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"}