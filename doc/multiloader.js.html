<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>multiloader.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="utilities.ColorHoverEffect.html">ColorHoverEffect</a><ul class='methods'><li data-type='method'><a href="utilities.ColorHoverEffect.html#add">add</a></li><li data-type='method'><a href="utilities.ColorHoverEffect.html#init">init</a></li></ul></li><li><a href="utilities.DragPlaneEffect.html">DragPlaneEffect</a><ul class='methods'><li data-type='method'><a href="utilities.DragPlaneEffect.html#add">add</a></li><li data-type='method'><a href="utilities.DragPlaneEffect.html#init">init</a></li></ul></li><li><a href="multiloader.LoadRequest.html">LoadRequest</a><ul class='methods'><li data-type='method'><a href="multiloader.LoadRequest.html#error">error</a></li><li data-type='method'><a href="multiloader.LoadRequest.html#mtlUrls">mtlUrls</a></li><li data-type='method'><a href="multiloader.LoadRequest.html#objects">objects</a></li><li data-type='method'><a href="multiloader.LoadRequest.html#objectsLoaded">objectsLoaded</a></li><li data-type='method'><a href="multiloader.LoadRequest.html#objUrls">objUrls</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="multiloader.html">altspace/utilities/multiloader</a><ul class='methods'><li data-type='method'><a href="multiloader.html#init">init</a></li><li data-type='method'><a href="multiloader.html#load">load</a></li></ul></li><li><a href="bubbling.html">altspace/utilities/shims/bubbling</a></li><li><a href="cursor.html">altspace/utilities/shims/cursor</a><ul class='methods'><li data-type='method'><a href="cursor.html#init">init</a></li></ul></li><li><a href="dualRenderer.html">altspace/utilities/shims/dualRenderer</a><ul class='methods'><li data-type='method'><a href="dualRenderer.html#ambientLight">ambientLight</a></li><li data-type='method'><a href="dualRenderer.html#camera">camera</a></li><li data-type='method'><a href="dualRenderer.html#inAltMode">inAltMode</a></li><li data-type='method'><a href="dualRenderer.html#renderer">renderer</a></li><li data-type='method'><a href="dualRenderer.html#init">init</a></li><li data-type='method'><a href="dualRenderer.html#render">render</a></li></ul></li><li><a href="threebase.html">altspace/utilities/threebase</a><ul class='methods'><li data-type='method'><a href="threebase.html#add">add</a></li><li data-type='method'><a href="threebase.html#init">init</a></li><li data-type='method'><a href="threebase.html#save">save</a></li><li data-type='method'><a href="threebase.html#update">update</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">multiloader.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Asynchronous loading of models using THREE.OBJMTLLoader
 * @module altspace/utilities/multiloader
 */
altspace = window.altspace || {};
altspace.utilities = altspace.utilities || {};
altspace.utilities.multiloader = (function(){

  var loader;
  var TRACE;
  var baseUrl = '';
  var crossOrigin = '';//assigned to THREE.MTLLoader.crossOrigin

  /**
   * Represents a request containing OBJ and MTL files that you want the 
   * multiloader to load. The LoadRequest instance is populated with the 
   * resulting objects.
   * @name LoadRequest
   * @class LoadRequest
   * @memberof module:altspace/utilities/multiloader
   */
  function LoadRequest(){
    var objUrls = [];
    var mtlUrls = [];
    var objects = [];
    var error;
    var objectsLoaded = 0;

    return {
      /**
       * Paths to model geometry files, in Wavefront OBJ format.
       * @instance
       * @type String[]
       * @memberof module:altspace/utilities/multiloader.LoadRequest
       */
      objUrls: objUrls,
      /**
       * Paths to model materials files, in Wavefront MTL format.
       * @instance
       * @type String[]
       * @memberof module:altspace/utilities/multiloader.LoadRequest
       */
      mtlUrls: mtlUrls,
      /**
       * Objects resulting from the load request. 
       * i.e. objects[i] is result of loader.load(objUrl[i], mtlUrl[i])
       * @instance
       * @type THREE.Object3D[]
       * @memberof module:altspace/utilities/multiloader.LoadRequest
       */
      objects: objects,
      /**
       * Error message indicating an error while loading at least one of the
       * requested files.
       * @instance
       * @type String
       * @memberof module:altspace/utilities/multiloader.LoadRequest
       */
      error: error,
      /**
       * Used internally to determine when loading complete.
       * @instance
       * @type Number
       * @memberof module:altspace/utilities/multiloader.LoadRequest
       */
      objectsLoaded: objectsLoaded
    };

  }//end of LoadRequest

  function init(params){
    var p = params || {};
    TRACE = p.TRACE || false;
    if (p.crossOrigin) crossOrigin = p.crossOrigin;
    if (p.baseUrl) baseUrl = p.baseUrl;
    if (baseUrl.slice(-1) !== '/') baseUrl += '/';

    loader = new THREE.OBJMTLLoader();
    loader.crossOrigin = crossOrigin;
    if (TRACE) console.log('MultiLoader initialized with params', params);
  }

  function load(loadRequest, onComplete){
    var req = loadRequest;
    var start = Date.now();
    if (!req || !req instanceof LoadRequest){
      throw new Error('MultiLoader.load expects first arg of type LoadRequest');
    }
    if (!onComplete || typeof(onComplete) !== 'function'){
      throw new Error('MultiLoader.load expects second arg of type function');
    }
    if (!req.objUrls || !req.mtlUrls || req.objUrls.length !== req.mtlUrls.length){
      throw new Error('MultiLoader.load called with bad LoadRequest');
    }
    var reqCount = req.objUrls.length;
    if (TRACE) console.log('Loading models...')
    for (var i=0; i &lt; reqCount; i++){
      var loadModel = function(req, i){//We need i in the closure to store result.
        var objUrl = baseUrl + req.objUrls[i];
        var mtlUrl = baseUrl + req.mtlUrls[i];
        if (TRACE) console.log('Loading obj:'+objUrl+', mtl:'+mtlUrl);
        loader.load(objUrl, mtlUrl, function(object3d){//onLoaded
          req.objects[i] = object3d;
          req.objectsLoaded++;
          if(req.objectsLoaded === reqCount){
            var elapsed = ((Date.now()-start)/1000.0).toFixed(2);
            if (TRACE) console.log('Loaded '+reqCount+' models in '+elapsed+' seconds');
            onComplete();
          }
        }, onProgress, function(){//onError 
          var url = xhr.target.responseURL || '';
          req.error = 'Error loading file '+url;
        });
      };
      loadModel(req, i);
    }
  }

  function onProgress(xhr){
    if (xhr.lengthComputable &amp;&amp; xhr.target.responseURL) {
      //Skip progress log if no xhr url, meaning it's a local file.
      var percentComplete = xhr.loaded / xhr.total * 100;
      var filename = xhr.target.responseURL.split('/').pop();
      if (TRACE) console.log('...'+filename+' '+Math.round(percentComplete,2)+'% downloaded');
    }
  }

  return {
    /**
     * Initialize the multiloader module
     * @static
     * @method
     * @param {Object} [params] Optional parameters.
     * @param {String} [params.crossOrigin=''] 
     * @param {String} [params.baseUrl=''] 
     * @param {Boolean} [params.TRACE=false] Log debug messages.
     */
    init: init,
    /**
     * Load the given LoadRequest and call the callback when ready.
     * @static
     * @method
     * @param {LoadRequest} loadRequest An instance of LoadRequest with the obj
     *  and mtl files that you want to load.
     * @param {Function} onComplete called when all the OBJs have been 
     *  loaded. The loadRequest instance will now contain the objects you 
     *  requested.
     */
    load: load,
    LoadRequest: LoadRequest,
  };

}());
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha5</a> on Mon Oct 05 2015 04:07:53 GMT-0400 (Eastern Daylight Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
