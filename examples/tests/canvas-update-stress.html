<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Canvas Update Stress Test</title>
		<meta charset="utf-8">
		<script src="https://cdn.rawgit.com/mrdoob/three.js/r74/build/three.min.js"></script>
		<script src="https://cdn.rawgit.com/mrdoob/three.js/r74/examples/js/controls/OrbitControls.js"></script>
		<script src="../../../dist/altspace.js"></script>
	</head>
	<body>
		<script>
			var sim = new altspace.utilities.Simulation({auto: false}), controls;

			var canvas = document.createElement('canvas');
			var textureSize = 512;
			canvas.width = textureSize;
			canvas.height = textureSize;
			var context = canvas.getContext('2d');
			var canvasTexture = new THREE.CanvasTexture(canvas);
			var material = new THREE.MeshBasicMaterial({ map: canvasTexture });
			canvasTexture.needsUpdate = true;

			var boxSize = 256;
			var box = new THREE.BoxGeometry(boxSize, boxSize, boxSize);
			var mesh = new THREE.Mesh(box, material);
			sim.scene.add(mesh);

			if (!altspace.inClient) {
				controls = new THREE.OrbitControls(sim.camera);
			}

			function animate(elapsed) {
				context.fillStyle = '#'+Math.floor(Math.random()*16777215).toString(16);
				context.fillRect(0, 0, textureSize, textureSize);
				canvasTexture.needsUpdate = true;

				if (controls) { 
					controls.update();
				}
				requestAnimationFrame(animate);
				sim.renderer.render(sim.scene, sim.camera);
			}
			animate(0);
		</script>
	</body>
</html>

