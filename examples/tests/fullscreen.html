<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Fullspace</title>
		<meta charset="utf-8">
		<script src="https://cdn.rawgit.com/mrdoob/three.js/r74/build/three.min.js"></script>
		<script src="../../dist/altspace.js"></script>
	</head>
	<body style="background-color: red">
		<script>
			var sim = new altspace.utilities.Simulation(), controls;

			var boxSize = 0.5;
			var boxGeo = new THREE.BoxGeometry(boxSize, boxSize, boxSize);
			var boxMat = new THREE.MeshBasicMaterial({color: 'green'});

			function makeBox(x, y, z) {
				var boxMesh = new THREE.Mesh(boxGeo, boxMat.clone());
				boxMesh.position.set(x, y, z);
				sim.scene.add(boxMesh);
				return boxMesh;
			}

			function makeMovingBox(x, y, z) {
				var boxMesh = makeBox(x, y, z);
				boxMesh.addBehavior({
					awake: function (obj) {
						this.obj = obj;
						this.origX = obj.position.x;
						this.time = 0;
					},
					update: function (delta) {
						this.time += delta;
						this.obj.position.x = this.origX + Math.sin(this.time / 1000) * 3;
					}
				});
				return boxMesh;
			}

			function makeFlippingBox(x, y, z) {
				var boxMesh = makeBox(x, y, z);
				boxMesh.addBehavior({
					awake: function (obj) {
						this.obj = obj;
						this.time = 0;
						this.flip = true;
					},
					update: function (delta) {
						this.time += delta;
						if (this.time > 2000) {
							if (this.flip) {
								this.obj.position.set(0, 0, 0);
							}
							else {
								this.obj.position.set(x, y, z);
							}
							this.time = 0;
							this.flip = !this.flip;
						}
					}
				});
				return boxMesh;
			}

			altspace.getEnclosure().then(function (enclosure) {
				sim.scene.scale.multiplyScalar(enclosure.pixelsPerMeter);
				var button = makeBox(0, boxSize * 1.5, 0);
				button.material.color.setStyle('white');
				button.addEventListener('cursordown', function () {
					if (enclosure.fullspace) {
						enclosure.exitFullspace();
						sim.scene.scale.multiplyScalar(enclosure.pixelsPerMeter);
						button.material.color.setStyle('white');
					}
					else {
						enclosure.requestFullspace().then(function () {
							button.material.color.setStyle('red');
							sim.scene.scale.set(1, 1, 1);
						});
					}
				});
			});

			var spacing = 0.9;
			var offset = 2;
			var num = 8;
			for (var x = 0; x < num; x++) {
				for (var y = 0; y < num; y++) {
					for (var z = 0; z < num; z++) {
						var box = makeMovingBox(
							((x / (num - 1)) - 0.5) * num * spacing,
							((y / (num - 1)) - 0.5) * num * spacing,
							((z / (num - 1)) - 0.5) * num * spacing + offset)
						box.material.color.r = x / num;
						box.material.color.g = y / num;
						box.material.color.b = z / num;
					}
				}
			}

			makeFlippingBox(3, 3, 3);
		</script>
	</body>
</html>

