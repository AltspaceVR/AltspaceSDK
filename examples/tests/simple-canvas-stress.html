<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Canvas Update Stress Test</title>
		<meta charset="utf-8">
	</head>
	<body>
		<script>
			var textureSize = Math.pow(2, 9);
			console.info('textureSize: ', textureSize);
			var canvas = document.createElement('canvas');
			canvas.width = textureSize;
			canvas.height = textureSize;
			var context = canvas.getContext('2d');
			context.fillStyle = 'red';
			context.fillRect(0, 0, textureSize, textureSize);
			texture.needsUpdate = true;

			var i = 0;
			function animate() {
				//requestAnimationFrame(animate);
				i += 0.2;
				context.fillStyle = '#'+((Math.sin(i) * 255 << 16)).toString(16);
				context.fillRect(0, 0, textureSize, textureSize);
				texture.needsUpdate = true;
				// box.canvas.toDataURL().length;
				// box.context.getImageData(0, 0, textureSize, textureSize).data.length;

				var reader = new FileReader();
				var blob;
				function readBlob () {
					reader.removeEventListener('loadend', readBlob);
					reader.result.byteLength;
				}
				reader.addEventListener('loadend', readBlob);
				box.canvas.toBlob(function (_blob) {
					reader.readAsArrayBuffer(_blob);
				});

				if (controls) { 
					controls.update();
				}
				sim.renderer.render(sim.scene, sim.camera);

				stats.update();
			}
			setInterval(animate, 10);
			//animate();

			toggle.addEventListener('click', function () {
				doAnimate = !doAnimate;
			});
		</script>
	</body>
</html>

