<!DOCTYPE html>
<html>
    <head>
        <title>Geometry Stress Test</title>
        <script src="https://cdn.rawgit.com/mrdoob/three.js/r84/build/three.js"></script>
        <script src="https://cdn.rawgit.com/mrdoob/stats.js/066cb4e8/build/stats.min.js"></script>
        <script src="../../../dist/altspace.min.js"></script>
    </head>
    <body>
        <script>

            var stats = new Stats();
            stats.showPanel(0);
            document.body.appendChild(stats.dom);

            var scene = new THREE.Scene();
            var renderer = altspace.getThreeJSRenderer();

            window.requestAnimationFrame(function animate(timestamp){
                window.requestAnimationFrame(animate);
                stats.begin();
                renderer.render(scene);
                stats.end();
            });

            altspace.getEnclosure().then(function(enc){
                scene.scale.setScalar(enc.pixelsPerMeter);
            });

            function randPos(){
                return Math.random() * 3 - 1.5;
            }

            var box = new THREE.Mesh(new THREE.BoxBufferGeometry(0.05,0.05,0.05));
            var count = 0;
            var batchSize = 500;
            var handle = setInterval(function(){
                if(count < 9000){
                    for(var i=0; i<batchSize; i++)
                    {
                        var item = box.clone();
                        item.material = new THREE.MeshBasicMaterial({color: Math.random() * 0xffffff});
                        item.position.set(randPos(), randPos(), randPos());
                        scene.add(item);
                    }
                    count += batchSize;
                }
                else {
                    clearInterval(handle);
                }
            }, 500);

        </script>
    </body>
</html>
