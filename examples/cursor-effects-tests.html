<!DOCTYPE html>
<html lang=en>
<head>
<meta charset=utf-8>
<title>Cursor Effects Tests</title>
<script src="http://sdk.altvr.com/libs/three.js/r71/build/three.min.js"></script>
<script src="http://sdk.altvr.com/libs/three.js/r71/
examples/js/loaders/MTLLoader.js"></script>
<script src="http://cdn.firebase.com/js/client/2.2.9/firebase.js"></script>
<script src="../utilities/CursorEffects.js"></script>
<script src="../utilities/ColorHoverEffect.js"></script>
<script src="../utilities/DragPlaneEffect.js"></script>
<script src="../utilities/FirebaseSync.js"></script>
<script src="../utilities/shims/CursorEvents.js"></script>


</head>
<body>
<script>

//Setup
var inAltspace = !!window.altspace;
var renderer, camera, cursorEvents;
var scene = new THREE.Scene();
if ( inAltspace ) {
	renderer = altspace.getThreeJSRenderer({version:'0.2.0'});
} else {
	renderer = new THREE.WebGLRenderer({antialias: true});
	renderer.setClearColor("#AAAAAA");
	renderer.setSize(window.innerWidth, window.innerHeight);
	document.body.appendChild(renderer.domElement);
	var aspect = window.innerWidth / window.innerHeight;
	camera = new THREE.PerspectiveCamera(45, aspect, 1, 2000);
	camera.position.z = 1000; // stand back from origin
	scene.add(camera);
	window.addEventListener('resize', function(event) {
		camera.aspect = window.innerWidth / window.innerHeight;
		camera.updateProjectionMatrix();
		renderer.setSize(window.innerWidth, window.innerHeight);
	});
	cursorEvents = new CursorEvents( scene, camera );
}

// Use MTLLoader for loadTexture, to ensure image is power of 2
// else antialiasing won't work (this is a limitation of WebGL)
var materialCreator = new THREE.MTLLoader.MaterialCreator();
var texture = materialCreator.loadTexture('models/cube/altspace-logo.jpg');

// Cube
var geometry = new THREE.BoxGeometry(1, 1, 1);
var material = new THREE.MeshBasicMaterial({color:'cyan', map: texture});
var cube = new THREE.Mesh(geometry, material);
cube.scale.multiplyScalar(100);
cube.position.y = -450;
scene.add(cube);
if ( !inAltspace ) camera.lookAt( cube.position );

// Must clone materials, else outside of Altspace material change affects all cubes.
var cube2 = cube.clone();
cube2.material = cube.material.clone();
var cube3 = cube.clone();
cube3.material = cube.material.clone();

// Add additional cubes a bit closer to the camera.
cube2.position.x += 300; // right cube
cube3.position.x -= 300; // left cube
scene.add(cube2);
scene.add(cube3);

// Setup sync, prefix appId with 'http' to match new rules
var firebaseExamples ="http://altspace-apps.firebaseio.com/apps/examples";
var firebaseSync = new FirebaseSync(firebaseExamples, "http-cursor-effects-tests");
firebaseSync.addObject( cube, "cube" );
firebaseSync.connect();

// Effects
var cursorEffects = new CursorEffects(scene);
var dragPlane = new THREE.Mesh( 
	new THREE.BoxGeometry( 1000, 0.25, 1000 ),
	new THREE.MeshBasicMaterial( { color: 'gray' })
);
dragPlane.position.y = -500;
scene.add( dragPlane );
var dragEffect = new DragPlaneEffect(dragPlane, { firebaseSync: firebaseSync });
cursorEffects.addEffect(dragEffect, cube); // only middle cube is draggable

// All cubes have hover effect; middle is yellow, others are pink.
var hoverYellow = new ColorHoverEffect(new THREE.Color('yellow'));
var hoverPink = new ColorHoverEffect(new THREE.Color('pink'));
cursorEffects.addEffect(hoverYellow, cube);
cursorEffects.addEffect(hoverPink, cube2);
cursorEffects.addEffect(hoverPink, cube3);

// Update & Rendering
function animate() {
	requestAnimationFrame(animate);
	renderer.render(scene, camera);
	cube.rotation.y += 0.01; // only middle cube spins
}
animate();

</script>
</body>
</html>