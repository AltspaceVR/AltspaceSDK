<!-- ReSharper disable Html.TagNotResolved -->
<html>
<head>
	<title>Native Components</title>
	<!--<script src="../build.js"></script>-->
	<script src="https://aframe.io/releases/0.2.0/aframe.min.js"></script>
	<script src="../../dist/aframe-altspace-component.js"></script>
	<script src="http://sdk.altvr.com/libs/altspace.js/0.19.0/altspace.min.js"></script>
	</head>
<body>
<a-scene altspace>
	<script>
		(function(){
			var score = 0;
			document.addEventListener('DOMContentLoaded', function(){
				var TimeLimit = 60;
				var countdownInterval;
				var clockTime = TimeLimit;
				
				var basket = document.querySelector('#basket-container');
				var scoreText = document.querySelector('#score-text');
				var clockText = document.querySelector('#clock-text');
				var scoreEffect0 = document.querySelector('#score-effect0');
				var scoreEffect1 = document.querySelector('#score-effect1');

				window.game = {
					basket: basket,
					scoreText: scoreText,
					clockText: clockText,
					scoreEffect0: scoreEffect0,
					scoreEffect1: scoreEffect1,
					score: score
				};

				basket.addEventListener('container-count-changed', function(event){
					if(event.detail.count > event.detail.oldCount && event.detail.count > 0){
						console.log('score changing from ' + event.detail.oldCount + ' to ' + event.detail.count);
						scoreGoal();
					}
				});
			
				function refreshScoreboard(){
					scoreText.setAttribute('n-text', 'text:' + score);
				}
			
				function refreshClock(){
					clockText.setAttribute('n-text', 'text:' + clockTime);
				}

				function scoreGoal(){
						score++;
						game.scoreEffect0.emit('score');
						game.scoreEffect1.emit('score');
						refreshScoreboard();
				}

				function newGame(){
					score = 0;
					refreshScoreboard();
					newCountdown();
				}

				function newCountdown(){
					clockTime = TimeLimit;
					countdownInterval = setInterval(function(){
						clockTime--;

						if(clockTime < 0){
							endGame();
						}

						refreshClock();
					}, 1000);
				}

				function endGame(){
					 clockTime = 0;
					 clearInterval(countdownInterval)
					 setTimeout(function(){
					 	newGame();
					 }, 5000);
				}

				newGame();
			});
		})();
	</script>

	<a-entity id="game" position="1 -0.25 -5.5">
		<a-entity n-object="objects/basketball net" position="-1 3 0" rotation="0 90 0">
			<a-entity  id="score-effect0" position="0 0 0">
				<a-animation attribute="rotation" dur="1500" to="0 360 0" begin="score" easing="ease" repeat="0"></a-animation>
				<a-entity position="0.5 0 0" n-object="effects/sparkler"></a-entity>
			</a-entity>
			<a-entity id="score-effect1" position="0 0 0">
				<a-animation attribute="rotation" dur="1500" to="0 360 0" begin="score" direction="reverse" easing="ease" repeat="0"></a-animation>
				<a-entity position="0.5 0 0" n-object="effects/sparkler"></a-entity>
			</a-entity>
		</a-entity>

		<a-box id="basket-container" color="yellowgreen" rotation="0 0 0" scale="1 0.25 1" opacity="0" n-box-collider="isTrigger:true" n-container="capacity:3" position="-1 2.1 0"></a-box>


		<a-entity n-object="architecture/wall-2w-4h" position="1 0.5 -1" rotation="0 -90 0"></a-entity>
		<a-entity n-object="architecture/wall-2w-4h" position="-1 0.5 -1" rotation="0 -90 0"></a-entity>

		<a-entity n-spawner="res:interactables/basketball" position="0.5 1.25 3">
			<a-entity position="0 0.5 0" n-object="effects/fire"></a-entity>
		</a-entity>
		<a-entity n-spawner="res:interactables/basketball" position="-2.5 1.25 3">
			<a-entity position="0 0.5 0" n-object="effects/fire"></a-entity>
		</a-entity>

		<a-entity class="wall" position="0.5 0.5 0">
			<a-entity n-object="architecture/railing-4l" position="-0.125 2.5 -0.25" rotation="45 0 0" scale="1 0.5 1"></a-entity>

			<a-entity n-object="architecture/wall-2w-4h" position="0 0 -0.5" rotation="0 0 0" scale="1 1 0.25"></a-entity>
			<a-entity n-object="architecture/wall-2w-4h" position="0 0 0" rotation="0 0 0" scale="1 0.5 0.5"></a-entity>
			<a-entity n-object="architecture/wall-2w-4h" position="0 0 1" rotation="0 0 0" scale="1 0.25 0.5"></a-entity>
			<a-entity n-object="architecture/wall-2w-4h" position="0 0 2" rotation="0 0 0" scale="1 0.125 0.5"></a-entity>


			<a-entity rotation="0 90 15" position="-2.5 4.5 -0.5">
				<a-entity n-object="architecture/wall-4w-4h" scale="1 0.5 0.5"></a-entity>
				<a-entity rotation="0 90 0">
					<a-entity n-text="text:SCORE;" scale="0.65 0.65 0.65" position="-1 1.5 -0.1"></a-entity>
					<a-entity id="score-text" n-text="text:0" position="-1 0.65 -0.1"></a-entity>
				</a-entity>
			</a-entity>

			<!-- <a-entity rotation="0 45 0" position="1 2 0">
				<a-entity n-object="architecture/wall-4w-4h" scale="1 0.5 0.5"></a-entity>
				<a-entity rotation="0 90 0">
					<a-entity n-text="text:HIGHSCORE;" scale="0.3 0.5 0.5" position="-1 1.55 -0.1"></a-entity>
					<a-entity n-text="text:12" position="-1 0.85 -0.1" scale="0.75 0.75 0.75"></a-entity>
					<a-entity n-text="text:GAVAN;" scale="0.5 0.5 0.5" position="-1 0.25 -0.1"></a-entity>
				</a-entity>
			</a-entity>
 -->
			<a-entity rotation="0 115 0" position="-6 2 0">
				<a-entity n-object="architecture/wall-4w-4h" scale="1 0.5 0.5"></a-entity>
				<a-entity rotation="0 90 0">
					<a-entity n-text="text:CLOCK;" scale="0.5 0.5 0.5" position="-1 1.5 -0.1"></a-entity>
					<a-entity id="clock-text" n-text="text:60" position="-1 0.65 -0.1"></a-entity>
				</a-entity>
			</a-entity>
		</a-entity>

		<a-box color="black" scale="1 0.1 1.25" opacity="0.3" id="trigger-0" rotation="45 0 0" n-box-collider="isTrigger:false" n-container="capacity:3" position="-2 2.75 0"></a-box>

		<a-box color="black" scale="1 0.1 1.25a" opacity="0.3" id="trigger-0" rotation="45 0 0" n-box-collider="isTrigger:false" n-container="capacity:3" position="0 2.75 0"></a-box>

		<a-box color="black" scale="3 0.1 3" opacity="0.3" id="trigger-0" rotation="45 0 0" n-box-collider="isTrigger:false" n-container="capacity:3" position="-1 1.25 1.5"></a-box>

		<a-entity class="wall" position="-3 0.5 0">
			<!-- <a-entity n-object="architecture/railing-2l" position="1.5 2.5 -0.25" rotation="45 0 90" scale="1 1 0.5"></a-entity> -->

			<a-entity n-object="architecture/railing-4l" position="0.5 2.5 -0.25" rotation="45 0 0" scale="1 0.5 1"></a-entity>

			<a-entity n-object="architecture/wall-2w-4h" position="0 0 -0.5" rotation="0 0 0" scale="1 1 0.25"></a-entity>
			<a-entity n-object="architecture/wall-2w-4h" position="0 0 0" rotation="0 0 0" scale="1 0.5 0.5"></a-entity>
			<a-entity n-object="architecture/wall-2w-4h" position="0 0 1" rotation="0 0 0" scale="1 0.25 0.5"></a-entity>
			<a-entity n-object="architecture/wall-2w-4h" position="0 0 2" rotation="0 0 0" scale="1 0.125 0.5"></a-entity>
		</a-entity>


		<a-entity n-object="architecture/floor-2w-4l" position="1 0.5 3" rotation="0 -90 0"></a-entity>
		<a-entity n-object="architecture/floor-2w-4l" position="-1 0.5 3" rotation="0 -90 0"></a-entity>
	</a-entity>
</a-scene>
</body>
</html>
